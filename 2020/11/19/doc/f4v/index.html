<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>f4v文件格式 | 雪人</title><meta name="keywords" content="sql  python node  video web html css javascript"><meta name="author" content="雪人"><meta name="copyright" content="雪人"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="Adobe Flash Video File Format Specification  Version 10.1 Introduction Flash®是Web上动态媒体的事实标准，支持多种媒体格式，包括两种用于提供同步音频和视频流的核心容器格式：     F4V, for H.264&#x2F;AAC–based content, and     FLV, for other supported cod">
<meta property="og:type" content="article">
<meta property="og:title" content="f4v文件格式">
<meta property="og:url" content="https://www.webq.top/2020/11/19/doc/f4v/index.html">
<meta property="og:site_name" content="雪人">
<meta property="og:description" content="Adobe Flash Video File Format Specification  Version 10.1 Introduction Flash®是Web上动态媒体的事实标准，支持多种媒体格式，包括两种用于提供同步音频和视频流的核心容器格式：     F4V, for H.264&#x2F;AAC–based content, and     FLV, for other supported cod">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.webq.top/img/hy.jpeg">
<meta property="article:published_time" content="2020-11-19T06:06:47.977Z">
<meta property="article:modified_time" content="2020-11-19T06:06:47.978Z">
<meta property="article:author" content="雪人">
<meta property="article:tag" content="sql  python node  video web html css javascript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.webq.top/img/hy.jpeg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://www.webq.top/2020/11/19/doc/f4v/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="manifest" href="/pwa/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/pwa/favicon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/pwa/favicon.png"/><link rel="icon" type="image/png" sizes="16x16" href="/pwa/favicon.png"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-11-19 14:06:47'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/face.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">153</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">40</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">12</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/cli/"><i class="fa-fw fas fa-retweet"></i><span> CLI</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 工具集</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/follow/"><i class="fa-fw fas fa-star"></i><span> 收藏夹</span></a></li><li><a class="site-page" href="/audio/"><i class="fa-fw fas fa-music"></i><span> audio_context</span></a></li><li><a class="site-page" href="/piano/"><i class="fa-fw fas fa-music"></i><span> 在线Piano</span></a></li><li><a class="site-page" href="/hy/"><i class="fa-fw fas fa-video"></i><span> Canvas绘图</span></a></li><li><a class="site-page" href="/jianyin/"><i class="fa-fw fas fa-video"></i><span> 剪映调色</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 文档库</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/2020/11/19/doc/ci/"><span> CI</span></a></li><li><a class="site-page" href="/2020/11/19/doc/h264/"><span> h264</span></a></li><li><a class="site-page" href="/2020/11/19/doc/f4v/"><span> f4v</span></a></li><li><a class="site-page" href="/2020/11/19/doc/mask/"><span> mask</span></a></li><li><a class="site-page" href="/2020/11/19/doc/dj/"><span> Django</span></a></li><li><a class="site-page" href="/2020/11/19/doc/mse/"><span> MSE</span></a></li></ul></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Adobe-Flash-Video-File-Format-Specification"><span class="toc-number">1.</span> <span class="toc-text">Adobe Flash Video File Format Specification</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a1"><span class="toc-number">2.</span> <span class="toc-text">1. F4V文件格式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a1-1"><span class="toc-number">2.1.</span> <span class="toc-text">1.1. Overview</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a1-2"><span class="toc-number">2.2.</span> <span class="toc-text">1.2. 简单数据类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a1-3"><span class="toc-number">2.3.</span> <span class="toc-text">1.3. F4V box format</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a1-4"><span class="toc-number">2.4.</span> <span class="toc-text">1.4. f4v框层次</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a1-5"><span class="toc-number">2.5.</span> <span class="toc-text">1.5. 示例描述框层次结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a1-6"><span class="toc-number">2.6.</span> <span class="toc-text">1.6. 处理不支持的boxes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a1-7"><span class="toc-number">2.7.</span> <span class="toc-text">1.7. 排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a1-8"><span class="toc-number">2.8.</span> <span class="toc-text">1.8. Supported Media Types</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a1-8-1"><span class="toc-number">2.8.1.</span> <span class="toc-text">1.8.1. Supported audio types</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a1-8-2"><span class="toc-number">2.8.2.</span> <span class="toc-text">1.8.2. Supported video types</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a1-8-3"><span class="toc-number">2.8.3.</span> <span class="toc-text">1.8.3. Supported data types&lt;&#x2F;&gt;

Media type       	Comments
Text              文本（0x74657874）或tx3g（0x74783367）
                  的媒体类型表示曲目包含通过ActionScript提供的文本数据。
AMF0              媒体类型amf0（0x616d6630）表示该曲目包含与操作脚本消息格式
                  （amf）的原始版本相对应的数据。
AMF3              媒体类型amf3（0x616d6633）表示该曲目包含与操作脚本消息格式（amf）版本3对应的数据。


2. F4V Box Definitions

定义了f4v文件格式支持的框。
2.1. File Type box

Box type: ‘ftyp’ 
Container: File 
Mandatory: Yes 
Quantity: One
f4v格式基于iso mpeg4格式，而iso mpeg4格式又基于Apple QuickTime容器格式。格式的子集支持不同的功能。文件类型（ftyp）框有助于识别程序播放特定文件所需支持的功能。
FTYP箱应尽早放置，并应位于任何可变长度箱之前。
flash player对ftyp框没有任何限制。如果文件包含Flash播放器可以解码的数据，Flash播放器会尝试播放。
ftyp box
Field	                Type           Comments
Header              	BOXHEADER	     BoxType &#x3D; &amp;#x27;ftyp&amp;#x27; (0x66747970)
MajorBrand            UI32          主要品牌标识符。对于f4v文件，majorbrand是&amp;#x27;f4v&amp;#x27;（0x66347620）。

MinorVersion          UI32          Minorversion仅提供信息。不得用于确定文件是否符合标准。
                                    它可能允许更精确地识别主要品牌，以便进行检查、调试或改进解码。
                                    compatible brands ui32[]任意数量的兼容品牌，直到包装盒结束



For more information, see section 4.3 of ISO&#x2F;IEC 14496-12:2008.
2.2. 渐进式下载信息框

Box type: ‘pdin’ 
Container: File 
Mandatory: No 
Quantity: One
渐进式下载信息（PDIN）框定义有关渐进式下载的信息。pdin框的有效负载提供了一些提示，提示玩家在安全开始播放之前要下载多少数据。
pdin框应尽可能早地放置在文件中，位于文件类型（ftyp）框之后，以获得最大的实用性。
pdin box
Field	          Type	        Comment
Header          BOXHEADER	    BoxType &#x3D; &amp;#x27;pdin&amp;#x27; (0x7064696E)
Version         UI8	          Expected to be 0
Flags           UI24	        Reserved. Set to 0
RateDelay       RATEDELAY[]	  任意数量的RATEDLAY记录，直到方框结束
Rate            UI32	        此记录要考虑的速率（字节&#x2F;秒）
InitialDelay    UI32	        以此速率开始播放之前要延迟的毫秒数



For more information, see section 8.1.3 of ISO&#x2F;IEC 14496-12:2008.
2.3.  Movie box

Box type: ‘moov’ 
Container: File 
Mandatory: Yes 
Quantity: One
Movie（moov）框实际上是一个f4v文件的“头”。MOOV框本身包含一个或多个其他框，而其他框又包含定义F4V数据结构的其他框。
moov box
Field	      Type        	Comment
Header	    BOXHEADER	    BoxType &#x3D; &amp;#x27;moov&amp;#x27; (0x6D6F6F76)
Boxes	      BOX [ ]	      定义文件结构的任意框数



For more information, see section 8.2.1 of ISO&#x2F;IEC 14496-12:2008.
2.4. Movie Header box

Box type: ‘mvhd’ 
Container: Movie box (‘moov’) 
Mandatory: Yes 
Quantity: One
Movie标题（MVHD）框定义应用于整个F4V文件的播放信息。MVHD箱应首先放置在其容器中。
mvhd box
Field     	    Type	              Comment
Header	        BOXHEADER	          BoxType &#x3D; &amp;#x27;mvhd&amp;#x27; (0x6D766864)
Version	        UI8	                Either 0 or 1
Flags           UI24	              Reserved. Set to 0
CreationTime    IF Version &#x3D;&#x3D; 0     f4v文件的创建时间，
                UI32                表示为自1904年1月1日午夜（UTC）以来经过的秒数。
                IF Version &#x3D;&#x3D; 1
                UI64

ModificationTime	IF Version &#x3D;&#x3D; 0   f4v文件的最后一次修改时间，
                UI32                表示为自1904年1月1日午夜（UTC）以来经过的秒数。
                IF Version &#x3D;&#x3D; 1
                UI64
TimeScale       UI32                整个f4v文件的时间坐标系，以每秒的时间单位数表示。
                                    例如，100表示时间单位为1&#x2F;100秒。
Duration        IF Version &#x3D;&#x3D; 0
                UI32                以时间刻度单位表示的F4V文件的总长度
                IF Version &#x3D;&#x3D; 1     也是文件中最长曲目的持续时间。
                UI64
Rate            SI16.16             首选播放速率，以固定点16.16数字表示
                                    （通常为0x00010000&#x3D;1.0，或正常播放速率）
Volume          SI8.8               文件的主卷，表示为定点8.8号
                                    （通常为0x0100&#x3D;1.0，或完整卷）。
Reserved        UI16	              Reserved. Set to 0
Reserved        UI32 [2]	          Reserved. Set to 0
Matrix          SI32 [9]            f4v文件的转换矩阵应为:
                                    &amp;#123;0x00010000, 0, 0,
                                    0, 0x00010000, 0,
                                    0, 0, 0x40000000&amp;#125;
Reserved        UI32 [6]	          Reserved. Set to 0
NextTrackID     UI32                要添加到演示文稿的下一个track的ID。
                                    该值不应为0，但可以全部为1，以表示未定义状态。



For more information, see section 8.2.2 of ISO&#x2F;IEC 14496-12:2008.
2.5. Track box

Box type: ‘trak’ 
Container: Movie box (‘moov’) 
Mandatory: Yes 
Quantity: One or more
每个trak框对应于f4v文件中的单个媒体曲目，并包含进一步定义媒体曲目属性的框。
trak box
Field	          Type               Comment
Header	        BOXHEADER	         BoxType &#x3D; &amp;#x27;trak&amp;#x27; (0x7472616B)
Boxes	          BOX [ ]	           定义媒体轨的任意框数



For more information, see section 8.3.1 of ISO&#x2F;IEC 14496-12:2008.
2.5.1. Track Header box

Box type: ‘tkhd’ 
Container: Movie box (‘trak’) 
Mandatory: Yes 
Quantity: One
The Track Header （TKHD）框描述磁道的主要属性。TKHD箱应首先放在其容器中。
tkhd box
Field	            Type	            Comment
Header	          BOXHEADER	        BoxType &#x3D; &amp;#x27;tkhd&amp;#x27; (0x746B6864)

Version	          UI8	              Either 0 or 1
Flags             UI24              Bit 0 &#x3D; 开启
                                    Bit 1 &#x3D; the track is part of the presentation
                                    Bit 2 &#x3D; the track should be considered when previewing the F4V file
CreationTime      IF Version &#x3D;&#x3D; 0
                  UI32              轨道的创建时间
                  IF Version &#x3D;&#x3D; 1
                  UI64
ModificationTime	IF Version &#x3D;&#x3D; 0
                  UI32              轨道的最后修改时间
                  IF Version &#x3D;&#x3D; 1
                  UI64
TrackID	          UI32	            track唯一标识符
Reserved	        UI32	            Reserved. Set to 0
Duration          IF Version &#x3D;&#x3D; 0
                  UI32              音轨的持续时间
                  IF Version &#x3D;&#x3D; 1
                  UI64

Reserved          UI32 [2]	        Reserved. Set to 0
Layer             SI16              track前后排序的位置，对于f4v文件，预计为0。
AlternateGroup	  SI16	            0
Volume            SI8.8             音频轨为0x0100（定点8.8，数字代表1.0），否则为0
Reserved          UI16	            Reserved. Set to 0
TransformMatrix	  SI32[9]           定义透视变换的固定点值矩阵，应
                                    &amp;#123;0x00010000, 0, 0
                                    0, 0x00010000, 0
                                    0, 0, 0x40000000&amp;#125;
Width             UI16.16	          以固定点表示的宽度16.16数字
Height	          UI16.16	          以固定点表示的高度16.16数字



For more information, see section 8.6.5 of ISO&#x2F;IEC 14496-12:2008.
2.5.2. Edit box

Box type: ‘edts’ 
Container: Track box (‘trak’) 
Mandatory: No 
Quantity: One
编辑（EDTS）框将演示时间线映射到媒体时间线，因为它存储在F4V文件中。EDTS框是编辑列表的容器。
如果文件不包含EDTS框，则会隐式地对这些时间线进行一对一映射。EDTS框应位于媒体（MDIA）框之前。
edit box
Field	            Type	          Comment
Header            BOXHEADER	      BoxType &#x3D; &amp;#x27;edts&amp;#x27; (0x65647473)
Edit list box	    BOX	            An explicit time-line map



For more information, see section 8.6.5 of ISO&#x2F;IEC 14496-12:2008.
2.5.2.1. Edit List box

Box type: ‘elst’ 
Container: Edit box (‘edts’) 
Mandatory: No 
Quantity: One
tkhd box
编辑列表（ELST）框以编辑列表条目的形式包含显式时间线图。ELST框中的每个条目通过以下方式之一定义了演示时间线的一部分：
-通过映射媒体时间表的一部分
-通过指示空时间（即间隙）
-通过定义停留时间（即一个时间点停留一段时间的位置）
编辑列表框中的空编辑表示间隙。若要指定轨迹的起始偏移，请在轨迹的起始处插入空的编辑。
空编辑不应是曲目中的最后一个编辑。如果在“影片标题”框中指定的持续时间与曲目的实际持续时间不同，则会在曲目末尾放置一个隐式空编辑。
媒体应该在间隙后立即有一个关键帧。另外，flash播放器可以使用同步采样框中的数据在间隙后查找关键帧。
elst box
Field	              Type	            Comment
Header              BOXHEADER         BoxType &#x3D; &amp;#x27;elst&amp;#x27; (0x656C7374)
Version	            UI8               Either 0 or 1
Flags	              UI24	            Reserved. Set to 0
EntryCount  	      UI32	            Number of entries in the edit list entry table
EditListEntryTable	ELSTRECORD 
                    [EntryCount]	    An array of ELSTRECORD structures
SegmentDuration	    IF Version &#x3D;&#x3D; 0
                    UI32              此编辑段的持续时间
                    IF Version &#x3D;&#x3D; 1
                    UI64
MediaTime           IF Version &#x3D;&#x3D; 0
                    SI32              此编辑段媒体中的开始时间作为合成时间，
                    IF Version &#x3D;&#x3D; 1   以MDHD中定义的时间刻度单位表示？盒子。值-1指定空编辑。
                    SI64
MediaRateInteger	  SI16              播放此编辑段媒体的相对速率。默认值为1。值为0表示停留编辑。
MediaRateFraction	  SI16	            Reserved. Set to 0



For more information, see section 8.6.6 of ISO&#x2F;IEC 14496-12:2008.
2.6. Media box

Box type: ‘mdia’ 
Container: Track box (‘trak’) 
Mandatory: Yes 
Quantity: One
tkhd box
媒体（MDIA）框包含定义媒体曲目属性的框
mdia box
Field	            Type	          Comment
Header            BOXHEADER	      BoxType &#x3D; &amp;#x27;mdia&amp;#x27; (0x6D646961)
Edit list box	    BOX[]	          定义媒体跟踪属性的任意数量的框



For more information, see section 8.4 of ISO&#x2F;IEC 14496-12:2008.
2.6.1. Media Header box

Box type: ‘mdhd’ 
Container: Media box (‘mdia’) 
Mandatory: Yes 
Quantity: One
媒体标题（MDHD）框描述媒体曲目的属性。MDHD箱应首先放在其容器中。
mdhd box
Field	            Type	          Comment
Header	          BOXHEADER	      BoxType &#x3D; &amp;#x27;mdhd&amp;#x27; (0x6D646864)
Version     	    UI8	            Either 0 or 1
Flags	            UI24          	Reserved. Set to 0
CreationTime      IF Version &#x3D;&#x3D; 0
                  UI32              The creation time of the box
                  IF Version &#x3D;&#x3D; 1
                  UI64
ModificationTime	IF Version &#x3D;&#x3D; 0
                  UI32              The last modification time of the box
                  IF Version &#x3D;&#x3D; 1
                  UI64
TimeScale         UI32            此轨道的时间坐标系，以每秒的时间单位数表示
Duration          IF Version &#x3D;&#x3D; 0
                  UI32             The total duration of this track
                  IF Version &#x3D;&#x3D; 1
                  UI64
Pad	              UI1	            Padding, set to 0
Language          UI5 [3]         3字符代码指定语言（见ISO 639-2&#x2F;T），
                                  每个字符解释为0x60+（5位）代码，以生成一个ASCII字符
Reserved	        UI16	          Reserved. Set to 0



For more information, see section 8.4.2 of ISO&#x2F;IEC 14496-12:2008.
2.6.2. Handler Reference box

Box type: ‘hdlr’ 
Container: Media box (‘mdia’) 
Mandatory: Yes 
Quantity: One
处理程序引用（HDLR）框声明跟踪中媒体数据的性质。hdlr框应位于媒体信息（minf）框之前。
hdlr box
Field	          Type	          Comment
Header          BOXHEADER	      BoxType &#x3D; &amp;#x27;hdlr&amp;#x27; (0x68646C72)
Version         UI8             Expected to be 0
Flags           UI24            Reserved. Set to 0.
Predefined      UI32            Set to 0.
HandlerType     UI32            包含以下4cc值的整数：“vide”&#x3D;视频轨
                                &amp;#x27;soun&amp;#x27;&#x3D;音频轨&amp;#x27;data&amp;#x27;&#x3D;数据轨&amp;#x27;hint&amp;#x27;&#x3D;提示轨
                                其他轨道类型将被忽略。
Reserved        UI32 [3]        Set to 0.
Name            String          以空结尾的命名跟踪类型的utf-8字符串，用于调试。



For more information, see section 8.4.3 of ISO&#x2F;IEC 14496-12:2008.
2.7. Media Information box

Box type: ‘minf’ 
Container: Media box (‘mdia’) 
Mandatory: Yes 
Quantity: One
媒体信息（minf）框包含定义曲目媒体信息的框。
minf框包含一个媒体头框，其类型与曲目的handlerType相对应。
minf box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;minf&amp;#x27; (0x6D696E66)
Boxes         BOX [ ]         定义track媒体信息的任意框数



For more information, see section 8.4.3 of ISO&#x2F;IEC 14496-12:2008.
2.7.1. Video Media Header box

Box type: ‘vmhd’ 
Container: Media Information box (‘minf’)  
Mandatory: Yes for a video track, otherwise no.  
Quantity: One for a video track, otherwise zero.
视频媒体标题（vmhd）框包含视频媒体的一般信息，与所使用的编码无关。vmhd箱应首先放在其容器中。
vmhd box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;vmhd&amp;#x27; (0x766D6864)
Version       UI8             Expected to be 0
Flags         UI24            Set to 1.
GraphicsMode  UI16            视频轨的合成模式。默认值为0，这意味着复制现有图像。
OpColor       UI16 [3]        图形模式使用的一组3个RGB颜色值。默认值：（0，0，0）



For more information, see section 8.4.5.2 of ISO&#x2F;IEC 14496-12:2008.
2.7.2. Sound Media Header box

Box type: ‘smhd’ 
Container:Media Information box (‘minf’) 
Mandatory: Yes for an audio track, otherwise no.  
Quantity: One for an audio track, otherwise zero.
声音媒体标题框包含音频媒体的一般信息，与所使用的编码无关。SMHD盒应首先放在其容器中。
smhd box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;smhd&amp;#x27; (0x736D6864)
Version       UI8             Expected to be 0.
Flags         UI24            Set to 0.
Balance       SI8.8           固定点8.8号。将单声道音频曲目映射到立体声空间，如下所示：
                              -1.0&#x3D;完全向左
                              0 &#x3D;中心
                              1.0&#x3D;完全正确
Reserved      UI16            Set to 0.



For more information, see section 8.4.5.3 of ISO&#x2F;IEC 14496-12:2008.
2.7.3. Hint Media Header box

Box type: ‘hmhd’ 
Container: Media Information box (‘minf’) 
Mandatory: Yes for a hint track, otherwise no. 
Quantity: One for a hint track, otherwise zero.
提示媒体头（hmhd）框包含提示跟踪的一般信息，与所使用的协议无关。HMHD箱应首先放在其容器中。
hmhd box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;hmhd&amp;#x27; (0x686D6864)
Version       UI8             Expected to be 0.
Flags         UI24            Set to 0.
MaxPDUSize    UI16            Size (in bytes) of the largest PDU in hint stream.
AvgPDUSize    UI16            Average size (in bytes) of a PDU in entire presentation
MaxBitRate    UI32            Maximum rate (in bits per second) over an interval of 1 second.
AvgBitRate    UI32            Average rate (in bits per second) over entire presentation.
Reserved      UI32            Set to 0.



For more information, see section 8.4.5.4 of ISO&#x2F;IEC 14496-12.
2.7.4. Null Media Header box

Box type: ‘nmhd’ 
Container:Media Information box (‘minf’) 
Mandatory: Yes for metadata track, otherwise no. 
Quantity: Zero for video, audio, and hint tracks, otherwise, one.
空媒体标题（NMHD）框包含视频和音频以外的曲目的常规信息。NMHD箱应首先放置在其容器中。
nmhd box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;nmhd&amp;#x27; (0x6E6D6864)
Version       UI8             Expected to be 0.
Flags         UI24            Reserved. Set to 0



For more information, see section 8.4.5.5 of ISO&#x2F;IEC 14496-12.
2.7.5. Data Information box

Box type: ‘dinf’ 
Container: Media Information box (‘minf’) 
Mandatory: Yes 
Quantity: One
数据信息（DINF）框包含一个数据引用（DREF）框，用于声明媒体数据在某个磁道中的位置。DINF框应位于示例表（STBL）框之前。
dinf box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;dinf&amp;#x27; (0x64696E66)
Data          Reference box   BOX	Table of data references, used to locate media data.



For more information, see section 8.7.1 of ISO&#x2F;IEC 14496-12.
2.7.6. Sample Table box

Box type: ‘stbl’ 
Container:Media Information box (‘minf’) 
Mandatory: Yes 
Quantity: One
“示例表”（STBL）框包含一些框，用于定义组成轨迹的示例的属性。
STBL框中的框应按以下顺序排列：样本描述（STSD）、解码时间到样本（STTS）、样本到块（STSC）、样本大小（STSZ）、块偏移（STCO或CO64）。
样本描述（STSD）框及其包含的框在第2.8节样本描述框结构中进行了规定。
stbl box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;stbl&amp;#x27; (0x7374626C)
Boxes         BOX [ ]        定义轨道组成样本属性的任意数量的框。



For more information, see section 8.5 of ISO&#x2F;IEC 14496-12:2008.
2.7.6.1. Decoding Time to Sample box

Box type: ‘stts’ 
Container:Sample Table box (‘stbl’) 
Mandatory: Yes 
Quantity: One
解码采样时间（STTS）框定义采样表的采样映射时间
stts box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;stts&amp;#x27; (0x73747473)
Version       UI8             Expected to be 0
Flags         UI24            Reserved. Set to 0
Count         UI32            The number of STTSRECORD entries
Entries       STTSRECORD 
              [Count]         An array of STTSRECORD structures

Each STTSRECORD has the following format: 
STTSRECORD
SampleCount   UI32            此sttsrecord应用于的连续样本数
SampleDelta   UI32            Sample duration in TimeScale units defined in the mdhd box



For more information, see section 8.6.1.2 of ISO&#x2F;IEC 14496-12:2008.
2.7.6.2. Composition Time to Sample box

Box type: ‘ctts’ 
Container:Sample Table box (‘stbl’) 
Mandatory: No 
Quantity: One
合成时间到样本（CTTS）框定义了样本表的合成时间到样本映射
ctts box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;ctts&amp;#x27; (0x63747473)
Version       UI8             Expected to be 0
Flags         UI24            Reserved. Set to 0
Count         UI32            The number of CTTSRECORD entries
Entries       CTTSRECORD 
              [Count]         An array of CTTSRECORD structures

Each STTSRECORD has the following format: 
STTSRECORD
SampleCount     UI32          The number of consecutive samples that this CTTSRECORD applies to
SampleOffset    UI32          对于sampleCount字段指定的每个样本，此
                              字段包含一个正整数，它以MDHD框中定义的时间刻度单位指定解码时间的合成偏移量。



For more information, see section 8.6.1.3 of ISO&#x2F;IEC 14496-12:2008.
2.7.6.3. Sample to Chunk box

Box type: ‘stsc’ 
Container: Sample Table box (‘stbl’) 
Mandatory: Yes 
Quantity: One
“采样到块（STSC）”框定义媒体轨采样表中的采样到块映射。
stsc box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;stsc&amp;#x27; (0x73747363)
Version       UI8             Expected to be 0
Flags         UI24            Reserved. Set to 0
Count         UI32            The number of STSCRECORD entries
Entries       STSCRECORD 
              [Count]         An array of STSCRECORD structures

Each STTSRECORD has the following format: 
STTSRECORD
FirstChunk          UI32          The first chunk that this record applies to
SamplesPerChunk     UI32          The number of consecutive samples that this record applies to
SampleDescIndex     UI32          The sample description that describes this sequence of chunks



For more information, see section 8.7.4  of ISO&#x2F;IEC 14496-12:2008.
2.7.6.4. Sample Size box

Box type: ‘stsz’ 
Container:Sample Table box (‘stbl’) 
Mandatory: No 
Quantity: One
“样本大小”（STSZ）框指定样本表中每个样本的大小。
tkhd box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;stsz&amp;#x27; (0x7374737A)
Version       UI8             Expected to be 0
Flags         UI24            Reserved. Set to 0
ConstantSize  UI32            如果所有样本的大小相同，则此字段将使用该常量大小设置，否则为0。
SizeCount     UI32	          The number of samples in the track
SizeTable     IF ConstantSize &#x3D;&#x3D; 0
              UI32 [SizeCount]    样本量表。如果constantsize不是0，则此表为空



For more information, see section 8.7.3.2 of ISO&#x2F;IEC 14496-12:2008.
2.7.6.5. Chunk Offset box

Box type: ‘stco’ or ‘co64’
Container:Sample Table box (‘stbl’) 
Mandatory: Yes 
Quantity: One
每个样本表框应包含一个STCO或CO64类型的区块偏移框。STCO和CO64框为示例表中的每个块定义块偏移量。
stco and co64 boxes
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;stco&amp;#x27; (0x7374636F) or &amp;#x27;co64&amp;#x27; (0x636F3634)
Version       UI8             Expected to be 0
Flags         UI24            Reserved. Set to 0
OffsetCount   UI32            The number of offsets in the Offsets table
Offsets       IF BoxType &#x3D;&#x3D; &amp;#x27;stco’
              UI32 [OffsetCount]    文件中的绝对块偏移量表
              ELSE IF BoxType &#x3D;&#x3D; &amp;#x27;co64’
              UI64 [OffsetCount]



For more information, see section 8.7.5 of ISO&#x2F;IEC 14496-12:2008.
2.7.6.6. Sync Sample box

Box type: ‘stss’ 
Container:Sample Table box (‘stbl’) 
Mandatory: No 
Quantity: One
同步样本（STSS）框指定样本表中的哪些样本是同步样本。同步样本是可以安全查找的样本。如果轨迹是视频轨迹，则同步采样是不依赖任何其他帧的任何数据的关键帧或帧内帧。
如果样本表（STBL）框不包含STSS框，则轨道中的所有样本均应视为同步样本。
stss box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;stss&amp;#x27; (0x73747373)
Version       UI8             Expected to be 0
Flags         UI24            Reserved. Set to 0
SyncCount     UI32            The number of entries in SyncTable
SyncTable     UI32            同时也是同步样本的样本数表，按样本数的升序
              [SyncCount]



For more information, see section 8.6.2 of ISO&#x2F;IEC 14496-12:2008.
2.7.6.7. Independent and Disposable Samples box

Box type: ‘sdtp’ 
Container: Sample Table box (‘stbl’) or Track Fragment ‘traf 
Mandatory: No 
Quantity: One in each of the stbl and traf boxes
一个STBL或TRAF盒可分别包含一个独立的一次性样品盒（SDTP）。SDTP盒有助于实现诸如快进和随机访问等功能。sdtp框说明样本是否为i-picture，并提供有关样本中存在的帧依赖性和冗余编码的信息。表中的条目数与“样本大小”框中的sampleCount值相同。
stss box
Field	              Type	                  Comment
Header              BOXHEADER               BoxType &#x3D; &amp;#x27;sdtp&amp;#x27; (0x73647470)
Version             UI8                     Expected to be 0
Flags               UI24                    Reserved. Set to 0
SampleDependency    SAMPLEDEPENDENCY []     每个示例的依赖关系信息，到框的末尾

Each SAMPLEDEPENDENCY record has the following structure: 
SAMPLEDEPENDENCY
Reserved            UI2                     Reserved. Set to 0.
SampleDependsOn     UI2
                                            0 &#x3D; the sample dependency is unknown
                                            1 &#x3D; this sample does depend on others (not an I picture)
                                            2 &#x3D; this sample does not depend on others (I picture)
                                            3 &#x3D; reserved
SampleIsDependedOn	UI2
                                            0 &#x3D; the dependency of other samples on this sample is unknown
                                            1 &#x3D; other samples may depend on this one (not disposable)
                                            2 &#x3D; no other sample depends on this one (disposable)
                                            3 &#x3D; reserved
SampleHasRedundancy  UI2
                                            0 &#x3D; it is unknown whether there is redundant coding in this sample
                                            1 &#x3D; there is redundant coding in this sample
                                            2 &#x3D; there is no redundant coding in this sample
                                            3 &#x3D; reserved



当存在冗余编码时，“sampleDependson”的值仅对应于主编码。参数“sampleisdependedon”独立于冗余编码的存在。
For more information, see section 8.6.4 of ISO&#x2F;IEC 14496-12:2008.
2.8. Sample Description Box Structure
2.8.1. Sample Description box

Box type: ‘stsd’ 
Container:Sample Table box (‘stbl’) 
Mandatory: Yes 
Quantity: One
“示例说明”（STSD）框定义示例表的示例说明。STSD框可以包含一个曲目的多个描述，每个媒体类型包含一个描述。示例描述表提供了有关所用编码类型的详细信息，以及该编码所需的任何初始化信息。
表2显示了示例描述框中的层次结构。有关更多信息，请参见ISO&#x2F;IEC 14496-12第8.5.2节。
stsd box
Field	               Type	                   Comment
Header              BOXHEADER               BoxType &#x3D; &amp;#x27;stsd&amp;#x27; (0x73747364)
Version             UI8                     Expected to be 0
Flags               UI24                    Reserved. Set to 0
Count               UI32
Number of entries, one for each media type contained in the track
Descriptions        DESCRIPTIONRECORD
                    [Count]                 一组框，每个框对应包含在曲目中的媒体类型。



Each DESCRIPTIONRECORD shall be one of the following boxes:

   VisualSampleEntry, for HandlerType &#x3D;&#x3D; ‘vide’ [video track],

   AudioSampleEntry, for HandlerType &#x3D;&#x3D; ‘soun’ [audio track],

   MetaDataSampleEntry, for HandlerType &#x3D;&#x3D; ‘meta’ [timed metadata track],

   SampleEntry, for HandlerType &#x3D;&#x3D; ‘data’ [data track],

   HintSampleEntry, for HandlerType &#x3D;&#x3D; ‘hint’ [hint track], or

   AdobeMuxHintSampleEntry, for HandlerType &#x3D;&#x3D; ‘hint’ [Adobe Multiplexed Hint Track]
2.8.2. VisualSampleEntry box



Box type: one of the video media types specified in Section 1.8.2 Supported video types 
Container:Sample Table box (‘stsd’) 
Mandatory: Yes for video tracks 
Quantity: One for each video track
VisualSampleEntry框包含有关所用视频编码类型的详细信息，以及该编码所需的任何初始化信息。有关更多信息，请参见ISO&#x2F;IEC 14496-12:2008第8.5.2节。
VisualSampleEntry box
Field	                 Type	          Comment
Header                 BOXHEADER      BoxType is one of the video media types specified in 1.8.2
Reserved               UI8 [6]        Set to 0
DataReferenceIndex     UI16	          用于检索与使用此示例说明的示例关联的数据引用的索引。数据引用存储在数据引用（DREF）框中。
Predefined             UI16           Set to 0
Reserved               UI16            Set to 0
Predefined             UI32 [3]       Set to 0
Width                 UI16            Max visual width (in pixels) from codec
Height                UI16            Max visual height (in pixels) from codec
HorizResolution       UI16.16         图像像素&#x2F;英寸的分辨率，默认值为0x0048000（72 dpi）
VertResolution        UI16.16         图像像素&#x2F;英寸的分辨率，默认值为0x0048000（72 dpi）
Reserved              UI32            Set to 0
FrameCount            UI16            每个样本中存储多少帧，默认值1（每个样本一帧）
CompressorName        UI8 [32]        压缩机名称（仅供参考）。第一个字节设置为第一个字节后可显示数据的字节数。
Depth                 UI16            比特深度。默认值0x0018（不带字母的颜色）
Predefined            SI16            Set to -1
Boxes                 BOX [ ]         为媒体类型或加密指定的附加框


2.8.3. AudioSampleEntry box

Box type: one of the audio media types specified in Section 1.8.1 Supported audio types 
Container:Sample Table box (‘stsd’)  
Mandatory: Yes for audio tracks 
Quantity: One
audioSampleEntry框包含有关所用音频编码类型的详细信息，以及该编码所需的任何初始化信息。有关更多信息，请参见ISO&#x2F;IEC 14496-12:2008第8.5.2节。
AudioSampleEntry box
Field	                Type	          Comment
Header                BOXHEADER       BoxType is one of the audio media types specified in 1.8.1
Reserved              UI8 [6]         Set to 0
DataReferenceIndex    UI16            用于检索与使用此示例说明的示例关联的数据引用的索引。数据引用存储在数据引用（DREF）框中。
Reserved              UI32 [2]        Set to 0
ChannelCount          UI16            频道数。默认值为2。
                                      1 &#x3D; Mono
                                      2 &#x3D; Stereo
SampleSize            UI16            Size of sample. Default value is 16
Predefined            UI16            Set to 0
Reserved              UI16            Set to 0
SampleRate            UI16.16         Sampling rate, fixed point 16.16 number
Boxes                 BOX [ ]         Additional boxes as specified for the media type, or encryption


2.8.4. MetaDataSampleEntry box

Box type: depends on protocol used 
Container:Sample Table box (‘stsd’)  
Mandatory: Yes for metadata tracks 
Quantity: One for each metadata track
MetadataSampleEntry框包含有关所用元数据编码类型的详细信息，以及该编码所需的任何初始化信息。有关更多信息，请参见ISO&#x2F;IEC 14496-12:2008第8.5.2节。
MetaDataSampleEntry box
Field	                  Type	          Comment
Header                  BOXHEADER       BoxType depends on protocol used
Reserved                UI8 [6          Set to 0
DataReferenceIndex      UI16            用于检索与使用此示例说明的示例关联的数据引用的索引。数据引用存储在数据引用（DREF）框中。
Data                    UI8 [ ]         Additional contents as specified in ISO&#x2F;IEC 14496-12:2008


2.8.5. SampleEntry box

Box type: one of the data media types specified in Section1.8.3 Supported data types 
Container:Sample Table box (‘stsd’) 
Mandatory: Yes for data tracks 
Quantity: One for each data track
sampleEntry框包含有关所用编码类型的详细信息，以及该编码所需的任何初始化信息。有关更多信息，请参见ISO&#x2F;IEC 14496-12:2008第8.5.2节。
SampleEntry box
Field	                Type	          Comment
Header                BOXHEADER       BoxType is one of the data media types specified in Supported data types.
Reserved              UI8 [6]         Set to 0.
DataReferenceIndex	  UI16            用于检索与使用此示例说明的示例关联的数据引用的索引。数据引用存储在数据引用（DREF）框中。
Boxes	                BOX [ ]         Additional boxes as specified for the media type, or encryption



For more information, see section 8.aaaaaaaaaaaaaaaaaaaaaaaaaaa of ISO&#x2F;IEC 14496-12:2008.
2.8.6. HintSampleEntry box

Box type: ‘hint’ 
Container:Sample Table box (‘stsd’ 
Mandatory: Yes for hint tracks 
Quantity: One for each hint track
hintsampleEntry（提示）框包含正在使用的流协议的适当声明性数据以及提示轨的格式。有关更多信息，请参见ISO&#x2F;IEC 14496-12:2008第8.5.2节。
HintSampleEntry box
Field	               Type	            Comment
Header               BOXHEADER         一般来说，boxType取决于使用的协议。在F4V文件中，只允许使用“提示”框类型。
                                       保留的ui8[6]设置为0
DataReferenceIndex	  UI16            用于检索与使用此示例说明的示例关联的数据引用的索引。数据引用存储在数据引用（DREF）框中。
Data                  UI8 [ ]         Arbitrary number of bytes until end of box


2.8.7. Sample Descriptions for HTTP Streaming with Fragments
2.8.7.1.  Adobe Mux Hint Sample Entry box

Box type: ‘rtmp’ 
Container:Sample Table box (‘stsd’) 
Mandatory: Yes for HTTP streaming support with F4V fragments 
Quantity: One for the hint track for HTTP streaming support with F4V fragments
Adobemux提示示例条目（rtmp）框描述了使用f4v片段的HTTP流中使用的提示轨。见附录C.HTTP流：文件结构。提示轨包含ADobemuxhintsamples。
rtmp box
Field	                  Type	                Comment
Header                  BOXHEADER             BoxType &#x3D; &amp;#x27;rtmp&amp;#x27; (0x72746D70)
Reserved                UI8 [6]               Set to 0
DataReferenceIndex      UI16                  用于检索与使用此示例说明的示例关联的数据引用的索引。数据引用存储在数据引用（DREF）框中。
HintTrackVersion        UI16                  正在使用的提示跟踪定义的版本。设置为1。
HighestCompatibleVersion	UI16                指定与旧版本的兼容性。
MaxPacketSize           UI16                  最大的Adobe多路复用提示跟踪示例包大小（字节）。
AdditionalData          BOX [ ]               一个Adobe MUX提示处理框和零个或一个Adobe MUX时间偏移框


2.8.7.2. Adobe Mux Hint Process box

Box type: ‘amhp’ 
Container:Adobe Mux Hint Sample Entry (‘rtmp’) 
Mandatory: Yes 
Quantity: One
Adobe mux提示进程（amhp）框包含此曲目中使用的提示模式的描述
amhp box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;amhp&amp;#x27; (0x616D6870))
Version       UI8             Expected to be 0
Flags         UI24            Reserved. Set to 0
ModeCount     UI8             此框中支持的模式配置数。此值也是相应提示轨中支持的模式数。
ENTRIES       MuxHintProcessEntry
              [ModeCount]         An array of MuxHintProcessEntry

Each MuxHintProcessEntry has the following format:
MuxHintProcessEntry
HintTrackMode           UI8         条目对应的模式（示例或立即模式）。有关模式的更多信息，请参阅附录C.5 Adobe多路提示跟踪格式。
TrailerLengthField      UI1         1表示此模式的adobemuxhintsample中存在trailerLength字段。如果为0，则使用trailerDefaultSize。
LengthField             UI1         1表示此模式的ADobemuxhintsample中存在提示样本长度字段。模式&#x3D;&#x3D;2时，长度字段应为1。
ModeField               UI1         1表示此模式的ADobemuxhintsample中存在模式字段。当使用多种模式时，ModeField应为1。
ConstructorCountField   UI1         1表示此模式的adobEmuxHintSample中存在constructorCount字段。如果为0，则有一个构造函数
PacketCountField        UI1         1表示此模式的ADobemuxhintsample中存在packetcount字段。
Reserved                UI3         Set to 0
TrailerDefaultSize      UI8         提示示例有效负载之后拖车数据的默认大小（以字节为单位）。在没有TrailerLengthField时使用。



对于FLV兼容模式，trailerLengthField、lengthField、modeField、constructorCountField和packetCountField应为0。在这种情况下，使用即时节点提升提示模式。
2.8.7.3. Adobe Mux Time Offset box

Box type: ‘amto’ 
Container:Adobe Mux Hint Sample Entry (‘rtmp’) 
Mandatory: No 
Quantity: One
Adobe mux time offset（amto）框存储此文件中第一个提示示例的时间戳
amto box
Field	        Type	          Comment
Header        BOXHEADER       BoxType &#x3D; &amp;#x27;amto&amp;#x27; (0x616D746F)
TimeOffset    UI32            文件中第一个提示示例的时间戳。
                              这个时间戳是从累计的样本持续时间中导出的每个样本的表示时间中添加的偏移量。


2.8.8. Sample Descriptions for Protected Contents
2.8.8.1. Encrypted Video box

Box type: ‘encv’ 
Container:Sample Table box (‘stsd’) 
Mandatory: Yes for encrypted video tracks 
Quantity: One for each encrypted video track
如附件D.2所述，加密视频（Encv）盒应为原始视觉样本，并附上“sinf”盒。有关更多信息，请参见ISO&#x2F;IEC 14496-12:2008第8.12节。
2.8.8.2. Encrypted Audio box

Box type: ‘enca’ 
Container: Sample Table box (‘stsd’)  
Mandatory:  Yes for encrypted audio tracks 
Quantity: One for each encrypted audio track
如附录D.2所述，加密音频（ENCA）盒应为原始音频采样中心，并附上“sinf”盒。有关更多信息，请参见ISO&#x2F;IEC 14496-12:2008第8.12节。
2.8.8.3. Encrypted Data box

Box type: ‘encr’
&lt;
Container:Sample Table box (‘stsd’) 
Mandatory: Yes for encrypted video tracks 
Quantity: One for each encrypted video track
如附录D.2所述，加密数据（encr）箱应为原始样品中心，并附上“sinf”箱。有关更多信息，请参见ISO&#x2F;IEC 14496-12:2008第8.12节。
2.8.8.4. Protection Scheme Information box

Box type: ‘sinf’ 
Container:’encv’ or ‘enca’ Sample Description Entry for the protected track in ‘stsd’ box 
Mandatory: Yes 
Quantity: One
保护方案信息（sinf）框是一个容器框，其中包含了解所应用的加密转换及其参数以及查找密钥管理系统类型和位置等其他信息所需的所有信息。它还记录了媒体的原始（未加密）格式。它应附加到具有四个字符代码（“encv”、“enca”或“encr”）的任何示例条目中，以指示受保护的流。
sinf box
Field	                  Type	                 Comment
Header                  BOXHEADER             BoxType &#x3D; &amp;#x27;sinf&amp;#x27;
OriginalFormatBox       OriginalFormatBox     The format of the original sample
SchemeTypeBox           SchemeTypeBox         The DRM type. Required. (This is optional in ISO 14496-12)
SchemeInformationBox    SchemeInformationBox  DRM details. Required. (This is optional in ISO 14496-12)



For more information, see section 8.12 of ISO&#x2F;IEC 14496-12:2008.
2.8.8.5. Original Format box

Box type: ‘frma’ 
Container:Protection Scheme Information box (‘sinf’)  
Mandatory: Yes 
Quantity: One
“原始格式”（FRMA）框指定原始样本的格式，例如，如果流包含受保护的MPEG-4视觉材料，“MP4V”。
frma box
Field	                        Type	                  Comment
Header                        BOXHEADER               BoxType &#x3D; &amp;#x27;frma&amp;#x27;
UnencryptedDataFormat         UI32                    原始未转换样本条目的四字符代码



For more information, see section 8.12.2 of ISO&#x2F;IEC 14496-12:2008.
2.8.8.6.  Scheme Type box

Box type: ‘schm’ 
Container: Protection Scheme Information box (‘sinf’) 
Mandatory: Yes 
Quantity: One
方案类型（schm）框指定用于管理密钥和内容解密的DRM系统。由于媒体文件格式可能支持除Adobe的DRM以外的其他密钥管理系统，因此使用中的密钥管理系统应在schemetype字段中以四字符代码（4cc）表示。
schm box
Field	        Type	            Comment
Header        BOXHEADER         BoxType &#x3D; &amp;#x27;schm&amp;#x27;
Version       UI8               Shall be 1
Flags         UI24              Shall be 0 or 1
SchemeType    UI32              方案类型。应为“adkm”，表示内容使用Adobe的DRM系统进行保护。
SchemeVersion	UI32              Shall be 1
SchemeUri     IF Flags &#x3D;&#x3D; 1
              STRING
              Browser URI




For more information, see section 8.12.5 of ISO&#x2F;IEC 14496-12:2008.
2.8.8.7.  Scheme Information box

Box type: ‘schi’ 
Container:Protection Scheme Information box (‘sinf’) 
Mandatory: Yes 
Quantity: One
方案信息（Schi）框是一个包含DRM密钥&#x2F;权限管理系统特定信息的容器框。对于Adobe的DRM，此框应包括一个Adobe DRM密钥管理系统框。可能还有其他盒子。为了与其他DRM的互操作性，Adobe DRM密钥管理系统框可以位于方案信息框中的任何位置。
schi box
Field	                      Type	          Comment
Header                      BOXHEADER       BoxType &#x3D; &amp;#x27;schi&amp;#x27;
OtherDRMSpecificData        BOX [ ]         （可选）包含其他DRM特定密钥管理信息的框
SchemeSpecificData          AdobeDRMKMSBox    Adobe DRM密钥管理系统框，指定密钥管理信息
OtherDRMSpecificData        BOX [ ]         （可选）包含其他DRM特定密钥管理信息的框



For more information, see section 8.12.6 of ISO&#x2F;IEC 14496-12:2008.
2.8.8.8. Boxes for Adobe&#39;s Protection Scheme

以下框由Adobe定义，未在ISO 14496-12:2008中记录。
2.8.8.8.1.  Adobe DRM Key Management System box

Box type: ‘adkm’ 
Container:Scheme Information box (‘schi’) 
Mandatory: Yes 
Quantity: One
AdobeDRM密钥管理系统（ADKM）框指定加密和示例格式。
tkhd box
Field	         Type	             Comment
Header         BOXHEADER         BoxType &#x3D; &amp;#x27;adkm&amp;#x27;

Version        UI8               Shall be 1

Flags          UI24              Shall be 0

Header       AdobeDRMHeaderBox   AdobeDRM头框，指定如何检索密钥以及如何使用它来解密内容。
AUFormat	   AdobeDRMAUFormatBox	  Adobe DRM Access Unit格式框，指定每个示例预先准备的格式



2.8.8.8.2. Adobe DRM Header box

Box type: ‘ahdr’ 
Container:Adobe DRM Key Management System box (‘adkm’) 
Mandatory: Yes 
Quantity: One
AdobeDRM头（ahdr）框指定加密格式和方法的版本。
ahdr box
Field	             Type	                      Comment
Header             BOXHEADER                   BoxType &#x3D; &amp;#x27;ahdr&amp;#x27;
Version            UI8                         Shall be 1 or 2, indicating the version of the encryption format.
                                              1 &#x3D; FMRMS v1.x products.
                                              2 &#x3D; Flash Access 2.0 products.
                                              使用任一版本保护的内容均已存在，因此应用程序应能够同时使用两个版本的内容。
Flags              UI24                        Shall be 0      
StdEncryptionBox	StandardEncryptionParamsBox	标准加密参数框，包含用于加密样本的加密方法属于“标准加密”类型。
Signature          IF Version &#x3D;&#x3D; 1
                  AdobeSignatureBox           此文档中未描述AdobeSignatureBox


2.8.8.8.3. Standard Encryption Params box

Box type: ‘aprm’ 
Container: Adobe DRM Header box (‘ahdr’) 
Mandatory: Yes 
Quantity: One
标准加密参数（APRM）框包含加密方法“标准”的参数。
tkhd box
Field	                          Type	                  Comment
Header                          BOXHEADER               BoxType &#x3D; &amp;#x27;aprm&amp;#x27;
Version                         UI8                     Shall be 1
Flags                           UI24                    Shall be 0
EncInfoBox                      EncryptionInfoBox       加密信息框，指定用于加密样本的加密算法
KeyInfoBox                      KeyInfoBox              密钥信息框，指定如何检索用于解密示例的密钥


2.8.8.8.4. Encryption Information box

Box type: ‘aeib’ 
Container:标准加密参数框(‘aprm’) 
Mandatory: Yes 
Quantity: One
加密信息（AEIB）框指定用于加密样本的加密算法。
aeib box
Field	                        Type	                  Comment
Header                          BOXHEADER               BoxType &#x3D; &amp;#x27;aeib&amp;#x27;
Version                         UI8                     Shall be 1
Flags                           UI24                    Shall be 0
EncryptionAlgorithm             STRING                  加密算法。应为“aes-cbc”，说明所使用的加密为“aes-cbc”，并根据RFC 2630进行填充。
KeyLength                       UI8                     加密&#x2F;解密算法的密钥长度（字节）。应为16（即128位）


2.8.8.8.5. Key Information box

Box type: ‘akey’ 
Container:Standard Encryption Params box (‘aprm’) 
Mandatory: Yes 
Quantity: One
密钥信息（akey）框包含用于检索用于解密样本的密钥的信息。
这些框中包含的条目的详细信息以及DRM客户机用于检索密钥的机制超出了本规范的范围。
akey box
Field	              Type	                         Comment
Header                BOXHEADER                      BoxType &#x3D; &amp;#x27;akey&amp;#x27;
Version               UI8                            Shall be 1
Flags                 UI24                           Shall be 0
Params      IF AdobeDRMHeaderBox.Version &#x3D;&#x3D; 1  
                APSParamsBox                        本文件中未对apsparamsbox进行描述，因为它将不再由符合要求的应用程序生成。
            ELSE
                FMRMSv2ParamsBox


2.8.8.8.6. Flash Access Params box

Box type: ‘flxs’ 
Container:Key Info box (‘akey’) 
Mandatory: Yes, if AdobeDRMHeaderBox.Version &#x3D;&#x3D; 2, else No 
Quantity: One, if AdobeDRMHeaderBox.Version &#x3D;&#x3D; 2, else Zero
flash access params（flxs）框包含用于检索用于解密样本的密钥的信息。
flxs box
Field	              Type	         Comment
Header                BOXHEADER      BoxType &#x3D; &amp;#x27;flxs&amp;#x27;
FmrmsV2Metadata       STRING        DRM客户端用于检索解密密钥的base64编码元数据


2.8.8.8.7. Adobe DRM Access Unit Format box

Box type: ‘adaf’ 
Container:Key Info box (‘adkm’) 
Mandatory: Yes 
Quantity: One
访问单元格式（ADAF）框指定放置在样本上的头的格式。
tkhd box
Field	              Type	        Comment
Header                BOXHEADER     BoxType &#x3D; &amp;#x27;tkhd&amp;#x27;
Version               UI8           Shall be 1
Flags                 UI24          Shall be 0
SelectiveEncryption   UI1           指示使用选择性加密。应为1。
                                    1&#x3D;启用选择性加密，即只加密部分样本，而不是全部样本。
                                    0&#x3D;关闭选择性加密，并且对所有样本进行加密
Reserved              UI7           Shall be 0
Reserved              UI8           Shall be 0
IVLength              UI8           初始化向量的大小（字节）。该长度应与所用算法一致。应为16（128位）


2.9.  Movie Extends box

Box type: ‘mvex’ 
Container:Movie box (‘moov’) 
Mandatory: No 
Quantity: One
如果f4v文件包含片段，则电影（moov）框包含一个电影扩展（mvex）框，否则没有mvex框。对于碎片，一个F4V文件应包含一个且仅一个MVEX盒。mvex框告诉读者此文件可能包含电影片段（moof）框。
mvex box
Field	        Type	          Comment
Header          BOXHEADER         BoxType &#x3D; &amp;#x27;mvex&amp;#x27; (0x6D766578)
Boxes           BOX [ ]           定义片段的轨迹默认值的框



For more information, see section 8.8.1 of ISO&#x2F;IEC 14496-12:2008.
2.9.1. Movie Extends Header box

Box type: ‘mehd’ 
Container:Movie Extends box (‘mvex’) 
Mandatory: No 
Quantity: One
Movie扩展头（mehd）框提供碎片Movie的持续时间。如果Movie扩展（mvex）框不包含mehd框，则通过检查所有片段来计算总持续时间。
mehd box
Field	                 Type	          Comment
Header                   BOXHEADER         BoxType &#x3D; &amp;#x27;mehd&amp;#x27; (0x6D766578)
Version                  UI8               Either 0 or 1
Flags                    UI24              Reserved. Set to 0
FragmentDuration        If Version&#x3D;&#x3D;0
                            UI32            在mvhd框中定义的时间刻度单位中最长轨迹的持续时间
                        If Version &#x3D;&#x3D;1
                            UI64



For more information, see section 8.8.2 of ISO&#x2F;IEC 14496-12:2008.
2.9.2. Track Extends box

Box type: ‘trex’ 
Container:Movie Extends box (‘mvex’) 
Mandatory: Yes 
Quantity: One for each track in the Movie box
轨迹延伸”（Trex）框定义电影片段的默认值。
trex box
Field	                            Type	            Comment
Header                              BOXHEADER           BoxType &#x3D; &amp;#x27;trex&amp;#x27; (0x74726578)
Version                             UI8                 Expected to be 0
Flags                               UI24                Reserved. Set to 0
TrackID                             UI32                Identity of the associated track
DefaultSampleDescriptionIndex       UI32                要在跟踪片段中使用的默认sampleDescriptionIndex
DefaultSampleDuration               UI32                在跟踪片段中使用的默认sampleduration
DefaultSampleSize                   UI32                在track片段中使用的默认sampleSize
DefaultSampleFlags                  SAMPLEFLAGS         在跟踪片段中使用的默认sampleFlags

Each SAMPLEFLAGS record has the following layout: 
SAMPLEFLAGS

Reserved                            UI6                 Reserved. Set to 0.
SampleDependsOn                     UI2                 0 &#x3D; 示例依赖项未知
                                                        1 &#x3D; 此示例依赖于其他示例（不是i图片）
                                                        2 &#x3D; 此示例不依赖于其他示例（图片）
                                                        3 &#x3D; reserved
SampleIsDependedOn                  UI2                 0 &#x3D; 其他示例对该示例的依赖性未知
                                                        1 &#x3D; 其他样品可能依赖于此样品（非一次性样品）
                                                        2 &#x3D; 其他样品不依赖于此样品（一次性）
                                                        3 &#x3D; reserved
SampleHasRedundancy                 UI2                 0 &#x3D; 尚不清楚此示例中是否存在冗余编码
                                                        1 &#x3D; 此示例中存在冗余编码
                                                        2 &#x3D; 此示例中没有冗余编码
                                                        3 &#x3D; reserved
SamplePaddingValue                  UI3                 Reserved. Set to 0
SampleIsDifferenceSample            UI1                 0 &#x3D; 密钥或同步示例
                                                        1 &#x3D; 非键或非同步示例
SampleDegradationPriority           UI16                Reserved. Set to 1.



For more information, see section 8.8.3 of ISO&#x2F;IEC 14496-12:2008.
2.10. User Data box

Box type: ‘udta’ 
Container:Movie box (‘moov’) or Track box (‘trak’) 
Mandatory: No 
Quantity: One at each movie level or track level
用户数据（udta）框包含在电影（moov）框或曲目（trak）框中。最多，每个电影级别或曲目级别可能会出现一个UDTA框。UDTA框应最后放置在其包含框中。
UDTA框声明有关包含框及其数据（表示或跟踪）的自由格式用户信息。Flash播放器忽略UDTA框的内容。
udta box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;udta&amp;#x27; (0x75647461)
UserData        BOX [ ]             具有自由格式用户数据的任意数量的框



For more information, see section 8.10.1 of ISO&#x2F;IEC 14496-12:2008.
2.11. F4V Boxes for HTTP Streaming
2.11.2. Fragment Random Access box

Box type: ‘afra’ 
Container:File 
Mandatory: Yes for HTTP streaming support with F4V fragments, otherwise no. 
Quantity: One per fragment for HTTP streaming support with F4V fragments, otherwise zero.
片段随机访问（AFRA）框为一个或多个片段提供随机访问信息。
对于带有F4V片段的HTTP流支持，F4V文件可以为每个片段包含一个AFRA框。AFRA盒应位于片段的媒体数据（MDAT）和电影片段（MOOF）盒之前。AFRA框可用于查找包含给定时间内最近随机访问样本的F4V文件中的确切点。
AFRA框与给定片段关联（这里称为“关联片段”）。AFRA框还提供对同一段或不同段中其他片段中信息的随机访问。
AFRA框包含条目数组。每个条目包含随机访问样本的位置和表示时间。如果随机访问样本不在相关片段中，则条目还提供以下信息：
-段识别信息
-片段识别信息
-从包含段的开始到与此随机数关联的“afra”框的字节偏移量
接入点
-从关联的“afra”框到示例的字节偏移量

片段中的每个随机访问样本不一定都有数组条目。AFRA盒的缺失并不意味着所有样本都是同步样本。“trun”、“traf”和“trex”中的随机访问信息设置适当，而不考虑此框的存在。

afra box
Field	                 Type	            Comment
Header                   BOXHEADER           BoxType &#x3D; &amp;#x27;afra&amp;#x27; (0x61667261)
Version                  UI8                 Either 0 or 1
Flags                    UI24                Reserved. Set to 0
LongIDs                  UI1                 控制全局框架项的段和片段字段的大小。
LongOffsets              UI1                 控制AfraEntry的偏移字段的大小。还控制全局框架项的afraOffset和offsetFromAfra字段的大小。
GlobalEntries            UI1                 值1表示存在GlobalRycount
Reserved                 UI5                 Set to 0
TimeScale                UI32                每秒在AfraEntry和GlobalAfraEntry的时间字段中使用的时间单位数。
EntryCount               UI32                LocalAccessEntries中的条目数
LocalAccessEntries      AFRAENTRY
                        [EntryCount]         随机访问此片段中的点。此数组不一定包含此片段中每个随机访问样本的条目。
GlobalEntryCount        IF GlobalEntries &#x3D;&#x3D; 1 
                            UI32            GlobalAccessEntries中的条目数。如果globalentries&#x3D;&#x3D;0，则此字段不存在，globalentrycount为0。
GlobalAccessEntries     GLOBALAFRAENTRY
                        [GlobalEntryCount]  随机访问此片段之外的点。

Each AFRAENTRY points to a sample within this fragment, and has the following format: 
AFRAENTRY

Time                    UI64                随机访问样本的表示时间，以时间刻度单位表示。
Offset              IF LongOffsets &#x3D;&#x3D; 0
                        UI32                从片段随机访问框开始到样本的字节偏移量
                    ELSE
                        UI64
Each GLOBALAFRAENTRY points to a sample outside this fragment, and has the following format: 
GLOBALAFRAENTRY

Time                    UI64                 随机访问样本的表示时间，以时间刻度单位表示。
Segment             IF LongIDs &#x3D;&#x3D; 0
                        UI16                包含此随机接入点的段的数目
                    ELSE
                        UI32
Fragment            IF LongIDs &#x3D;&#x3D; 0
                        UI16                包含此随机访问点的片段的数目
                    ELSE
                        UI32
AfraOffset          IF LongOffsets &#x3D;&#x3D; 0
                        UI32                从包含段开始到与此随机接入点关联的AFRA框的字节偏移量。
                    ELSE
                        UI64
OffsetFromAfra	IF LongOffsets &#x3D;&#x3D; 0
                        UI32                从关联的AFRA框到样本的字节偏移量
                    ELSE
                        UI64


2.11.2. Bootstrap Info box

Box type: ‘abst’ 
Container:File 
Mandatory: Yes for HTTP streaming support with F4V fragments, otherwise no. 
Quantity: One or more for HTTP streaming support with F4V fragments, otherwise zero.
引导信息（abst）框包含引导媒体演示URL从媒体客户端向HTTP服务器请求RFC1630所需的信息。媒体演示可以是现场演示，也可以是视频点播。此框包含有关服务器、电影和段信息的基本信息。它还包含一个或多个段运行表和段运行表。
在HTTP流段中，abt框是可选的，位于电影（moov）框之前。在HTTP流片段中，ABT框是必需的。有关HTTP流所需的框和结构的描述，请参阅附录C.HTTP流：文件结构。
abst box
Field	                Type	            Comment
Header                  BOXHEADER           BoxType &#x3D; &amp;#x27;abst&amp;#x27; (0x61627374)
Version                 UI8                 Either 0 or 1
Flags                   UI24                Reserved. Set to 0
BootstrapinfoVersion    UI32                引导信息的版本号。设置更新字段后，bootstrapinfoversion指示正在更新的版本号。
Profile                 UI2                 指示它是命名访问（0）还是范围访问（1）配置文件。为将来的配置文件保留一个位。
Live                    UI1                 指示媒体演示文稿是否为实时（1）。
Update                  UI1                 指示此表是引导程序框或文件的完整版本（0）还是以前定义（发送）的完整版本的更新（1）。
                                            更新不是完整的替换。它们只能包含更改的元素。服务器仅在引导信息更改时发送更新。
                                            更新应用于具有相同bootstrapinfoversion编号的完整版本。
                                            同一个bootstrapinfoversion号可能有多个更新。
                                            如果服务器发送多个更新，这些更新将应用于具有相同bootstrapinfoversion号的完整版本。
                                            每个更新都包括以前对同一个bootstrapinfoversion的所有更新。对于单个完整版本的多个更新，
                                            最新更新是基于当前的MediaTime确定的。

Reserved                UI4                 Reserved, set to 0
TimeScale               UI32                每秒的时间单位数。字段CurrentMediaTime使用此值表示准确的时间。通常，该值为1000，以毫秒为单位。

CurrentMediaTime        UI64                媒体演示文稿中最新可用片段的时间刻度单位时间戳。这个时间戳用于请求正确的片段号。
                                            CurrentMediaTime可以是总持续时间。对于非活动的媒体演示文稿，当前MediaTime可以为0。

SmpteTimeCodeOffset     UI64                当前媒体时间与smpte时间代码之间的偏移量，已转换为毫秒。
                                            此偏移量不是以时间刻度单位表示的。未使用时，此字段为零。
                                            服务器使用smpte时间代码模块24小时使偏移量为正。

MovieIdentifier         STRING              此演示文稿的标识符。标识符是以空结尾的UTF-8字符串。例如，它可以是URL中的文件名或路径名。见
                                            附录C.4 URL结构供使用

ServerEntryCount        UI8                 ServerEntryTable条目数。最小值为0。
ServerEntryTable        SERVERENTRY
                        [ServerEntryCount]  按优先顺序降序排列的服务器URL
QualityEntryCount       UI8                 QualityEntryTable条目数，也就是可用的质量级别数。最小值为0。
                                            可用的质量级别包括，例如，多比特率文件或技巧文件。

QualityEntryTable       QUALITYENTRY
                        [QualityEntryCount] 从高质量到低质量的质量文件参考
DrmData                 STRING              以NULL或NULL结尾的UTF-8字符串。此字符串包含数字版权管理元数据。
                                            加密文件使用此元数据获取解密和播放所需的密钥和许可证。
MetaData                STRING              包含元数据的以NULL或NULL结尾的UTF-8字符串
SegmentRunTableCount    UI8                 SegmentRunTableEntries中的条目数。最小值为1。通常，一个表包含所有段运行。
                                            但是，此计数提供了为每个质量级别（或技巧文件）单独定义段运行的灵活性。
SegmentRunTableEntries  SegmentRunTable
                    [SegmentRunTableCount]  Array of SegmentRunTable elements
FragmentRunTableCount       UI8             fragmentruntable中的条目数-条目数。最小值为1。
FragmentRunTableEntries   FragmentRunTable
                    [FragmentRunTableCount]     碎片可运行元素数组

Each SERVERENTRY has the following format: SERVERENTRY

ServerBaseURL           STRING               该服务器上此演示文稿的服务器基URL。该值是以空结尾的utf-8字符串，没有尾随的“&#x2F;”。

Each QUALITYENTRY has the following format: QUALITYENTRY

QualitySegmentUrlModifier   STRING	         用于构造该质量媒体的正确URL的质量（段）文件的名称。
                                            该值是以空结尾的utf-8字符串，可以选择带有尾随的“&#x2F;”。


2.11.2.1. Segment Run Table box

Box type: ‘asrt’ 
Container:Bootstrap Info box (‘abst’)  
Mandatory: Yes 
Quantity: One or more
段运行表（ASRT）框可用于定位包含特定片段的段。可能有几个ASRT箱，每个箱的质量等级不同。
ASRT框使用压缩编码：
-段运行表可以表示几个质量级别的段运行。
-段运行表是紧凑编码的。每个条目给出一段运行的第一个段号
同样数量的碎片。具有相同片段计数的片段的计数可以通过从下一个条目中的第一个片段号减去此条目中的第一个片段号来计算。
asrt box
ASRT框使用压缩编码：
-段运行表可以表示几个质量级别的段运行。
-段运行表是紧凑编码的。每个条目给出一段运行的第一个段号
同样数量的碎片。具有相同片段计数的片段的计数可以通过从下一个条目中的第一个片段号减去此条目中的第一个片段号来计算。
Field                                Type	                    Comment
Header                               BOXHEADER                  BoxType &#x3D; &amp;#x27;asrt&amp;#x27; (0x61737274)
Version                              UI8                        Either 0 or 1
Flags                                UI24                       定义了以下值：
                                                                0&#x3D;整张桌子。
                                                                1&#x3D;此表中的记录是对先前定义的段运行表的更新（或要附加的新条目）。
                                                                当此标志为1时，包含引导信息框中的更新标志应为1。
QualityEntryCount                    UI8                                 后面的QualitySegmentUrlModifier（质量级别引用）的数量。如果为0，
                                                                则此段运行表适用于所有质量级别，引导信息框中只能有一个段运行表框。

QualitySegmentUrlModifiers           STRING
                                [QualityEntryCount]             此表应用于的质量级别的名称数组。名称是以空结尾的UTF-8字符串。
                                                                数组应是引导信息（abt）框中可输入的质量的子集。
                                                                这些名称不应出现在引导程序信息框中的任何其他段运行表中。
SegmentRunEntryCount                 UI32                       此SegmentRunEntryTable中的项数。最小值为1。
SegmentRunEntryTable                 SEGMENTRUNENTRY            段运行项数组
                        [           SegmentRunEntryCount ]

Each SEGMENTRUNENTRY has the following format: SEGMENTRUNENTRY

FirstSegment                         UI32                        包含相同数量片段的段运行中第一段的标识号。
                                                                 对应于下一个segmentrunentry中第一个segment的段将终止此运行。
FragmentsPerSegment                  UI32                        此运行中每个段中的片段数


2.11.2.2. Fragment Run Table box

Box type: ‘afrt’ 
Container:Bootstrap Info box (‘abst’)  
Mandatory: Yes 
Quantity: One or more
片段运行表（AFRT）框可用于查找包含与给定时间对应的样本的片段。
片段由URL方案单独标识。碎片的持续时间和样本数量都可能不同。碎片的持续时间储存在AFRT箱中。
AFRT盒使用压缩编码：
-片段运行表可以表示多个质量级别的片段。
-片段运行表是紧凑编码的，因为每个条目都给出了运行的第一个片段号。
具有相同持续时间的片段。可以通过从下一个条目中的第一个片段号减去此条目中的第一个片段号来计算具有相同持续时间的片段数。
一个引导信息框中可能有几个片段运行表框，每个框用于不同的质量级别。
asrt box
Field	                            Type	                    Comment
Header                              BOXHEADER                   BoxType &#x3D;&amp;#x27;afrt&amp;#x27; (0x61667274)
Version                             UI8                         Either 0 or 1
Flags                               UI24                        定义了以下值：
                                                                0&#x3D;A full table
                                                                1&#x3D;此表中的记录是以前定义的片段运行表的更新（或要追加的新条目
                                                                当此标志为1时，包含引导信息框中的更新标志应为1。
TimeScale                           UI32                        每秒在FirstFragmentTimestamp和FragmentDuration字段中使用的时间单位数。通常，值为1。
QualityEntryCount                   UI8                         后面的QualitySegmentUrlModifier（质量级别引用）的数量。
                                                                如果为0，则此片段运行表适用于所有质量级别，并且引导信息框中只能有一个片段运行表框。
QualitySegmentUrlModifiers          STRING
                                [QualityEntryCount]             此表应用于的质量级别的名称数组。名称是以空结尾的UTF-8字符串。
                                                                数组应是引导信息（abt）框中可输入的质量的子集。
                                                                这些名称不应出现在引导程序信息框中的任何其他片段运行表中。

FragmentRunEntryCount               UI32                        此FragmentRunEntryTable中的项数。最小值为1。
FragmentRunEntryTable               FRAGMENTRUNENTRY
                                [FragmentRunEntryCount]         片段运行项数组
每个fragmentrunentry的格式如下：fragmentrunentry

FirstFragment                       UI32                        具有相同持续时间的此片段运行中第一个片段的标识号。
                                                                与下一个fragmentrunentry中的第一个fragment对应的片段将终止此运行。
FirstFragmentTimestamp              UI64                        第一个片段的时间戳，以时间刻度单位表示。
                                                                此字段确保片段时间戳可以在开始时准确表示。
                                                                它还可以确保在由于持续时间准确性或时间戳不连续而发生偏移时同步时间戳。
FragmentDuration                    U32                         此运行中每个片段的持续时间（以时间刻度单位表示）
DiscontinuityIndicator          IF FragmentDuration &#x3D;&#x3D; 0
                                    UI8                         表示时间戳和&#x2F;或片段号中的不连续。此字段还用于标识（实时）演示文稿的结尾。
                                                                定义了以下值：
                                                                0&#x3D;演示结束。
                                                                1&#x3D;片段编号的不连续性。
                                                                2&#x3D;时间戳的不连续性。
                                                                3&#x3D;时间戳和片段编号的不连续性。
                                                                保留所有其他值。
                                                                在现场场景中，在带内发出演示结束的信号非常有用。
                                                                表示中的间隔被表示为零持续时间片段的运行，同时具有片段数和时间戳不连续性。
                                                                片段数不连续性对于片段编号方案中没有不连续性的跳变信号很有用


2.12. Movie Fragment box

Box type: ‘moof’ 
Container: File 
Mandatory: Yes for HTTP streaming support with F4V fragments, otherwise no 
Quantity: One per fragment for HTTP streaming support with F4V fragments, otherwise zero.
Movie片段（MOOF）框提供特定于片段的信息，否则这些信息将出现在媒体（MOOV）框中。MOOF箱应按顺序排列。
moof box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;moof&amp;#x27; (0x6D6F6F66)
Boxes           BOX [ ]             定义示例结构的多个框



For more information, see section 8.8.4 of ISO&#x2F;IEC 14496-12:2008.
2.12.1. Movie Fragment Header box

Box type: ‘mfhd’ 
Container: Movie Fragment box (‘moof’) 
Mandatory: Yes 
Quantity: One
Movie片段头（mfhd）框包含序列号，用于验证文件的完整性。
mfhd box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;mfhd&amp;#x27; (0x6D666864)
Version         UI8                 Expected to be 0
Flags           UI24                Reserved. Set to 0
SequenceNumber  UI32                从1开始，并按文件中每个电影片段的出现顺序递增。



For more information, see section 8.8.5 of ISO&#x2F;IEC 14496-12:2008.
2.12.2. Track Fragment box

Box type: ‘traf’ 
Container: Movie Fragment box  
Mandatory: No 
Quantity: Zero or more
轨迹片段（traf）框对应于f4v文件中的轨迹。每个交通箱包含零个或多个轨道运行，其中包括该轨道的连续运行。
traf box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;traf&amp;#x27; (0x74726166)
Boxes           BOX [ ]             定义片段中轨道运行的任意数量的框



For more information, see section 8.8.6 of ISO&#x2F;IEC 14496-12:2008.
2.12.2.1. Track Fragment Header box

Box type: ‘tfhd’ 
Container: Track Fragment box  
Mandatory: Yes 
Quantity: One
“轨迹片段头”（tfhd）框设置用于影片片段中样本运行的信息和默认值。每个电影片段可以向每个曲目添加零个或多个片段，而一个曲目片段可以添加零个或多个连续运行的示例。
tfhd box
Field	                     Type	            Comment
Header                       BOXHEADER           BoxType &#x3D; &amp;#x27;tfhd&amp;#x27; (0x74666864)
Version                      UI8                 Expected to be 0
Flags                        UI24                以下标志可用于任何组合：
                                                 0x000001&#x3D;基础数据偏移量存在
                                                 0x000002&#x3D;样本描述存在
                                                 0x000008&#x3D;默认样本持续时间存在
                                                 0x0000010&#x3D;默认样本大小存在
                                                 0x0000020&#x3D;默认样本标志存在
                                                 0x10000&#x3D;持续时间为空：没有样本用于提供的持续时间
                                                 TFHD框或Trex框中的默认采样持续时间。见下表注释
TrackID                      UI32                在“Track标题”框中指定的关联Track的标识
BaseDataOffset               IF Flags 
                             &amp; 0x000001 &#x3D;&#x3D; true
                                UI64            可选的。计算每个轨道运行中的数据偏移量时要使用的基准偏移量。默认值在表下面定义。
SampleDescriptionIndex      IF Flags
                            &amp; 0x000002 &#x3D;&#x3D; true
                                UI32            可选的。要在此片段中使用的sampleDescriptionIndex。
                                                这将覆盖该片段的trex框中的默认sampleDescriptionIndex。
DefaultSampleDuration       IF Flags 
                            &amp; 0x000008 &#x3D;&#x3D; true
                                UI32            可选的。此片段中要使用的默认sampleduration。
                                                这将覆盖该片段的Trex框中的默认采样持续时间。
DefaultSampleSize           IF Flags
                            &amp; 0x000010 &#x3D;&#x3D; true
                                UI32            可选的。此片段中使用的默认sampleSize。这将覆盖该片段的trex框中的默认sampleSize。
DefaultSampleFlags          IF Flags 
                            &amp; 0x000020 &#x3D;&#x3D; true
                                SAMPLEFLAGS     可选的。此片段中要使用的默认sampleFlags。这将覆盖该片段的trex框中的默认sampleFlags。



basedataoffset：如果此处未提供值，则电影片段中第一个曲目的默认值是封闭电影片段框的第一个字节的位置。对于后续的跟踪片段，默认值是由前面的片段定义的数据的结尾。以这种方式“继承”其偏移量的片段都应使用相同的数据引用，即，这些轨迹的数据应在同一个文件中。

0x010000持续时间为空：如果一个F4V文档在MOOV框中有编辑列表，并且具有空的持续时间片段，则认为该文档格式不正确。

For more information, see section 8.8.7 of ISO&#x2F;IEC 14496-12:2008.
2.12.2.2. Track Fragment Run box

Box type: ‘trun’ 
Container: Track Fragment box (‘traf’) 
Mandatory: No 
Quantity: Zero or more
跟踪片段运行（trun）框定义跟踪的连续样本集。如果在“轨迹碎片框”（traf）框中设置了“持续时间为空”标志，则没有“躯干框”。
trun box
Field	                    Type	            Comment
Header                      BOXHEADER           BoxType &#x3D; &amp;#x27;trun&amp;#x27; (0x7472756E)
Version                     UI8                 Expected to be 0
Flags                       UI24                下列标志可用于任何组合，但0x000004和0x000400除外：
                                                0x000001&#x3D;存在数据偏移量
                                                0x000004&#x3D;存在第一个样本标志
                                                0x000100&#x3D;存在样本持续时间
                                                0x000200&#x3D;存在样本大小
                                                0x000400&#x3D;存在样本标志
                                                0x00800&#x3D;存在样品组成时间偏移
SampleCount                 UI32                sampleInformation中的条目数
DataOffset                  IF Flags 
                        &amp; 0x000001 &#x3D;&#x3D; true
                            SI32                可选的。要添加到在tfhd框中定义的数据偏移量的值。默认值在表下面定义。
FirstSampleFlags            IF Flags 
                        &amp; 0x000004 &#x3D;&#x3D; true
                            SAMPLEFLAGS         可选的。仅用于此Trun Box中描述的集合的第一个样本的标志。见下表文本。
SampleInformation           SampleInformationStructure
                            [SampleCount]       结构中的所有字段都是可选的

每个sampleInformationstructure记录都有以下布局：sampleInformationstructure
SampleDuration              IF Flags 
                        &amp; 0x000100 &#x3D;&#x3D; true
                            UI32                可选的。每个采样的持续时间，以媒体头中为此曲目定义的时间刻度单位为单位
                                                如果不存在，则使用默认值。
SampleSize                  IF Flags 
                        &amp; 0x000200 &#x3D;&#x3D; true
                            UI32                可选的。每个样本的大小。如果不存在，则使用默认值。
SampleFlags                 IF Flags 
                        &amp; 0x000400 &#x3D;&#x3D; true
                            SAMPLEFLAGS         可选的。每个样本的sampleFlags。如果不存在，则使用默认值。
SampleCompositionTimeOffset	IF Flags 
                        &amp; 0x000800 &#x3D;&#x3D; true
                            UI32                可选的。每个样本的合成时间偏移。如果不存在，则使用默认值。



data offset：如果不存在数据偏移量，则此运行的数据从两个位置之一开始。如果此运行是跟踪片段中的第一个，则它从由跟踪片段头定义的基础数据偏移量开始。否则，它会在上一次运行的数据之后立即启动。
FirstSampleFlags：仅覆盖第一个示例的默认标志。这使得记录一组帧成为可能，其中第一个帧是键，其余的帧是不同的帧，而不为每个样本提供显式标志。设置此标志时，不应出现示例标志。
For more information, see section 8.8.8 of ISO&#x2F;IEC 14496-12:2008.
2.13.  Media Data box

Box type: ‘mdat’ 
Container: File 
Mandatory: Yes 
Quantity: One
媒体数据（mdat）框包含f4v文件的媒体数据负载。所有视频示例、音频示例、数据示例以及提示轨和示例都包含在mdat框中。请参见1.8支持的媒体类型。
mdat框与media（moov）框一起出现在f4v文件的顶层。
无法单独理解mdat框，这也是文件中必须存在moov框的原因。
mdat box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;mdat&amp;#x27; (0x6D646174)
Payload         UI8 [ ]             媒体数据字节，其结构在文件的MOOV框中定义。



For more information, see section 8.2.2 of ISO&#x2F;IEC 14496-12:2008.
2.13.1.  Hint Track Samples for HTTP Streaming

mdat框包含用于包含f4v片段的HTTP流的提示轨。提示轨包含ADobemuxhintsamples。Adobemux提示示例输入框（rtmp）描述了提示轨迹。
2.13.1.1. AdobeMuxHintSample

一组adobemuxhintsamples组成了一个提示跟踪，它采用Adobe多路提示跟踪格式。Adobemuxhintsample具有以下布局：
AdobeMuxHintSample
Field	        Type	                    Comment
PacketCount     IF PacketCountField &#x3D;&#x3D; 1
                UI8                         此adobemuxhintsample中的adobemuxPacket条目数。
                                            当packetCountField&#x3D;&#x3D;0时，adobmuxPackets是自描述的，可以隐式确定数字。
Packets         AdobeMuxPacket
                [PacketCount]               AdobEmuxPacket元素数组


2.13.1.2. AdobeMuxPacket

AdobEmuxPacket具有以下布局。EncryptionHeader及其之前的部分与E.4.1节中定义的flvtag中的相应部分相同。
AdobeMuxPacket
Field	                    Type	                    Comment
Reserved                    UI2                         Reserved for FMS, should be 0
Filter                      UI1                         指示是否筛选数据包。
                                                        0&#x3D;不需要预处理。
                                                        1&#x3D;在呈现数据包之前，需要对其进行预处理（如解密）。
                                                        未加密文件中应为0，加密标签应为1。过滤器的使用见附录F.FLV加密。
TagType                     UI5                         此标记的类型。定义了以下类型：
                                                        8＝音频
                                                        9＝视频
                                                        保留所有其他值
                                                        （18&#x3D;不得使用脚本数据）
DataSize                    UI24                        消息的长度。streamid到数据包结尾后的字节数（等于数据包长度–11）
Timestamp                   UI24                        应用此标记中数据的时间（毫秒）。该值与flv文件中的第一个标记相关，该标记的时间戳始终为0。
TimestampExtended           UI8                         timestamp字段的扩展，以形成si32值。此字段表示高8位，而前一个时间戳字段表示低24位时间（毫秒）。
StreamID                    UI24                        Always 0.
AudioTagHeader              IF TagType &#x3D;&#x3D; 8
                            AudioTagHeader              第E.4.2.1节中定义的audioTagHeader元素。
VideoTagHeader              IF TagType &#x3D;&#x3D; 9
                            VideoTagHeader              第E.4.3.1节中定义的VideoTagHeader元素。
EncryptionHeader            IF Filter &#x3D;&#x3D; 1
                            EncryptionTagHeader         如第F.3.1节所述，每个受保护样品应包括加密头。
ConstructorCount            IF ConstructorCountField &#x3D;&#x3D; 1
                                UI8                     ADobemuxhintconstructors的数目。
                                                        当使用使用不同模式或原始样本的不同部分的多个数据块构造单个FLV标记或RTMP消息时，
                                                        特别使用此字段。如果constructorCountField&#x3D;&#x3D;0，则constructorCount&#x3D;1
DataEntry                   AdobeMuxHintConstructor
                            [ConstructorCount]          ADobEmuxHintConstructors元素数组
TrailerLength               If TrailerLengthField &#x3D;&#x3D; 1
                                UI8                     拖车的长度，以字节为单位。
                                                        如果trailerLengthField&#x3D;0，则trailerLength&#x3D;trailerDefaultSize
Trailer                     UI8 
                            [TrailerLength]             其他数据，例如，为了兼容性。当处于FLV兼容模式时，此字段携带上一个标记大小。


2.13.1.3. AdobeMuxHintConstructor

AdobEmuxHintConstructor具有以下布局：
AdobeMuxHintConstructor
Field	        Type	            Comment
Mode            If ModeField &#x3D;&#x3D; 1
                UI8                 提示正在使用跟踪模式。
                                    当modefield&#x3D;&#x3D;0时，可以从Adobe MUX提示进程（AMHP）框中确定模式。
HintInfo        If Mode &#x3D;&#x3D; 2        如模式所示。尽管定义了三种提示模式，
                AdobeMuxHintSampleConstructor
                ELSE                但由于立即节点和立即节点提升模式都使用了ADobmUxHintimmediateConstructor，因此只指定了两个构造函数。
                AdobeMuxHintImmediateConstructor



2.13.1.4. AdobeMuxHintImmediateConstructor

Adobmuxhintimmediteconstructor应在即时和即时节点提升模式中使用。这些模式以Adobe多路提示跟踪格式描述。
AdobEmuxHintimmediateConstructor具有以下布局：
AdobeMuxHintImmediateConstructor
Field	        Type	            Comment
Length          If LengthField &#x3D;&#x3D; 1
                UI24                要从后面的数据中获取的字节数。
                                    如果lengthField&#x3D;&#x3D;0，则不存在此字段，并且长度是根据adobmuxPacket.dataSize计算得出的。
Data            UI8 [Length]        要放入有效负载部分的数据字节



For more information, see section 8.aaaaaaaaaaaaaaaaaaaaaaaaaaa of ISO&#x2F;IEC 14496-12:2008.
2.13.1.5. AdobeMuxHintSampleConstructor

示例模式中应使用Adobemuxhintsampleconstructor。示例模式以Adobe多路提示跟踪格式描述。
AdobEmuxHintSampleConstructor具有以下布局：
AdobeMuxHintSampleConstructor
Field	        Type	        Comment
TrackRefIndex   SI8             指示示例数据将来自哪个跟踪的值。
                                值为0表示只引用了一个媒体曲目。
                                1到127之间的值是指向提示跟踪引用原子项的索引。
                                这些值指示要从哪个原始媒体跟踪样本。一个值
                                -1表示提示跟踪本身。也就是说，从与当前解析的提示示例相同的轨道获取示例。
Length          UI24            要复制的示例中的字节数。模式&#x3D;&#x3D;2时，长度场应为1。
SampleNumber    UI32            轨道样本号。
SampleOffset    UI32            从样本开始到开始复制点的偏移量


2.14. Meta box

Box type: ‘meta’ 
Container:  File, Movie box (‘moov’), or Track box (‘trak’) 
Mandatory: No 
Quantity: Zero or one at each file level, movie level, or track level
元（meta）框的容器是一个f4v文件、一个电影（moov）框或一个轨道（trak）框。meta-box可以包含其他各种包含元数据的框。
meta box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;meta&amp;#x27; (0x6D657461)
Version         UI8                 Reserved, set to 0
Flags           UI24                Reserved, set to 0
Boxes           BOX [ ]             定义文件元数据的任意框数



For more information, see section 8.11.1 of ISO&#x2F;IEC 14496-12:2008.
2.15. Free Space boxes

Box type:  ‘free’ or ‘skip’  
Container: File or any box  
Mandatory: No 
Quantity: Any
自由（free）和跳过（skip）框的内容是自由文件空间，播放机应忽略它们的内容。在允许使用盒子的地方可以使用盒子。这些框可以为将来扩展容器框中的数据保留空间。
mfra框应该是文件中的最后一个。mfra框中的最后一个框提供了mfra框中长度字段的副本。
free space box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;free&amp;#x27; (0x66726565) or &amp;#x27;skip&amp;#x27; (0x736b6970)
Void            UI8 [ ]             Arbitrary number of bytes to end of box



For more information, see section 8.aaaaaaaaaaaaaaaaaaaaaaaaaaa of ISO&#x2F;IEC 14496-12:2008.
2.16. Movie Fragment Random Access box

Box type: ‘mfra’ 
Container: File 
Mandatory: No 
Quantity: One
电影片段随机访问（mfra）框通过为轨迹（不一定是所有轨迹）提供轨迹片段随机访问（tfra）框，帮助在碎片化的f4v文件中查找随机访问点。此框中的信息不确定，只提供随机接入点的提示。
mfra box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;mfra&amp;#x27; (0x6D667261)
Boxes           BOX [ ]             定义随机接入点的任意数量的框



For more information, see section 8.8.9 of ISO&#x2F;IEC 14496-12:2008.
2.16.1. Track Fragment Random Access box

Box type: ‘tfra’ 
Container: Movie Fragment Random Access box (‘mfra’) 
Mandatory: No 
Quantity:  Zero or more
每个跟踪片段随机访问（TFRA）框条目提供随机可访问样本的位置和表示时间。tfra框不需要包含跟踪中每个随机可访问样本的条目。此框的缺失并不意味着所有样本都是同步样本。
tfra box
Field	                    Type	            Comment
Header                      BOXHEADER           BoxType &#x3D; &amp;#x27;tfra&amp;#x27; (0x74667261)
Version                     UI8                 Either 0 or 1
Flags                       UI24                Reserved, set to 0
TrackID                     UI32                Identifies the track
Reserved                    UI26                Reserved. Set to 0
LengthSizeTrafNumMinus1     UI2                 RandomAccessStructure记录中TrafNumber字段的长度（以字节为单位），减去1
LengthSizeTrunNumMinus1     UI2                 RandoAccessStructure记录中的TrunNumber字段的长度（以字节为单位），减去1
LengthSizeSampleNumMinus1   UI2                 randomAccessStructure记录中sampleNumber字段的长度（以字节为单位），减去1
NumberEntry                 UI32                此曲目的条目数。如果为0，则每个样本都是随机接入点
RandomAccessSample          RandomAccessStructure
                            [NumberEntry]       随机访问样本的位置和呈现时间
每个randomaccessstructure记录都有以下布局：randomaccessstructure
Time                        IF Version &#x3D;&#x3D; 0
                                UI32
                            IF Version &#x3D;&#x3D; 1
                                UI64             随机访问样本的表示时间，以媒体标题中为此曲目定义的时间刻度单位表示。
MoofOffset                  IF Version &#x3D;&#x3D; 0
                                UI32
                            IF Version &#x3D;&#x3D; 1
                                UI64            对应电影片段框的字节偏移量，从文件开始
TrafNumber                  &amp;#123; UI8, UI16, UI24, UI32 &amp;#125; 
                            [LengthSizeTrafNumMinus1]   包含随机可访问样本的traf编号。每个MOOF中的第一个traf编号为1。
                                                        类型是按长度大小索引的ui8、ui16、ui24、ui32中的一个1
TrunNumber                  &amp;#123; UI8, UI16, UI24, UI32 &amp;#125; 
                            [LengthSizeTrunNumMinus1]   包含随机可访问样本的Trun编号。每个交通中的第一个通道编号为1。
SampleNumber                &amp;#123; UI8, UI16, UI24, UI32 &amp;#125;
                            [LengthSizeSampleNumMinus1]     包含随机可访问样本的样本号。每个耳轴的第一个样本编号为1。



For more information, see section 8.8.10 of ISO&#x2F;IEC 14496-12:2008.
2.16.2. Movie Fragment Random Access Offset box

Box type: ‘mfro’ 
Container: Movie Fragment Random Access box (‘mfra’) 
Mandatory: Yes 
Quantity: One
Movie片段随机访问偏移量（mfro）框提供Movie片段随机访问（mfra）框的长度字段的副本，并帮助查找mfra框。mfro箱应最后放置在mfra箱中。
mfro box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;mfro&amp;#x27; (0x6d66726f)
Version         UI8                 Either 0 or 1
Flags           UI24                Reserved, set to 0
Size            UI32                封闭movie片段随机访问框的大小（字节）



For more information, see section 8.8.11 of ISO&#x2F;IEC 14496-12:2008.
3. F4V Metadata

本节介绍f4v文件格式支持的元数据。
3.1. Tag box

Box type:  ‘auth’, ‘titl’, ‘dscp’ and ‘cprt’  
Container: Movie box (‘moov’) 
Mandatory: No 
Quantity: Zero or one of each type.
f4v文件格式支持包含在电影（moov）框中的四个可选标记框。一个f4v文件最多可以包含256个标记（包括这些框中的标记和在ILST框中定义的标记）。
Tag box
Field	        Type	            Comment
Header          BOXHEADER           BoxType应为以下类型之一：
                                    作者的“auth”（0x61757468）
                                    “titl”（0x7469746C）表示标题
                                    “dscp”（0x64736370）用于说明“cprt”（0x63707274）用于版权
Version         UI8                 Shall be 0
Flags           UI24                Reserved, set to 0
Pad             UI1                 Padding, set to 0
Language        UI5 [3]             指定语言的三字符代码（见ISO 639-2&#x2F;T）。每个字符被解释为0x60+（5位）代码，以生成一个ASCII字符。
TagString       UI8 [ ]             标记字符串数据，占用框的其余部分。标记字符串长度不得超过65535字节。



3.2. XMP Metadata box

Box type: ‘uuid’ 
Container: File 
Mandatory: No 
Quantity: One
从第10版开始，Flash播放器可以加载嵌入到F4V文件中的XMP数据。XMP是Adobe的可扩展元数据平台。有关详细信息，请参阅www.adobe.com&#x2F;go&#x2F;xmp。
XMP元数据框应立即跟随电影（MOOV）框，无中间框。xmp元数据框的大小不得超过64兆字节。
通过XMP元数据框，该文件可以通过actionscript将XMP元数据与SWF电影通信。xmpmetadata通过名为dat a的字符串属性向actionscript公开。
XMP Metadata box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; ‘uuid’ (0x75756964)
UUID            UI8 [16]            16字节（128位）通用唯一标识符（UUID）。
                                    uuid应为十六进制字节，即7a cf cb 97 a9 42 e8 9c 71 99 94 91 e3 af ac。
XMPMetadata     UI8 [ ]             XMP元数据，按照XMP元数据标准格式化


3.3.  ilst box

Box type: ‘ilst’ 
Container: Meta box (‘meta’) 
Mandatory: No 
Quantity: One
ILST框出现在元（meta）框中，包含任意数量的元数据标记。f4v文件最多可包含256个标记（包括此框和“auth”、“titl”、“dscp”和“cprt”框中的标记）
ilst box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;ilst&amp;#x27; (0x696C7374)
TagCount        UI32                在ILST框中枚举的标记数
Tags            TAGRECORD 
                [TagCount]          多个标记记录条目 
每个标记记录都有以下布局：TAGRECORD
TagLength       UI32                标记记录的总长度，包括此长度字段
TagName         UI8 [4]             4个字节，指示标记的名称。这些字节通常来自人类可读的ASCII集，但不总是
DataLength      UI32                标记记录的数据部分的总长度
DataTag         UI8 [4]             4个字节&amp;#x27;d&amp;#x27;、&amp;#x27;a&amp;#x27;、&amp;#x27;t&amp;#x27;和&amp;#x27;a&amp;#x27;表示标记记录的数据部分
DataType        UI32                指定标记记录的数据负载中的数据类型
Reserved        UI32                Reserved, set to 0
Payload         UI8 [ ]             占用标记记录其余部分的任意字节数。精确的有效负载格式取决于数据类型
                                    数据类型支持的值为：
                                    -0:自定义数据。在&amp;#x27;trkn&amp;#x27;和&amp;#x27;disk&amp;#x27;标记类型的情况下，数据有效负载被解释为单个ui32
                                    - 1：文本数据
                                    -13，14：二进制数据
                                    -21：通用数据



3.4. Text Track Metadata

Box type:  See below 
Container: Text samples (‘text’ or ‘tx3g’) in Media Data box (‘mdat’) 
Mandatory: No 
Quantity: Any
文本示例（“text”或“tx3g”）可以包含以下元数据框。它们的内容通过ontextdata属性暴露给正在运行的actionscript程序。
3.4.1. Style box

样式（Styl）框包含文本样式规范。此信息通过st yl e属性公开给actionscript。
styl box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;styl&amp;#x27; (0x7374796C)
Count           UI16                样式数组中的条目数
Styles          STYLERECORD
                [Count]             一组样式记录结构，每个结构都作为ActionScript对象
单个样式记录具有以下布局：STYLERECORD
StartChar       UI16                此样式记录应用到的第一个字符，通过名为startchar的双属性向actionscript公开
EndChar         UI16                此样式记录应用到的最后一个字符，通过名为endchar的双属性向actionscript公开
FontID          UI16                用于此样式的字体ID，通过名为fontid的双属性公开给actionscript
                                    FaceStyleFlags UI8通过名为facestyleflags的双属性用于ActionScript
FontSize        UI8                 用于字体的大小，通过属性fontsize用于actionscript
TextColor       UI32                文本的rgba颜色，通过属性textcolor公开给actionscript


3.4.2. Highlight box

突出显示（HLIT）框指定要突出显示的文本范围。此信息通过highlight属性公开给actionscript。
hlit box
Field	        Type	             Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;hlit&amp;#x27; (0x686C6974)
StartChar       UI16                要突出显示的第一个字符，通过名为startchar的双属性向actionscript公开
EndChar         UI16                要突出显示的最后一个字符，通过名为endchar的双属性向actionscript公开。


3.4.3. Highlight Color box

突出显示颜色（HCLR）框指定文本的突出显示颜色。此信息通过hi ghl i ght col或属性公开给actionscript。
hclr box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;hclr&amp;#x27; (0x68636C72)
HighlightColor  UI16 [3]            通过名为hi-ghlightcolor的双属性向actionscript公开的三元素数组，它按顺序保存红色、绿色和蓝色组件的值。


3.4.4. Karaoke box

Karaoke（krok）框指定Karaoke元数据。此信息通过karaoke属性公开给actionscript。时间以轨道定义的时间刻度单位表示。
krok box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;krok&amp;#x27; (0x6B726F6B)
StartTime       UI32                通过名为StartTime的双属性向ActionScript公开
Count           UI16                KaraokeRecords数组中的条目数
KaraokeRecords  KARAOKEREC [Count]  karaokerec结构的数组，每个结构都作为对象暴露在actionscript中

An individual KARAOKEREC has the following structure: KARAOKEREC
EndTime         UI32                通过名为endtime的双属性向ActionScript公开
StartChar       UI16                通过名为startchar的双属性向ActionScript公开
EndChar         UI16                通过名为endchar的双属性向ActionScript公开


3.4.5. Scroll Delay box

滚动延迟（dlay）框指定滚动延迟。此信息通过scr ol l del ay属性向actionscript公开，该属性以与跟踪相关的时间刻度单位表示。
dlay box
Field	        Type	             Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;dlay&amp;#x27; (0x646C6179)
ScrollDelay     UI32                通过名为ScrollDelay的双属性向ActionScript公开


3.4.6. Drop Shadow Offset box

放置阴影（DRPO）框指定文本的放置阴影偏移坐标。
drpo box
Field	                Type	            Comment
Header                  BOXHEADER           BoxType &#x3D; &amp;#x27;drpo&amp;#x27; (0x6472706F)
DropShadowOffsetX       UI16                通过名为DropshadowOffsetx的双属性向ActionScript公开
DropShadowOffsetY       UI16                通过名为DropshadowOffsty的双属性向ActionScript公开


3.4.7. Drop Shadow Alpha box

放置阴影alpha（drpt）框指定放置阴影alpha值。
drpt box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;drpt&amp;#x27; (0x64727074)
DropShadowAlpha UI16                一个16位alpha值，通过名为dr opshadowal pha的双属性公开给actionscript。



For more information, see section 8.aaaaaaaaaaaaaaaaaaaaaaaaaaa of ISO&#x2F;IEC 14496-12:2008.
3.4.8. Hypertext box

超文本框（href）指定在文本范围内具有alt文本的超文本链接。此信息通过hyper t ext属性公开给actionscript。
href box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;href&amp;#x27; (0x68726566)
StartChar       UI16                文本范围的开始字符，通过名为startchar的双属性向actionscript公开。
EndChar         UI16                文本范围的最后一个字符，通过名为endchar的双属性向actionscript公开
URLSize         UI8                 The length of the URL string
URL             UI8 [URLSize]       通过名为url的字符串属性向actionscript公开的url字符串
ALTSize         UI8                 The length of the ALT string
ALT             UI8 [ALTSize]       当用户鼠标悬停在链接上时显示的alt字符串，通过名为alt的字符串属性向actionscript公开。


3.4.9. Text Box box

文本框（tbox）框定义文本框的坐标。此信息通过t ex t box属性公开给actionscript。
tbox box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;tbox&amp;#x27; (0x74626F78)
Top             UI16                顶部像素坐标，通过名为top的双属性向actionscript公开
Left            UI16                左像素坐标，通过名为Left的双属性向ActionScript公开
Bottom          UI16    
Right           UI16


3.4.10. Blinking box

Blinking（BLNK）框指定要设置闪烁的文本范围。此信息通过blink属性公开给actionscript。
blnk box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;blnk&amp;#x27; (0x626C6E6B)
StartChar       UI16                闪烁范围中的第一个字符，通过名为startchar的双属性向actionscript公开
EndChar         UI16                闪烁范围中的结束字符，通过名为endchar的双属性向actionscript公开



3.4.11. Text Wrap box

文本换行（twrp）框为文本设置换行标志。
twrp box
Field	        Type	            Comment
Header          BOXHEADER           BoxType &#x3D; &amp;#x27;twrp&amp;#x27; (0x74777270)
WrapFlag        UI8                 如果文本应该换行，则为非零的布尔值，通过名为wrapflag的双属性向actionscript公开。


附件A.嵌入提示点
A.1.Overview

使用Flash构建媒体应用程序的一个关键好处是能够混合媒体播放和丰富的交互式数据。f4v应用程序可以支持以amf样本的形式嵌入时间数据（提示点）。这些示例与音频和视频示例一起传输到Flash运行时，在那里它们被发送到应用程序脚本。
A.2.AMF样本格式

AMF示例是包含类型化AMF值列表的AMF对象。
根据为数据轨指定的类型，AMF对象应为AMF0对象或AMF3对象。amf0和amf3的规范可以在以下网址找到：http:&#x2F;&#x2F;opensource.adobe.com&#x2F;wiki&#x2F;display&#x2F;blazeds&#x2F;developer+documentation
第一个值应为表示AMF样本名称的字符串。AMF值将被调度到具有此名称的方法。例如，如果第一个字段是名为“onfoo”的字符串，则在播放AMF示例时调用方法“onfoo”。
表3列出了为运行时保留且未调度到脚本的名称：
Table 3. Reserved names

attachAudio	    attachVideo	    call	close	getBufferInfo
onStatus	    pause	        play	play2	publish
receiveAudio	receiveVideo	seek	send	setBufferTime


A.3.AMF数据跟踪结构

AMF样本可以存储在数据跟踪中。数据轨配置如下：
处理程序参考（HDLR）框中的处理程序类型应为“数据”，媒体头框类型应为“NMHD”。
样品描述（STSD）框应包含一份描述AMF样品的描述记录。
说明条目格式应为sampleEntry类型。
说明条目的框类型应为“amf0”或“amf3”，与样本的“amf”格式相对应。以下数据轨框应包含每个AMF样本的条目：
-解码时间采样（STTS）框，用于AMF样本的解码时间。
-样本大小（STSZ）框，用于AMF样本的大小。
-chunk offset（STCO或CO64）框，用于AMF样本的偏移。
-合成时间采样（CTTS）框，用于将AMF样本传递到ActionScript的时间
程序。
在媒体数据（mdat）框中，数据轨中的样本应与音频和视频样本交错。
A.3.1.解码数据轨

播放一个f4v文件时，mdat框中的amf示例将传递给amf解码器。在STTS框中指定的时间，AMF解码器对样本进行解码。
在CTTS框中指定的时间，AMF解码器将解码后的AMF样本传递给actionscript程序。
A.4.渐进式下载

通过适当的交织，该方法适用于渐进式下载。
AMF内容应与音频和视频内容在正确的时间交错，以确保在下载文件时数据在正确的时间可用。
AMF数据不应存储在文件的末尾，因为在这种情况下，在发送第一个AMF样本之前，必须下载整个文件，即使该样本在内容的时间非常早。
A.5.多个数据轨

只有一个数据轨。
附件B.Flash播放器元数据
B.1.流属性

当flash player加载一个f4v文件时，可以通过net st r eam为正在运行的actionscript程序提供各种流属性。Onmet Adat a Property公司。可用属性因用于创建文件的软件而异。典型特性为：
-audi ocodeci d：一个包含四个字符的字符串，定义使用的音频编解码器（如果存在音频并且
使用Flash播放器可以解码的编解码器编码
-avcl-level：表示视频符合的avc级别的双精度符号，如果存在视频并对其进行编码。
采用AVC／H.264
-ile的avcpr：一个双精度符号，表示视频符合的avc配置文件（如果存在视频且
用AVC&#x2F;H.264编码
-打开时的持续时间：以秒为单位表示电影总长度的两倍
-高度：表示视频高度的双精度符号，如果视频存在并使用编解码器编码
Flash播放器可以解码
-moovposition：一个双精度符号，表示f4v文件中moov框的绝对偏移量。此属性
用于确定文件是否将逐步加载
-videocodecid：一个包含四个字符的字符串，定义所使用的视频编解码器（如果存在视频且
使用Flash播放器可以解码的编解码器编码
-如果存在视频，则显示视频的平均视频帧速率。
使用Flash播放器可以解码的编解码器编码
-width：一个双精度符号，表示视频的宽度，如果视频存在，并用闪烁的编解码器编码。
玩家可以解码
B.2.影像元数据

如果f4v示例是图像类型（gif、png或jpeg），则通过oni magedat a属性将数据提供给正在运行的actionscript程序。存在以下属性：
-数据：包含压缩图像数据（即原始jpeg、png或gif文件数据）的字节数组。
-trackID：指示此示例所属的轨道的双精度符号。
附件C.HTTP流：文件结构
C.1.概述

Flash播放器支持带有F4V片段的HTTP流。HTTP流表示由HTTP流清单文件（F4M）和HTTP流段（分段的F4V文件或F4F）组成。
表示沿时间线划分为HTTP流段，进一步划分为HTTP流段。演示文稿可以在多个质量级别上并行提供。可以通过片段（完全或部分）和质量级别缓存和交付演示文稿。
演示文稿的引导信息框指定演示文稿的数据结构和对其的访问。清单文件（fdm）在http:&#x2F;&#x2F;opensource.adobe.com&#x2F;wiki&#x2F;display&#x2F;osmf&#x2F;flash+media+manifest+file+format+specification中有进一步的描述。
C.2.HTTP流段

HTTP流段是包含片段的完整F4V文件。该段只能属于一个质量级别。该段应包括一组方框，后跟一组HTTP流片段。
成套盒子应包括以下盒子，最好按此顺序排列（可选盒子用括号[]表示）：

   ftyp

   [afra]

   [abst]

   moov

   rtmp

   [mdat]


一套盒子可能包括AFRA和MDAT盒子。如果包含，AFRA盒应位于MDAT盒和ABT盒之前。
HTTP流段中HTTP流段外部的MOOF盒不得用于HTTP流。
C.2.HTTP流片段

HTTP流片段应包括以下每个框中的一个，最好按此顺序：

   afra

   abst

   moof

   mdat


AFRA箱应位于所有其他箱之前。
片段不是完整的f4v文件。HTTP流片段中不允许使用框ftyp、pdin和moov。
C.4.URL构造

每个HTTP流段都是一个单独的URL资源（文件）。URL方案可以唯一地寻址每个HTTP流片段。HTTP流片段的URL构造如下：
http:&#x2F;&#x2F;serverbaseurl&gt;&#x2F;&lt;*movieidentifier&gt;&lt;*qualityssegmenturlmodifier&gt;seg&lt;*segment number&gt;-frag&lt;*fragmentnumber&gt;
其中，f4v规范定义了括号中的字段，数字没有前导零。如果serverEntryCount&#x3D;&#x3D;0，&lt;*serverBaseURL&gt;和尾随斜杠应省略。
如果QualityEntryCount&#x3D;&#x3D;0，&lt;*QualitySegmenturModifier&gt;应省略。
示例：http:&#x2F;&#x2F;adobe。com&#x2F;mymovie&#x2F;highseg1-frag210
C.5.Adobe多路提示跟踪格式

用于HTTP流的F4V文件需要包含提示跟踪。提示跟踪提供了使流服务器能够创建传输数据包的信息。有关流的信息，请参阅ISO规范第7节。
Adobe支持Adobe多路提示跟踪格式。Adobe多路复用提示跟踪格式足够灵活，可以支持RTMP数据包以及类似FLV的格式，其中样本作为一个整体按时间顺序交错。FLV兼容模式是为提示样本和FLV格式之间的有效映射而定义的。可以对格式进行配置，以确保由一系列提示样本组成的mdat与对应于这些样本的flv的一部分相同。
Adobemux提示示例输入框（rtmp）描述了提示轨迹。提示轨包含一个AdobEmuxhintsamples集合，并位于媒体数据框中。
定义了三种提示模式：
-立即模式（模式&#x3D;0）
在这种模式下，为了提高效率，多路复用轨道的有效载荷直接在提示样本本身中可用。但是，必须小心使用此模式，因为它可能会导致某些数据重复。
-立即节点提升模式（模式&#x3D;1）
立即节点提升模式的定义是为了避免立即模式下的数据复制。在此配置中，原始（音频&#x2F;视频）曲目的采样表中的偏移量被调整为物理指向包含媒体数据的（立即模式）提示样本（本地位于mdat位置）。因为块偏移量被更改为指向每个样本的提示样本（在头之后和样本开始的位置），所以所有块只包含一个样本。
因此，媒体框“mdat”只包含提示示例（没有音频或视频示例）。提示示例将在其即时数据字段中嵌入媒体数据。只有在Adobe多路复用数据包中使用完整样本（而不是在分块RTMP模式下）时，这才是可能的。此外，这也会增加区块偏移表的副作用，但与获得的效率相比，这是最小的。
-采样模式（模式&#x3D;2）
在这种模式下，包头和尾部被定义为提示样本的一部分。多路复用磁道的有效负载通过引用具有长度和偏移量的媒体磁道中的特定样本从提示样本“指向”媒体磁道。
附录D.F4V加密D.1概述
D.1.加密过程

本节概述了如何使用Adobe的DRM密钥&#x2F;权限管理系统来保护F4V内的媒体。保护仅适用于F4V的音频&#x2F;视频曲目。其他曲目类型（如AMF曲目）的加密格式不在本规范的范围内。
本节应与ISO 14496-12:2008第8.12节（对受保护流的支持）一起阅读。在阅读下一节之前，读者必须理解上述文件格式。
D.2.加密过程

加密过程将样本格式从纯文本更改为密码文本。在每个示例数据之前插入一个Adobe DRM访问单元头。由于将纯文本转换为密码文本，因此如果不使用适当的密钥，则无法使用应用程序访问基础媒体。
将转换描述加密样本的样本描述表中的样本描述条目。转换结构遵循ISO 14496-12:2008第8.12节。转换示例描述条目的目的是双重的：示例描述条目防止意外处理加密数据，就像它是未加密的一样，并记录应用的转换。
执行以下示例描述转换：
-样本描述条目的4cc替换为4cc，表示加密：
o“encv”表示加密视频流（而不是“mp4v”、“avc1”），o“enca”表示加密音频流（而不是“mp4a”、“samr”），o“encr”表示加密数据流。
-保护方案信息（sinf）框附加到示例描述条目后，保留所有其他框。
未修改的sinf框包含理解应用的加密转换及其参数以及查找其他信息（如密钥管理系统的类型和位置）所需的所有信息。它还记录了媒体的原始（未加密）格式。
-样本描述条目的原始格式4cc存储在原始格式（frma）框中，即
sinf框的子框。
-方案类型（schm）框也是sinf框的子框，并将加密方案指定为4cc和
它的版本。在f4v文件中，该方案4cc应为“adkm”，即Adobe的DRM密钥管理。
-在sinf框中，有一个“黑框”（方案信息（schi）框）空间，用于描述
控制对加密媒体内容的访问的密钥管理。schi框是一个容器框，仅由正在使用的方案解释。在F4V文件中，此框应为Adobe DRM密钥管理系统框。
图1–在f4v中存储保护信息的示例
图1说明了保护信息如何存储在F4V中。在示例中，将保护方案信息（sinf）框放入每个曲目的示例描述条目中，并将Adobe的DRM标识符指定为密钥&#x2F;权限管理系统，以保护音频和视频曲目。
sinf框是每个示例描述框中的示例条目。虽然在一个样本描述框中可以有多个样本条目（每个曲目只能有一个样本描述框），但这并不常见。因此，上面的图表只显示每个轨道一个sinf框。但是，由于每个磁道可能有多个磁道，因此DRM Packager和DRM解码器都应该能够处理这种情况。
D.3.样本加密

本节介绍在将DRM应用于F4V中的音频或视频轨时如何转换每个样本。
D.3.1.接入单元头

表4中定义的访问单元头指定了由Adobe的DRM保护的每个样本单元的格式。媒体文件格式将媒体数据的布局指定为示例，但加密&#x2F;解密过程需要在每个示例中包含其他信息。附加信息取决于所使用的DRM密钥管理。Adobe的DRM指定了自己的访问单元报头，该报头应位于每个编解码器特定的示例数据之前。f4v访问单元头与flv选择性加密过滤器参数相同。
Table 4. Access Unit Header
Access Unit Header
Field                 Type              Comment
EncryptedAU	          UI1               选择性加密指示器显示数据包是否加密。
                                            0&#x3D;样本未加密
                                            1&#x3D;样本已加密。     
Reserved              UI7               Shall be 0
IV              IF EncryptedAU &#x3D;&#x3D; 1
                    UI8 [IVLength]      仅在样本加密时存在。包含16字节的AES-CBC IV数据



上述指定的访问单元头应添加到样本描述条目打开DRM（即存在保护方案信息（sinf）框）的每个样本中，即使特定样本未加密。报头是解码器知道特定样本是否加密的唯一方法（在selectiveencryption为1的情况下）。当只加密关键帧时，样本的选择性加密可以提高性能。
D.3.2.加密样本的填充

所有加密样本应填充到块密码块长度的倍数。填料方案应如RFC 2630中所述，复制如下：
块密码期望输入数据是k个八位字节的倍数（对于aes 128，要求输入数据是16个八位字节的倍数），其中k大于1。对于此类算法，输入应在尾端填充k-（length mod k）八位字节，所有八位字节的值均为k-（length mod k），其中length是输入的长度。
因此，输入用下面的一个k字节序列填充在尾端，如表5所示。
Table 5. Padding the cipher block

Condition                   Bytes added to the end of the block
IF length mod k&#x3D;k-1	                                    01
IF length mod k&#x3D;k-2	                                02	02
...
IF length mod k&#x3D;n                           ...  k-n   k-n
...
IF length mod k&#x3D;0           k	k	…	k	k    k       k



由于所有输入都被填充，包括已经是块大小的倍数的输入值，并且没有填充序列是另一个的后缀，因此可以从填充块明确地确定填充的大小。最后一个八位字节表示要修剪多少个八位字节。
附录E.FLV文件格式
E.1.概述

flv文件中的每个标记类型构成一个单独的流。在一个FLV文件中，同步在一起的音频和视频流不得超过一个。FLV文件不应定义单个类型的多个独立流。FLV中使用的简单数据类型在SWF格式规范中定义。flv文件使用一个没有为swf文件定义的附加类型：ui24表示无符号的24位整数。
与SWF文件不同，FLV文件应以大端字节顺序存储多字节数。例如，作为SWF文件格式中的ui16，表示数字300（0x12c）的字节序列为0x2c 0x01；作为FLV文件格式中的ui16，表示数字300的字节序列为0x01 0x2c。
另请参见SWF文件格式规范，网址为http:&#x2F;&#x2F;www.adobe.com&#x2F;go&#x2F;swf_file_format。
E.2.FLV报头

FLV文件应以FLV头开始：
FLV header
Signature           UI8	Signature byte always &amp;#x27;F&amp;#x27; (0x46)
Signature           UI8	Signature byte always &amp;#x27;L&amp;#x27; (0x4C)
Signature           UI8	Signature byte always &amp;#x27;V&amp;#x27; (0x56)
Version             UI8	File version (for example, 0x01 for FLV version 1)
TypeFlagsReserved   UB [5]	Shall be 0
TypeFlagsAudio      UB [1]	1 &#x3D; Audio tags are present
TypeFlagsReserved   UB [1]	Shall be 0
TypeFlagsVideo      UB [1]	1 &#x3D; Video tags are present
DataOffset          UI32	The length of this header in bytes



对于FLV版本1，dataoffset字段的值通常为9。此字段用于在将来的版本中容纳较大的标题。
E.3.FLV文件体

在flv头段之后，flv文件的其余部分应包含交替的反向指针和标签。它们交错排列，如下表所示：
FLV File Body
Field	            Type            Comment
PreviousTagSize0    UI32            Always 0
Tag1                FLVTAG          First tag
PreviousTagSize1    UI32            上一个标记（包括其标题）的大小（字节）。
                                    对于FLV版本1，该值为11加上上上一个标记的数据大小。
Tag2                FLVTAG          Second tag
...
PreviousTagSizeN-1  UI32            第二个到最后一个标记（包括其标题）的大小（字节）。
TagN                FLVTAG          Last tag
PreviousTagSizeN    UI32            最后一个标记（包括其标题）的大小（字节）。


E.4.FLV标签定义
E.4.1FLV标签

flv标记包含音频、视频或脚本的元数据、可选加密元数据和有效负载。FLVTAG
Field                       Type	        Comment
Reserved                    UB [2]          Reserved for FMS, should be 0
Filter                      UB [1]          指示是否筛选数据包。
                                            0&#x3D;不需要预处理。
                                            1&#x3D;在呈现数据包之前，需要对其进行预处理（如解密）。
                                            未加密文件中应为0，加密标签应为1。过滤器的使用见附录F.FLV加密。

TagType                     UB [5]          此标记中的内容类型。定义了以下类型：
                                            8＝音频
                                            9＝视频
                                            18&#x3D;脚本数据

DataSize                    UI24            消息的长度。streamid到标记末尾后的字节数（等于标记的长度–11）
Timestamp                   UI24            应用此标记中数据的时间（毫秒）。该值与flv文件中的第一个标记相关，该标记的时间戳始终为0。
TimestampExtended           UI8             timestamp字段的扩展，以形成si32值。此字段表示高8位，而前一个时间戳字段表示低24位时间（毫秒）。
StreamID                    UI24            Always 0.
AudioTagHeader          IF TagType &#x3D;&#x3D; 8     第E.4.2.1节中定义的audioTagHeader元素。
                            AudioTagHeader
VideoTagHeader          IF TagType &#x3D;&#x3D; 9      第E.4.3.1节中定义的VideoTagHeader元素。
                            VideoTagHeader
EncryptionHeader        IF Filter &#x3D;&#x3D; 1      如第F.3.1节所述，每个受保护样品应包括加密头。
                        EncryptionTagHeader
FilterParams            IF Filter &#x3D;&#x3D; 1      根据第F.3.2节的规定，每个受保护样品应包括过滤器参数。
                            FilterParams

Data                    IF TagType &#x3D;&#x3D; 8     每种媒体类型的特定数据。
                            AUDIODATA
                        IF TagType &#x3D;&#x3D; 9
                            VIDEODATA
                        IF TagType &#x3D;&#x3D; 18
                            SCRIPTDATA



在回放中，flv标记的时间顺序仅取决于flv时间戳。应忽略有效载荷数据格式中内置的任何定时机制。
E.4.2音频标签
音频标签类似于SWF文件格式中的definesound标签。对于SWF中也支持的格式，FLV和SWF中的有效载荷数据是相同的。
E.4.2.1音频数据
audioTagHeader包含音频特定的元数据
AudioTagHeader
Field               Type            Comment
SoundFormat         UB [4]          声音数据的格式。定义了以下值：
(见注释下表：为了特殊编码)              0&#x3D;线性PCM，平台端
                                    1＝ADPCM
                                    2＝MP3
                                    3&#x3D;线性PCM，小端
                                    4&#x3D;16 kHz单声道Nellymoser
                                    5&#x3D;8 kHz单声道Nellymoser
                                    6 &#x3D; NelyMysor
                                    7&#x3D;G.711 a-律对数pcm
                                    8&#x3D;G.711μm对数pcm
                                    9 &#x3D;保留
                                    10＝AAC
                                    11 &#x3D; SeEX
                                    14＝MP3 8 kHz
                                    15&#x3D;设备特定声音
                                    保留格式7、8、14和15。
                                    Flash Player 9、0115、0及更高版本支持AAC。
                                    Flash Player 10及更高版本支持speex。



SoundRate           UB [2]          采样率。定义了以下值：
                                    0＝5.5千赫
                                    1＝11千赫
                                    2＝22千赫
                                    3＝44千赫
SoundSize           UB [1]          每个音频样本的大小。此参数仅适用于未压缩格式。压缩格式总是在内部解码为16位。
                                    0&#x3D;8位样本
                                    1&#x3D;16位样本
SoundType           UB [1]          单声道或立体声
                                    0 &#x3D;单声道
                                    1&#x3D;立体声
AACPacketType       IF SoundFormat &#x3D;&#x3D; 10
                    UI8             定义了以下值：
                                    0&#x3D;AAC序列头
                                    1 &#x3D; AAC原材料




格式3，线性PCM，存储原始PCM样本。如果数据为8位，则样本为无符号字节。如果数据是16位的，那么样本将存储为有符号的小尾数。如果数据是立体声的，则左右样本是交错存储的：左-右-左-右-等等。
格式0 pcm与格式3 pcm相同，只是格式0按照文件创建平台的尾数顺序存储16位pcm样本。因此，不应使用格式0。
8 kHz和16 kHz是特殊情况，因为声速场不能代表8或16 kHz的采样率。当在SoundFormat中指定Nellymser 8 kHz或Nellymser 16 kHz时，Flash播放器将忽略SoundRate和SoundType字段。对于其他Nellymser采样率，请指定正常的Nellymser SoundFormat，并像往常一样使用SoundRate和SoundType字段。
如果SoundFormat指示AAC，则SoundType应为1（立体声），SoundRate应为3（44 kHz）。但是，这并不意味着FLV中的AAC音频总是立体声的，44 kHz的数据。相反，flash播放器忽略这些值并提取通道，采样率数据编码在AAC比特流中。
如果SoundFormat指示为speex，则音频以16kHz的频率进行单采样压缩，声音速率应为0，声音大小应为1，声音类型应为0。有关存储在swf文件中的speex功能和限制的信息，请参阅http:&#x2F;&#x2F;www.adobe.com&#x2F;go&#x2F;swf_file_format上的swf文件格式规范。
音频数据段包含音频有效载荷。
AUDIODATA
Field	        Type	         Comment
IF Encrypted	                 详见附件F.FLV加密。
    Body	    EncryptedBody	按照第F.3.3节的规定加密的音频标签体。
ELSE
    Body        AudioTagBody



AudioTagBody保存音频有效负载。
AudioTagBody
Field	        Type	         Comment
SoundData
IF SoundFormat &#x3D;&#x3D; 10
AACAUDIODATA
ELSE
Varies by format


E.4.2.2 AACAUDIODATA

Flash Player 9、0115、0及更高版本支持AAC格式。
AACAUDIODATA
Field	    Type	                        Comment
Data        IF AACPacketType &#x3D;&#x3D; 0	        
            udioSpecificConfig              AudioSpecificConfig在ISO中定义。
            ELSE IF AACPacketType &#x3D;&#x3D; 1
            Raw AAC frame data in UI8 [ ]   14496～3。请注意，这与MP4&#x2F;F4V文件中ESDS框的内容不同。




E.4.3视频标签
视频标签类似于SWF文件格式的视频帧标签，其有效载荷数据相同。另请参见SWF文件格式规范，网址为http:&#x2F;&#x2F;www.adobe.com&#x2F;go&#x2F;swf_file_format。
E.4.3.1视频数据

VideoTagHeader包含特定于视频的元数据
VideoTagHeader
Field	            Type	            Comment
Frame Type          UB [4]              视频帧的类型。定义了以下值：
                                        1&#x3D;关键帧（对于AVC，可查找的帧）
                                        2&#x3D;帧间（对于AVC，是不可查找的帧）
                                        3&#x3D;一次性内框（仅H.263）
                                        4&#x3D;生成的密钥帧（仅供服务器使用）
                                        5&#x3D;视频信息&#x2F;命令帧

CodecID             UB [4]              编解码器标识符。定义了以下值：
                                        2&#x3D;Sorenson H.263
                                        3&#x3D;屏幕视频
                                        4＝ON2 VP6
                                        5&#x3D;ON2 VP6，带阿尔法通道
                                        6&#x3D;屏幕视频版本2
                                        7 &#x3D; AVC

AVCPacketType       IF CodecID &#x3D;&#x3D; 7
                        UI8             定义了以下值：
                                        0&#x3D;AVC序列头段
                                        1 &#x3D; AVC NALU
                                        2&#x3D;AVC序列结束（不需要或不支持低级NALU序列结束符
CompositionTime     IF CodecID &#x3D;&#x3D; 7         
                        SI24            如果avcpacketype&#x3D;&#x3D;1
                                        合成时间偏移
                                        否则
                                        零有关组成时间的说明，
                                        请参见ISO 14496-12，8.15.3。
                                        flv文件中的偏移量始终以毫秒为单位。





视频数据段包含视频元数据、可选加密元数据和视频有效负载。
VIDEODATA
Field	         Type	            Comment
IF Encrypted	                    详见附件F.FLV加密。
Body	        EncryptedBody	    视频标记体按照第F.3.3节的规定加密。
ELSE
Body



VideoTagBody
VideoTagBody包含视频帧有效负载。
VideoTagBody
Field               Type                                Comment
VideoTagBody        IF FrameType &#x3D;&#x3D; 5                  视频帧有效载荷或帧信息 
                        UI8
                    ELSE (
                        IF CodecID &#x3D;&#x3D; 2
                            H263VIDEOPACKET
                        IF CodecID &#x3D;&#x3D; 3
                            SCREENVIDEOPACKET
                        IF CodecID &#x3D;&#x3D; 4
                            VP6FLVVIDEOPACKET
                        IF CodecID &#x3D;&#x3D; 5
                            VP6FLVALPHAVIDEOPACKET
                        IF CodecID &#x3D;&#x3D; 6
                            SCREENV2VIDEOPACKET
                        IF CodecID &#x3D;&#x3D; 7
                            AVCVIDEOPACKET
                    )                                  如果frametype&#x3D;&#x3D;5，而不是视频有效负载，则视频数据主体包含一个具有以下含义的ui8：
                                                        0&#x3D;客户端查找视频帧序列的开始
                                                        1&#x3D;客户端查找视频帧序列结束 
除avcvideopacket以外的所有文件，请参阅SWF文件格式规范了解详细信息。


E.4.3.2 AVCVIDEOPACKET

AVC视频包携带AVC视频数据的有效载荷。
AVCVIDEOPACKET
Field       Type	                        Comment
Data        IF AVCPacketType &#x3D;&#x3D; 0
                AVCDecoderConfigurationRecord
            IF AVCPacketType &#x3D;&#x3D; 1
                One or more NALUs (Full frames are required)



AVCDecoderConfigurationRecord的说明见ISO 14496-15，5.2.4.1。它包含的信息与存储在MP4&#x2F;FLV文件中的AVCC框中的信息相同。
E.4.4数据标签
数据标记封装了单个方法调用，通常在Flash播放器的Netstream对象上调用。数据标记由一个方法名和一组参数组成。
E.4.4.1脚本数据
脚本数据段包含可选的加密元数据和脚本有效负载。
SCRIPTDATA
Field               Type	            Comment
IF Encrypted	                        See Annex F. FLV Encryption for details.
Body	        EncryptedBody	        ScriptTagBody encrypted as specified in Section F.3.3.
ELSE
Body            ScriptTagBody



ScriptTagBody包含以操作消息格式（AMF）编码的脚本数据，该格式是用于序列化ActionScript对象图的压缩二进制格式。AMF0的规范可从以下网址获得：http:&#x2F;&#x2F;opensource.adobe.com&#x2F;wiki&#x2F;display&#x2F;blazeds&#x2F;developer+documentation
ScriptTagBody
Field               Type                    Comment
Name                SCRIPTDATAVALUE	        方法或对象名称。scriptDataValue.Type&#x3D;2（字符串）
Value               SCRIPTDATAVALUE         AMF参数或对象属性。scriptDataValue.Type&#x3D;8（ECMA数组）


E.4.4.2    SCRIPTDATAVALUE

ScriptDataValue记录包含类型化的ActionScript值。
SCRIPTDATAVALUE
Field               Type        Comment
Type                UI8         ScriptDataValue的类型。
                                定义了以下类型：
                                0＝数
                                1 &#x3D;布尔
                                2 &#x3D;字符串
                                3 &#x3D;对象
                                4&#x3D;movieclip（保留，不支持）
                                5 &#x3D;空
                                6 &#x3D;未定义
                                7 &#x3D;参考文献
                                8＝ECMA阵列
                                9&#x3D;对象结束标记
                                10&#x3D;严格数组
                                11 &#x3D;日期
                                12&#x3D;长串
ScriptDataValue
                IF Type &#x3D;&#x3D; 0     编写数据值脚本。
                DOUBLE
                IF Type &#x3D;&#x3D; 1    布尔值为（scriptDataValue≠0）。
                UI8
                IF Type &#x3D;&#x3D; 2
                SCRIPTDATASTRING
                IF Type &#x3D;&#x3D; 3
                SCRIPTDATAOBJECT
                IF Type &#x3D;&#x3D; 7
                UI16
                IF Type &#x3D;&#x3D; 8
                SCRIPTDATAECMAARRAY
                IF Type &#x3D;&#x3D; 10
                SCRIPTDATASTRICTARRAY
                IF Type &#x3D;&#x3D; 11
                SCRIPTDATADATE
                IF Type &#x3D;&#x3D; 12
                SCRIPTDATALONGSTRING



E.4.4.3    SCRIPTDATADATE

脚本数据日期记录存储日期和时间。
SCRIPTDATADATE
Field                   Type        Comment
DateTime                DOUBLE      Number of milliseconds since Jan 1, 1970 UTC.
LocalDateTimeOffset     SI16        本地时间与UTC的时差（分钟）。对于位于英国格林威治以西的时区，该值为负数。英国格林威治以东的时区是正的。


E.4.4.4    SCRIPTDATAECMAARRAY

A SCRIPTDATAECMAARRAY记录存储一个ecma数组。ECMA数组是一个关联数组，当actionscript数组包含非顺序索引时应使用该数组。所有的索引，无论是序数还是其他，都是字符串而不是整数。为了进行序列化，此类型与匿名ActionScript对象非常相似。该列表包含大约ecmaarrayllength个项目。ScriptDataObjectEnd记录在项目列表之后。
SCRIPTDATAECMAARRAY
Field                   Type                            Comment
ECMAArrayLength         UI32                            ECMA数组中的近似项数
Variables               SCRIPTDATAOBJECTPROPERTY [ ]    变量名和值列表
List Terminator         SCRIPTDATAOBJECTEND             列表终止符    


E.4.4.5    SCRIPTDATALONGSTRING

scriptDataString和scriptDataLongstring记录存储字符串
SCRIPTDATALONGSTRING
Field           Type	Comment
StringLength    UI32	StringData length in bytes
StringData      STRING	String data, with no terminating NUL


E.4.4.6    SCRIPTDATAOBJECT

ScriptDataObject记录对匿名ActionScript对象的属性进行编码。ScriptDataObjectEnd记录跟随属性列表。
SCRIPTDATAOBJECT
Field               Type                            Comment
ObjectProperties    SCRIPTDATAOBJECTPROPERTY [ ]	List of object properties
List Terminator     SCRIPTDATAOBJECTEND             List terminator


E.4.4.7    SCRIPTDATAOBJECTEND

scriptDataObjectEnd记录终止scriptDataObjectProperty记录的列表。ScriptDataObjectEnd记录是一个带零长度字符串和对象结束标记的ScriptDataObjectProperty记录。
SCRIPTDATAOBJECTEND
Field           Type        Comment
ObjectEndMarker UI8 [3]     Shall be 0, 0, 9


E.4.4.8    SCRIPTDATAOBJECTPROPERTY

ScriptDataObjectProperty记录定义ActionScript对象的对象属性或关联数组的变量。
SCRIPTDATAOBJECTPROPERTY
Field           Type                    Comment
PropertyName    SCRIPTDATASTRING        Name of the object property or variable
PropertyData    SCRIPTDATAVALUE         对象属性或变量的值和类型


E.4.4.9    SCRIPTDATASTRICTARRAY

脚本数据严格数组记录存储严格数组。严格数组只包含顺序索引，而不存储在记录中。指数可以是密集的或稀疏的。索引之间稀疏区域中未定义的条目应序列化为未定义。该列表应包含严格的数组长度值。列表后面没有终止记录。
SCRIPTDATASTRICTARRAY
Field               Type	            Comment
StrictArrayLength   UI32                Number of items in the array
StrictArrayValue    SCRIPTDATAVALUE 
                [ StrictArrayLength ]   List of typed values


E.4.4.10    SCRIPTDATASTRING

scriptDataString和scriptDataLongstring记录存储字符串。
脚本数据字符串记录可用于长度不超过65535个字符的字符串。
SCRIPTDATASTRING
Field           Type        Comment
StringLength    UI16        StringData length in bytes.
StringData      STRING      String data, up to 65535 bytes, with no terminating NUL


E.5 onMetaData

flv元数据对象应包含在名为onmet adat a的scriptdata标记中。运行中的actionscript程序可通过net st r eam使用各种属性。Onmet Adat a Property公司。可用属性因创建FLV文件的软件而异。典型特性包括：
onMetadata properties
Property Name   Type        Comment
audiocodecid    Number	    文件中使用的音频编解码器ID（有关可用的SoundFormat值，请参阅E.4.2.1）
audiodatarate   Number      音频比特率（千比特&#x2F;秒）
audiodelay      Number      音频编解码器引入的延迟（秒）
audiosamplerate Number      重播音频流的频率
audiosamplesize Number      单个音频样本的分辨率
canSeekToEnd    Boolean     表示最后一个视频帧是关键帧
creationdate    String      创建日期和时间
duration        Number      文件的总持续时间（秒）
filesize        Number      文件的总大小（字节）
framerate       Number      每秒帧数
height          Number      视频的高度（像素）
stereo          Boolean     指示立体声音频
videocodecid    Number      文件中使用的视频编解码器ID（有关可用的编解码器ID值，请参阅E.4.3.1）
videodatarate   Number      视频比特率（千比特&#x2F;秒）
width           Number      视频的宽度（像素）


E.6 flv中的xmp元数据

xmp元数据对象应包含在名为onxmpdat a的scriptData标记中。标记应及时放置。
0。标签应该在所有时间0之后，在所有时间0之前，在所有时间0之前，音频或视频标签，但读者不应该要求这样的排序。
XMPMetadata object
Property Name	Type	                Comment
liveXML         String or Long string	XMP元数据，根据XMP元数据规范格式化



For further details, see www.adobe.com&#x2F;devnet&#x2F;xmp&#x2F;pdfs&#x2F;XMPSpecificationPart3.pdf
附件F.FLV加密
F.1概述

1.加密头，包含解密flv所需的加密元数据，如加密
算法、密钥长度和内容加密密钥检索协议标识符在任何加密内容之前，在FLV头之后立即存储为脚本数据。
2.内容携带标签加密。
a.为了提高效率，可以选择只加密标签的子集，例如I帧。
b.如果标签被加密，那么包中的过滤器标志被打开。筛选标志指示
解码前需要对数据包进行预处理。加密筛选器在数据包中指定。不合规的玩家将忽略设置了筛选标志的标签，因为他们实际上有一个新的标签类型。
c.大多数元数据（例如，无论是音频或视频帧、关键帧还是I帧、编解码器类型）都是
保持清晰，以便服务器和客户端播放器可以处理元数据而无需解密内容。
d.根据加密算法和加密要求对内容进行加密。
关键。加密数据存储在包中。
此规范定义了头元数据和加密数据包的格式。
F.2标题信息
F.2.1 AdditionalHeader对象

在加密的FLV文件中，应存在额外的头对象，并且应包括加密头对象。
AdditionalHeader对象应包含在名为Additional Header的scriptData标记中。（注意名称中的竖线（“”））对象应该出现在flv的开头，时间戳为0，紧跟在onmet adat的scriptdata标记之后。这使FLV解码器能够在遇到任何加密标签之前访问加密元数据。
AdditionalHeader object
Property Name       Type                        Comment
Encryption          Encryption Header object	Encryption Header


F.2.2加密头对象

encryption header对象包含解密flv所需的加密元数据。加密头对象
Encryption Header object
Property Name       Type        Comment
Version             Number      加密头的版本。
                                应为1或2，表示
                                加密格式。
                                1&#x3D;FMRMS v1.x产品。
                                2&#x3D;闪存访问2.0产品。
                                使用任一版本保护的内容都存在，
                                因此应用程序应能够同时使用两个版本的内容。
Method              string      Encryption method. Shall be ‘Standard’
Flags               Number      Encryption flags. Shall be 0.
Params          Standard Encoding 
                Parameters object       加密方法“标准”的参数
IF Version &#x3D;&#x3D; 1
    SigFormat       String      在本文档中，没有提供有关sigformat的信息。
    Signature       Long string 本文件签名上未提供任何信息。


F.2.3标准编码参数对象

此结构包含特定于“标准”加密方法的参数。
Standard Encoding Parameters object
Property Name           Type                Comment
Version                 Number              Version. Shall be 1.
EncryptionAlgorithm     String              加密算法。应为“aes-cbc”，
                                            其中规定所使用的加密为“aes-cbc”，
                                            并根据RFC 2630填充。

EncryptionParams        AES-CBC             加密算法“aes-cbc”的参数。
                        Encryption 
                        Parameters object

KeyInfo                 Key Information     获取解密密钥的信息
                        object	


F.2.4 AES-CBC加密参数对象

这个结构包含特定于加密算法的参数，在本例中是aes-cbc_128。
AES-CBC Encryption Parameters object
Property Name           Type                Comment
KeyLength               Number              加密算法的密钥长度（字节）。应为16（即128位）


F.2.5关键信息对象

密钥信息框包含用于检索用于解密示例的密钥的信息。这些框中包含的条目的详细信息以及DRM客户机用于检索密钥的机制不在本规范的范围内。
Key Information object
Property Name            Type        Comment
SubType                 String          如果encryptionheader.version&#x3D;&#x3D;1
                                        aps&amp;#x27;&#x3D;（Adobe Policy Server）联机密钥协议协商协议
                                        否则
                                        FlashAccessv2&amp;#x27;&#x3D;联机密钥检索协议
Data                IF SubType &#x3D;&#x3D; ‘APS’
                    Adobe Policy Server object
                    IF SubType &#x3D;&#x3D; ’FlashAccessv2’
                    FlashAccessv2 object    子类型“aps”不再由符合要求的应用程序生成，因此没有提供进一步的信息


F.2.6 FlashAccessv2对象

闪存访问服务器使用联机密钥检索协议提供解密密钥。
FlashAccessv2对象包含FlashAccessv2模块执行联机密钥检索所需的以下高级元素（这些元素的详细信息不在文档范围内）。
FlashAccessv2 object
Property Name       Type            Comment
Metadata            Long string     DRM客户机用于检索解密密钥的Base 64编码元数据。


F.3内容加密

本节介绍如何加密FLV标记。
在加密的FLV文件中，每个FLV标记都可以指示其加密状态：
-筛选器标志可能指示在呈现数据包之前需要对其进行预处理。
-在版本2中，当设置过滤器标志时，选择性加密指示器可能进一步指示
数据包已加密。
无论文件是完全加密还是部分加密，在版本2中（encryptionheader.version&#x3D;&#x3D;2），每个音频和视频包都应该设置flvtag.filter位。对于未加密的脚本数据，不应设置过滤位，使播放器能够定位onmetadata信息。
一小部分指定的字节保持清晰，以便在不解密其余内容的情况下启用智能客户端处理。
F.3.1加密标记头

如果在flv标签中设置了filter标志，则在呈现前应对包内容进行预处理。加密标记头指定要应用的筛选器。过滤器指定加密类型并指示是否应用加密。
EncryptionTagHeader
Field               Type            Comments
NumFilters          UI8             Number of filters applied to the packet. Shall be 1.
FilterName          String          筛选器的名称。
                                    如果encryptionheader.version&#x3D;&#x3D;1
                                    &amp;#x27;加密&amp;#x27;
                                    否则
                                    “SE”
                                    SE代表选择性加密。
Length              UI24            Length of FilterParams in bytes


F.3.2滤波器参数

filterparams包含特定于解密方法的参数。
FilterParams
Field               Type                                Comments
FilterParams        IF FilterName &#x3D; ‘Encryption’        特定于筛选器的参数。
                        EncryptionFilterParams
                    IF FilterName &#x3D; ‘SE’
                        SelectiveEncryptionFilterParams



非选择性）加密的筛选器参数在encryptionfilterparams中定义。带有此字段的所有数据包都应加密。
EncryptionFilterParams
Field       Type        Comment
IV          UI8 [16]	包含16字节的AES-CBC IV数据。



选择加密的筛选参数在SelectiveEncryptionFilterParams中定义。
SelectiveEncryptionFilterParams
Field               Type            Comment
EncryptedAU         UB [1]          选择性加密指示器显示数据包是否加密。
                                    0&#x3D;数据包未加密
                                    1&#x3D;数据包已加密。
Reserved            UB [7]          Shall be 0
IV                  IF EncryptedAU &#x3D;&#x3D; 1
                    UI8 [16]        仅当数据包加密时才存在。包含16字节的AES-CBC IV数据


F.3.3加密正文

如果包是加密的，那么主体应包含本节所述的加密主体，否则主体应包含纯文本数据。
EncryptedBody
Field       Type                    Comment
Content     UI8 [Plaintext Length]	密码文本
Padding     UI8 [Padding Length]	加密填充。


3.3.1填充

所有加密样本应填充到块密码块长度的倍数。填料方案应如RFC 2630中所述，复制如下：
块密码期望输入数据是k八位字节的倍数（对于aes 128，是16个八位字节的倍数），其中k大于1。对于此类算法，输入应在尾端填充k-（length mod k）八位字节，所有八位字节的值均为k-（length mod k），其中length是输入的长度。
填充使块大小达到块密码块长度的下一整数倍。即使纯文本可以被块长度平均整除，也会出现填充。
示例：如果k为16字节，长度为32字节，填充长度为16字节，包含0x10，块大小为48字节。
F.4加密和元数据

当FLV加密时，OnMetadata脚本数据应始终保持清晰。
不同的flv解析器需要这一点来成功地传输flv，媒体播放器也需要这一点来为使用提供一些上下文信息。
</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a2"><span class="toc-number">3.</span> <span class="toc-text">2. F4V Box Definitions</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-1"><span class="toc-number">3.1.</span> <span class="toc-text">2.1. File Type box</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-2"><span class="toc-number">3.2.</span> <span class="toc-text">2.2. 渐进式下载信息框</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-3"><span class="toc-number">3.3.</span> <span class="toc-text">2.3.  Movie box</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-4"><span class="toc-number">3.4.</span> <span class="toc-text">2.4. Movie Header box</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-5"><span class="toc-number">3.5.</span> <span class="toc-text">2.5. Track box</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-5-1"><span class="toc-number">3.5.1.</span> <span class="toc-text">2.5.1. Track Header box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-5-2"><span class="toc-number">3.5.2.</span> <span class="toc-text">2.5.2. Edit box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-5-2-1"><span class="toc-number">3.5.3.</span> <span class="toc-text">2.5.2.1. Edit List box</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-6"><span class="toc-number">3.6.</span> <span class="toc-text">2.6. Media box</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-6-1"><span class="toc-number">3.6.1.</span> <span class="toc-text">2.6.1. Media Header box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-6-2"><span class="toc-number">3.6.2.</span> <span class="toc-text">2.6.2. Handler Reference box</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-7"><span class="toc-number">3.7.</span> <span class="toc-text">2.7. Media Information box</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-1"><span class="toc-number">3.7.1.</span> <span class="toc-text">2.7.1. Video Media Header box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-2"><span class="toc-number">3.7.2.</span> <span class="toc-text">2.7.2. Sound Media Header box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-3"><span class="toc-number">3.7.3.</span> <span class="toc-text">2.7.3. Hint Media Header box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-4"><span class="toc-number">3.7.4.</span> <span class="toc-text">2.7.4. Null Media Header box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-5"><span class="toc-number">3.7.5.</span> <span class="toc-text">2.7.5. Data Information box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-6"><span class="toc-number">3.7.6.</span> <span class="toc-text">2.7.6. Sample Table box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-6-1"><span class="toc-number">3.7.7.</span> <span class="toc-text">2.7.6.1. Decoding Time to Sample box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-6-2"><span class="toc-number">3.7.8.</span> <span class="toc-text">2.7.6.2. Composition Time to Sample box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-6-3"><span class="toc-number">3.7.9.</span> <span class="toc-text">2.7.6.3. Sample to Chunk box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-6-4"><span class="toc-number">3.7.10.</span> <span class="toc-text">2.7.6.4. Sample Size box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-6-5"><span class="toc-number">3.7.11.</span> <span class="toc-text">2.7.6.5. Chunk Offset box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-6-6"><span class="toc-number">3.7.12.</span> <span class="toc-text">2.7.6.6. Sync Sample box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-7-6-7"><span class="toc-number">3.7.13.</span> <span class="toc-text">2.7.6.7. Independent and Disposable Samples box</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-8"><span class="toc-number">3.8.</span> <span class="toc-text">2.8. Sample Description Box Structure</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-1"><span class="toc-number">3.8.1.</span> <span class="toc-text">2.8.1. Sample Description box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-2"><span class="toc-number">3.8.2.</span> <span class="toc-text">2.8.2. VisualSampleEntry box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-3"><span class="toc-number">3.8.3.</span> <span class="toc-text">2.8.3. AudioSampleEntry box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-4"><span class="toc-number">3.8.4.</span> <span class="toc-text">2.8.4. MetaDataSampleEntry box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-5"><span class="toc-number">3.8.5.</span> <span class="toc-text">2.8.5. SampleEntry box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-6"><span class="toc-number">3.8.6.</span> <span class="toc-text">2.8.6. HintSampleEntry box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-7"><span class="toc-number">3.8.7.</span> <span class="toc-text">2.8.7. Sample Descriptions for HTTP Streaming with Fragments</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-7-1"><span class="toc-number">3.8.8.</span> <span class="toc-text">2.8.7.1.  Adobe Mux Hint Sample Entry box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-7-2"><span class="toc-number">3.8.9.</span> <span class="toc-text">2.8.7.2. Adobe Mux Hint Process box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-7-3"><span class="toc-number">3.8.10.</span> <span class="toc-text">2.8.7.3. Adobe Mux Time Offset box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8"><span class="toc-number">3.8.11.</span> <span class="toc-text">2.8.8. Sample Descriptions for Protected Contents</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-1"><span class="toc-number">3.8.12.</span> <span class="toc-text">2.8.8.1. Encrypted Video box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-2"><span class="toc-number">3.8.13.</span> <span class="toc-text">2.8.8.2. Encrypted Audio box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-3"><span class="toc-number">3.8.14.</span> <span class="toc-text">2.8.8.3. Encrypted Data box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-4"><span class="toc-number">3.8.15.</span> <span class="toc-text">2.8.8.4. Protection Scheme Information box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-5"><span class="toc-number">3.8.16.</span> <span class="toc-text">2.8.8.5. Original Format box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-6"><span class="toc-number">3.8.17.</span> <span class="toc-text">2.8.8.6.  Scheme Type box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-7"><span class="toc-number">3.8.18.</span> <span class="toc-text">2.8.8.7.  Scheme Information box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-8"><span class="toc-number">3.8.19.</span> <span class="toc-text">2.8.8.8. Boxes for Adobe&#39;s Protection Scheme</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-8-1"><span class="toc-number">3.8.20.</span> <span class="toc-text">2.8.8.8.1.  Adobe DRM Key Management System box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-8-2"><span class="toc-number">3.8.21.</span> <span class="toc-text">2.8.8.8.2. Adobe DRM Header box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-8-3"><span class="toc-number">3.8.22.</span> <span class="toc-text">2.8.8.8.3. Standard Encryption Params box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-8-4"><span class="toc-number">3.8.23.</span> <span class="toc-text">2.8.8.8.4. Encryption Information box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-8-5"><span class="toc-number">3.8.24.</span> <span class="toc-text">2.8.8.8.5. Key Information box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-8-6"><span class="toc-number">3.8.25.</span> <span class="toc-text">2.8.8.8.6. Flash Access Params box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-8-8-8-7"><span class="toc-number">3.8.26.</span> <span class="toc-text">2.8.8.8.7. Adobe DRM Access Unit Format box</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a2-9"><span class="toc-number">4.</span> <span class="toc-text">2.9.  Movie Extends box</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-9-1"><span class="toc-number">4.1.</span> <span class="toc-text">2.9.1. Movie Extends Header box</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-9-2"><span class="toc-number">4.2.</span> <span class="toc-text">2.9.2. Track Extends box</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-10"><span class="toc-number">4.3.</span> <span class="toc-text">2.10. User Data box</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-11"><span class="toc-number">4.4.</span> <span class="toc-text">2.11. F4V Boxes for HTTP Streaming</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-11-1"><span class="toc-number">4.4.1.</span> <span class="toc-text">2.11.2. Fragment Random Access box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-11-2"><span class="toc-number">4.4.2.</span> <span class="toc-text">2.11.2. Bootstrap Info box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-11-2-1"><span class="toc-number">4.4.3.</span> <span class="toc-text">2.11.2.1. Segment Run Table box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-11-2-2"><span class="toc-number">4.4.4.</span> <span class="toc-text">2.11.2.2. Fragment Run Table box</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-12"><span class="toc-number">4.5.</span> <span class="toc-text">2.12. Movie Fragment box</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-12-1"><span class="toc-number">4.5.1.</span> <span class="toc-text">2.12.1. Movie Fragment Header box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-12-2"><span class="toc-number">4.5.2.</span> <span class="toc-text">2.12.2. Track Fragment box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-12-2-1"><span class="toc-number">4.5.3.</span> <span class="toc-text">2.12.2.1. Track Fragment Header box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-12-2-2"><span class="toc-number">4.5.4.</span> <span class="toc-text">2.12.2.2. Track Fragment Run box</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-13"><span class="toc-number">4.6.</span> <span class="toc-text">2.13.  Media Data box</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-13-1"><span class="toc-number">4.6.1.</span> <span class="toc-text">2.13.1.  Hint Track Samples for HTTP Streaming</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-13-1-1"><span class="toc-number">4.6.2.</span> <span class="toc-text">2.13.1.1. AdobeMuxHintSample</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-13-1-2"><span class="toc-number">4.6.3.</span> <span class="toc-text">2.13.1.2. AdobeMuxPacket</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-13-1-3"><span class="toc-number">4.6.4.</span> <span class="toc-text">2.13.1.3. AdobeMuxHintConstructor</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-13-1-4"><span class="toc-number">4.6.5.</span> <span class="toc-text">2.13.1.4. AdobeMuxHintImmediateConstructor</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-13-1-5"><span class="toc-number">4.6.6.</span> <span class="toc-text">2.13.1.5. AdobeMuxHintSampleConstructor</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-14"><span class="toc-number">4.7.</span> <span class="toc-text">2.14. Meta box</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-15"><span class="toc-number">4.8.</span> <span class="toc-text">2.15. Free Space boxes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a2-16"><span class="toc-number">4.9.</span> <span class="toc-text">2.16. Movie Fragment Random Access box</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-16-1"><span class="toc-number">4.9.1.</span> <span class="toc-text">2.16.1. Track Fragment Random Access box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a2-16-2"><span class="toc-number">4.9.2.</span> <span class="toc-text">2.16.2. Movie Fragment Random Access Offset box</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a3"><span class="toc-number">5.</span> <span class="toc-text">3. F4V Metadata</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a3-1"><span class="toc-number">5.1.</span> <span class="toc-text">3.1. Tag box</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a3-2"><span class="toc-number">5.2.</span> <span class="toc-text">3.2. XMP Metadata box</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a3-3"><span class="toc-number">5.3.</span> <span class="toc-text">3.3.  ilst box</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a3-4"><span class="toc-number">5.4.</span> <span class="toc-text">3.4. Text Track Metadata</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a3-4-1"><span class="toc-number">5.4.1.</span> <span class="toc-text">3.4.1. Style box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a3-4-2"><span class="toc-number">5.4.2.</span> <span class="toc-text">3.4.2. Highlight box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a3-4-3"><span class="toc-number">5.4.3.</span> <span class="toc-text">3.4.3. Highlight Color box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a3-4-4"><span class="toc-number">5.4.4.</span> <span class="toc-text">3.4.4. Karaoke box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a3-4-5"><span class="toc-number">5.4.5.</span> <span class="toc-text">3.4.5. Scroll Delay box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a3-4-6"><span class="toc-number">5.4.6.</span> <span class="toc-text">3.4.6. Drop Shadow Offset box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a3-4-7"><span class="toc-number">5.4.7.</span> <span class="toc-text">3.4.7. Drop Shadow Alpha box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a3-4-8"><span class="toc-number">5.4.8.</span> <span class="toc-text">3.4.8. Hypertext box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a3-4-9"><span class="toc-number">5.4.9.</span> <span class="toc-text">3.4.9. Text Box box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a3-4-10"><span class="toc-number">5.4.10.</span> <span class="toc-text">3.4.10. Blinking box</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a3-4-11"><span class="toc-number">5.4.11.</span> <span class="toc-text">3.4.11. Text Wrap box</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a4"><span class="toc-number">6.</span> <span class="toc-text">附件A.嵌入提示点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a4-1"><span class="toc-number">6.1.</span> <span class="toc-text">A.1.Overview</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a4-2"><span class="toc-number">6.2.</span> <span class="toc-text">A.2.AMF样本格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a4-3"><span class="toc-number">6.3.</span> <span class="toc-text">A.3.AMF数据跟踪结构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a4-3-1"><span class="toc-number">6.3.1.</span> <span class="toc-text">A.3.1.解码数据轨</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a4-4"><span class="toc-number">6.4.</span> <span class="toc-text">A.4.渐进式下载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a4-5"><span class="toc-number">6.5.</span> <span class="toc-text">A.5.多个数据轨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a5"><span class="toc-number">7.</span> <span class="toc-text">附件B.Flash播放器元数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a5-1"><span class="toc-number">7.1.</span> <span class="toc-text">B.1.流属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a5-2"><span class="toc-number">7.2.</span> <span class="toc-text">B.2.影像元数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a6"><span class="toc-number">8.</span> <span class="toc-text">附件C.HTTP流：文件结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a6-1"><span class="toc-number">8.1.</span> <span class="toc-text">C.1.概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a6-2"><span class="toc-number">8.2.</span> <span class="toc-text">C.2.HTTP流段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a6-3"><span class="toc-number">8.3.</span> <span class="toc-text">C.2.HTTP流片段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a6-4"><span class="toc-number">8.4.</span> <span class="toc-text">C.4.URL构造</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a6-5"><span class="toc-number">8.5.</span> <span class="toc-text">C.5.Adobe多路提示跟踪格式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a7"><span class="toc-number">9.</span> <span class="toc-text">附录D.F4V加密D.1概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a7-1"><span class="toc-number">9.1.</span> <span class="toc-text">D.1.加密过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a7-2"><span class="toc-number">9.2.</span> <span class="toc-text">D.2.加密过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a7-3"><span class="toc-number">9.3.</span> <span class="toc-text">D.3.样本加密</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a7-3-1"><span class="toc-number">9.3.1.</span> <span class="toc-text">D.3.1.接入单元头</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a7-3-2"><span class="toc-number">9.3.2.</span> <span class="toc-text">D.3.2.加密样本的填充</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a8"><span class="toc-number">10.</span> <span class="toc-text">附录E.FLV文件格式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a8-1"><span class="toc-number">10.1.</span> <span class="toc-text">E.1.概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a8-2"><span class="toc-number">10.2.</span> <span class="toc-text">E.2.FLV报头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a8-3"><span class="toc-number">10.3.</span> <span class="toc-text">E.3.FLV文件体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a8-4"><span class="toc-number">10.4.</span> <span class="toc-text">E.4.FLV标签定义</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-1"><span class="toc-number">10.4.1.</span> <span class="toc-text">E.4.1FLV标签</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-2"><span class="toc-number">10.4.2.</span> <span class="toc-text">E.4.2音频标签</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-2-1"><span class="toc-number">10.4.3.</span> <span class="toc-text">E.4.2.1音频数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-2-2"><span class="toc-number">10.4.4.</span> <span class="toc-text">E.4.2.2 AACAUDIODATA</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-3"><span class="toc-number">10.4.5.</span> <span class="toc-text">E.4.3视频标签</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-3-1"><span class="toc-number">10.4.6.</span> <span class="toc-text">E.4.3.1视频数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-3-2"><span class="toc-number">10.4.7.</span> <span class="toc-text">E.4.3.2 AVCVIDEOPACKET</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-4"><span class="toc-number">10.4.8.</span> <span class="toc-text">E.4.4数据标签</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-4-1"><span class="toc-number">10.4.9.</span> <span class="toc-text">E.4.4.1脚本数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-4-2"><span class="toc-number">10.4.10.</span> <span class="toc-text">E.4.4.2    SCRIPTDATAVALUE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-4-3"><span class="toc-number">10.4.11.</span> <span class="toc-text">E.4.4.3    SCRIPTDATADATE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-4-4"><span class="toc-number">10.4.12.</span> <span class="toc-text">E.4.4.4    SCRIPTDATAECMAARRAY</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-4-5"><span class="toc-number">10.4.13.</span> <span class="toc-text">E.4.4.5    SCRIPTDATALONGSTRING</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-4-6"><span class="toc-number">10.4.14.</span> <span class="toc-text">E.4.4.6    SCRIPTDATAOBJECT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-4-7"><span class="toc-number">10.4.15.</span> <span class="toc-text">E.4.4.7    SCRIPTDATAOBJECTEND</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-4-8"><span class="toc-number">10.4.16.</span> <span class="toc-text">E.4.4.8    SCRIPTDATAOBJECTPROPERTY</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-4-9"><span class="toc-number">10.4.17.</span> <span class="toc-text">E.4.4.9    SCRIPTDATASTRICTARRAY</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a8-4-4-10"><span class="toc-number">10.4.18.</span> <span class="toc-text">E.4.4.10    SCRIPTDATASTRING</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a8-5"><span class="toc-number">10.5.</span> <span class="toc-text">E.5 onMetaData</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a8-6"><span class="toc-number">10.6.</span> <span class="toc-text">E.6 flv中的xmp元数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a9"><span class="toc-number">11.</span> <span class="toc-text">附件F.FLV加密</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a9-1"><span class="toc-number">11.1.</span> <span class="toc-text">F.1概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a9-2"><span class="toc-number">11.2.</span> <span class="toc-text">F.2标题信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a9-2-1"><span class="toc-number">11.2.1.</span> <span class="toc-text">F.2.1 AdditionalHeader对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a9-2-2"><span class="toc-number">11.2.2.</span> <span class="toc-text">F.2.2加密头对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a9-2-3"><span class="toc-number">11.2.3.</span> <span class="toc-text">F.2.3标准编码参数对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a9-2-4"><span class="toc-number">11.2.4.</span> <span class="toc-text">F.2.4 AES-CBC加密参数对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a9-2-5"><span class="toc-number">11.2.5.</span> <span class="toc-text">F.2.5关键信息对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a9-2-6"><span class="toc-number">11.2.6.</span> <span class="toc-text">F.2.6 FlashAccessv2对象</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a9-3"><span class="toc-number">11.3.</span> <span class="toc-text">F.3内容加密</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#a9-3-1"><span class="toc-number">11.3.1.</span> <span class="toc-text">F.3.1加密标记头</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a9-3-2"><span class="toc-number">11.3.2.</span> <span class="toc-text">F.3.2滤波器参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a9-3-3"><span class="toc-number">11.3.3.</span> <span class="toc-text">F.3.3加密正文</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a9-3-3-1"><span class="toc-number">11.3.4.</span> <span class="toc-text">3.3.1填充</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#a9-4"><span class="toc-number">11.4.</span> <span class="toc-text">F.4加密和元数据</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/hy.jpeg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">雪人</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/cli/"><i class="fa-fw fas fa-retweet"></i><span> CLI</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 工具集</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/follow/"><i class="fa-fw fas fa-star"></i><span> 收藏夹</span></a></li><li><a class="site-page" href="/audio/"><i class="fa-fw fas fa-music"></i><span> audio_context</span></a></li><li><a class="site-page" href="/piano/"><i class="fa-fw fas fa-music"></i><span> 在线Piano</span></a></li><li><a class="site-page" href="/hy/"><i class="fa-fw fas fa-video"></i><span> Canvas绘图</span></a></li><li><a class="site-page" href="/jianyin/"><i class="fa-fw fas fa-video"></i><span> 剪映调色</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 文档库</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/2020/11/19/doc/ci/"><span> CI</span></a></li><li><a class="site-page" href="/2020/11/19/doc/h264/"><span> h264</span></a></li><li><a class="site-page" href="/2020/11/19/doc/f4v/"><span> f4v</span></a></li><li><a class="site-page" href="/2020/11/19/doc/mask/"><span> mask</span></a></li><li><a class="site-page" href="/2020/11/19/doc/dj/"><span> Django</span></a></li><li><a class="site-page" href="/2020/11/19/doc/mse/"><span> MSE</span></a></li></ul></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">f4v文件格式</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-11-19T06:06:47.977Z" title="发表于 2020-11-19 14:06:47">2020-11-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-11-19T06:06:47.978Z" title="更新于 2020-11-19 14:06:47">2020-11-19</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">29.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>113分钟</span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="Adobe-Flash-Video-File-Format-Specification"><a href="#Adobe-Flash-Video-File-Format-Specification" class="headerlink" title="Adobe Flash Video File Format Specification"></a>Adobe Flash Video File Format Specification</h1></h3><p>  Version 10.1</p>
<p>Introduction</p>
<p>Flash®是Web上动态媒体的事实标准，支持多种媒体格式，包括两种用于提供同步音频和视频流的核心容器格式：</p>
<ul>
<li><p>   F4V, for H.264/AAC–based content, and</p>
</li>
<li><p>   FLV, for other supported codecs such as Sorensen Spark and On2 VP6.</p>
</li>
</ul>
<p>本文档提供Adobe®产品支持的F4V和FLV视频文件格式的技术格式信息。<br>Adobe认真考虑所有对视频文件格式规范的反馈。 通过<a href="mailto:&#x66;&#x6c;&#x61;&#x73;&#104;&#102;&#x6f;&#114;&#x6d;&#x61;&#x74;&#x40;&#x61;&#100;&#111;&#98;&#x65;&#x2e;&#99;&#111;&#x6d;">&#x66;&#x6c;&#x61;&#x73;&#104;&#102;&#x6f;&#114;&#x6d;&#x61;&#x74;&#x40;&#x61;&#100;&#111;&#98;&#x65;&#x2e;&#99;&#111;&#x6d;</a>将规范中任何不清楚或可能错误的信息通过电子邮件发送给Adobe。 所有此类电子邮件提交均应遵守使用条款中的提交材料指南，网址为<a target="_blank" rel="noopener" href="http://www.adobe.com/misc/copyright.html%E3%80%82">www.adobe.com/misc/copyright.html。</a></p>
<p>The F4V Video File Format</p>
<p>F4V视频文件格式的开放规范建立在标准IEC 14496-12（MPEG-4 Part 12）ISO基础媒体文件格式之上。 它具有灵活的结构，并定义了特定支持的编解码器和扩展。 因此，F4V视频文件格式简化了动态媒体软件的实现，促进了工具，服务和客户端之间的互操作性。</p>
<p>从Flash Player 9 Update 3（9,0,115,0）开始，Flash Player可以播放F4V文件。 有关F4V视频文件格式的详细信息，请参阅第1节.F4V文件格式<br>有关在F4V文件中使用元数据的信息，请参阅第3节.F4V元数据。</p>
<p>New in the F4V Video File Format</p>
<p>Flash Player 10,1,53,64的发布增加了Flash F4V视频文件格式中以下功能和框的支持。 斜体框由Adobe Systems定义。</p>
<p>新功能提示点，加密，提示，HTTP流媒体</p>
<p>New Boxes</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">abst	adaf	adkm	aeib	afra	afrt	ahdr	akey	amhp	amto	aprm	aps</span><br><span class="line">asig	asrt	dinf	dref	edit	elst	enca	encr	encv	flxs	frma	hdlr</span><br><span class="line">hmdh  mehd   mfhd	mfra	mfro	moof	mvex	nmhd   rtmp	schi	schm	sdtp</span><br><span class="line">sinf	smhd   tfhd	tfra	traf	trex	trun	url	vmhd</span><br></pre></td></tr></table></figure>


<p>The FLV Video File Format</p>
<p>FLV文件对同步的音频和视频流进行编码。 FLV文件中的音频和视频数据的编码方式与SWF文件中的音频和视频相同。本文档描述了FLV版本1.参见附录E. FLV文件格式</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">注：</span><br><span class="line">    UA: userAgent</span><br><span class="line">    -- : 回车</span><br></pre></td></tr></table></figure>

<h3 id="a1">1. F4V文件格式</h3>
<h4 id="a1-1">1.1. Overview</h4>

<p>Flash Player 9 Update 3（9,0,115,0）及更高版本可以播放F4V文件。 F4V格式基于ISO / IEC 14496-12：2008 ISO基础媒体文件格式。</p>
<p>将F4V格式与ISO基础媒体文件格式区分开来的很大一部分涉及F4V可以存储的元数据格式。 本章讨论除元数据之外的F4V格式的所有方面，第3节F4V元数据对此进行了介绍。</p>
<h4 id="a1-2">1.2. 简单数据类型</h4>

<p>This following data types are used in F4V files.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Type     	Definition</span><br><span class="line"><span class="number">0</span>x…	      Hexadecimal value …</span><br><span class="line"><span class="number">4</span>CC	      Four-character ASCII code, such <span class="keyword">as</span> <span class="string">&#x27;moov&#x27;</span>, encoded <span class="keyword">as</span> UI32</span><br><span class="line">SI8	      Signed <span class="number">8</span>-bit integer</span><br><span class="line">SI8<span class="number">.8</span>	    Signed <span class="number">16</span>-bit fixed point number having <span class="number">8</span> fractional bits</span><br><span class="line">SI16	    Signed <span class="number">16</span>-bit integer</span><br><span class="line">SI16<span class="number">.16</span>	  Signed <span class="number">32</span>-bit fixed point number having <span class="number">16</span> fractional bits</span><br><span class="line">SI24	    Signed <span class="number">24</span>-bit integer</span><br><span class="line">SI32	    Signed <span class="number">32</span>-bit integer</span><br><span class="line">SI64	    Signed <span class="number">64</span>-bit integer</span><br><span class="line">STRING	  Sequence <span class="keyword">of</span> Unicode <span class="number">8</span>-bit characters (UTF-<span class="number">8</span>), terminated <span class="keyword">with</span> <span class="number">0x00</span> (unless otherwise specified)</span><br><span class="line">UI8	      Unsigned <span class="number">8</span>-bit integer</span><br><span class="line">UI16	    Unsigned <span class="number">16</span>-bit integer</span><br><span class="line">UI16<span class="number">.16</span>	  Unsigned <span class="number">32</span>-bit fixed point number having <span class="number">16</span> fractional bits</span><br><span class="line">UI24	    Unsigned <span class="number">24</span>-bit integer</span><br><span class="line">UI32	    Unsigned <span class="number">32</span>-bit integer</span><br><span class="line">UI64	    Unsigned <span class="number">64</span>-bit integer</span><br><span class="line">UIn	      Bit field <span class="keyword">with</span> unsigned n-bit integer, where n is <span class="keyword">in</span> the range <span class="number">1</span> to <span class="number">31</span>, excluding <span class="number">8</span>, <span class="number">16</span>, <span class="number">24</span></span><br><span class="line">xxx [ ]	  <span class="built_in">Array</span> <span class="keyword">of</span> type xxx. <span class="built_in">Number</span> <span class="keyword">of</span> elements to be inferred, <span class="keyword">for</span> example <span class="keyword">from</span> box size.</span><br><span class="line">xxx [n]	  <span class="built_in">Array</span> <span class="keyword">of</span> n elements <span class="keyword">of</span> type xxx</span><br></pre></td></tr></table></figure>


<p>与SWF相比，多字节整数应以big-endian字节顺序存储，SWF使用little-endian字节顺序。 例如，作为SWF文件格式的UI16，表示数字300（0x12C）的字节序列是0x2C 0x01; 作为F4V文件格式的UI16，表示数字300的字节序列是0x01 0x2C。</p>
<h4 id="a1-3">1.3. F4V box format</h4>

<p>F4V文件的基本构建块是具有以下BOX格式的框：F4V框</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	      Type	      Comment</span><br><span class="line">Header	  BOXHEADER	    所有框都具有一致的标题</span><br><span class="line">Payload	  UI8 [ ]	      字节数，其长度由boxheader定义。</span><br></pre></td></tr></table></figure>


<p>每个框结构以一个BoxHeader结构开头：BoxHeader</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	          Type	           Comment</span><br><span class="line">TotalSize       UI32            框的总大小（以字节为单位），包括此标头。 <span class="number">0</span>表示该框延伸到文件末尾。</span><br><span class="line">BoxType	        UI32	          The type <span class="keyword">of</span> the box, usually <span class="keyword">as</span> <span class="number">4</span>CC</span><br><span class="line"></span><br><span class="line">ExtendedSize    IF TotalSize    框的总<span class="number">64</span>位长度（字节），包括此头</span><br><span class="line">                == <span class="number">1</span></span><br><span class="line">                UI64</span><br></pre></td></tr></table></figure>


<p>许多盒子的长度都小于4GB，可以将它们的大小存储在totalSize字段中。通过将32位totalSize字段设置为1并以extendedSize存储64位大小，该格式还支持非常大的框。每个框都用32位类型标识。对于大多数框，此32位类型可兼作人可读的四字符ASCII代码或4cc，例如“moov”（0x6d6f6f76）和“mdat”（0x6d646174）。</p>
<p>箱有效载荷紧跟箱头。有效负载的字节大小等于框的总大小减去8字节或16字节，具体取决于头的大小。</p>
<p>有关更多信息，请参见ISO/IEC 14496-12:2008第4.2节。</p>
<h4 id="a1-4">1.4. f4v框层次</h4>

<p>Table 1. The F4V Box Hierarchy</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Box Type	                  Required?	                    Short Description</span><br><span class="line">ftyp                        Y	                            文件类型和兼容性</span><br><span class="line">pdin                        N	                            渐进式下载信息</span><br><span class="line">afra                        See HTTP streaming            HTTP流的分段随机访问</span><br><span class="line">abst                        See HTTP streaming            HTTP流的引导信息</span><br><span class="line">    asrt                    Y	                            将片段映射到段</span><br><span class="line">    afrt                    Y	                            将时间映射到片段</span><br><span class="line">moov                        Y	                            结构元数据容器</span><br><span class="line">    mvhd                    Y	                            Movie标题，整体声明</span><br><span class="line">    trak                    Y	                            单个轨道的Container</span><br><span class="line">        tkhd                Y	                            标题,主要属性</span><br><span class="line">        edts                N	                            编辑列表容器</span><br><span class="line">            elst            N	                            时间线映射</span><br><span class="line">        mdia                Y	                            媒体轨属性容器</span><br><span class="line">            mdhd            Y	                            媒体track属性</span><br><span class="line">            hdlr            Y	                            处理程序，声明媒体类型</span><br><span class="line">            minf            Y	                            媒体信息容器</span><br><span class="line">                vmhd	                                    视频媒体标题</span><br><span class="line">                smhd                                      声音媒体标题</span><br><span class="line">                hmhd                                      提示媒体标题</span><br><span class="line">                nmhd        Y,其中一个根据媒体类型            空媒体头</span><br><span class="line">                dinf        Y	                            数据信息容器</span><br><span class="line">                  dref      Y	                            数据参考</span><br><span class="line">                      url   Y	                            网址参考</span><br><span class="line">                stbl        Y	                            样本属性容器</span><br><span class="line">                  stsd      Y	                            示例描述（编解码器类型等）</span><br><span class="line">                  stts      Y	                           地图解码采样时间</span><br><span class="line">                  ctts      N	                            将合成时间映射到样本</span><br><span class="line">                  stsc      Y	                            将示例映射到块</span><br><span class="line">                  stsz      N	                           样本大小</span><br><span class="line">                  stco</span><br><span class="line">                  co64      Y, stco or co64               块偏移</span><br><span class="line">                  stss      N	                            同步示例表</span><br><span class="line">                  sdtp      N	                            独立和一次性样品</span><br><span class="line">    mvex                    N	                            Movie <span class="keyword">extends</span></span><br><span class="line">        mehd                N	                            Movie <span class="keyword">extends</span> header</span><br><span class="line">        trex                Y	                            Track <span class="keyword">extends</span> defaults</span><br><span class="line">    auth                    N	                            Author metadata tag</span><br><span class="line">    titl                    N	                            Title metadata tag</span><br><span class="line">    dscp                    N	                            Description metadata tag</span><br><span class="line">    cprt                    N	                            Copyright metadata tag</span><br><span class="line">    udta                    N	                            User data</span><br><span class="line">uuid                        N	                            XMP Metadata</span><br><span class="line">moof                        N	                            Movie fragment</span><br><span class="line">    mfhd                    Y	                            Movie fragment header</span><br><span class="line">    traf                    N	                            Track fragment</span><br><span class="line">      tfhd                  Y	                            Track fragment header</span><br><span class="line">      trun                  N	                            Track fragment run</span><br><span class="line">mdat                        Y 对于HTTP流以外的其他流          Media data container</span><br><span class="line">meta                        N                           	Container <span class="keyword">for</span> metadata boxes</span><br><span class="line">    ilst                    N                           	Metadata tags</span><br><span class="line">free                        N	                            Free space</span><br><span class="line">skip                        N	                            Free space</span><br><span class="line">mfra                        N                           	Movie fragment random access</span><br><span class="line">    tfra                    N	                            Track fragment random access</span><br><span class="line">    mfro                    Y	                            Movie fragment random access offset</span><br></pre></td></tr></table></figure>

<h4 id="a1-5">1.5. 示例描述框层次结构</h4>

<p>Table 2 shows the hierarchy within the Sample Description box.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Box Name	                        Required?                       Short Description</span><br><span class="line">stsd                              Y	                              Sample descriptions</span><br><span class="line">    Mediatype-specific</span><br><span class="line">    sample entry boxes            Y 除加密外                        此track的示例说明</span><br><span class="line">    rtmp                          Y <span class="keyword">for</span> HTTP streaming            Adobe MUX提示示例条目</span><br><span class="line">        amhp                      Y	                              Adobe MUX提示过程</span><br><span class="line">        amto                      N	                              Adobe Mux时间偏移</span><br><span class="line">    encv</span><br><span class="line">    enca</span><br><span class="line">    encr                          Y <span class="keyword">for</span> encryption                加密track的示例说明条目</span><br><span class="line">        sinf                      Y	                              保护方案信息</span><br><span class="line">            frma                  Y	                              原始格式</span><br><span class="line">            schm                  Y	                              方案Type</span><br><span class="line">            schi                  Y	                              方案信息</span><br><span class="line">              adkm                Y                             	Adobe的DRM密钥管理系统</span><br><span class="line">                ahdr              Y	                              Adobe DRM标题</span><br><span class="line">                  aprm            Y	                              标准加密参数</span><br><span class="line">                    aeib          Y	                              加密信息</span><br><span class="line">                    akey          Y	                              关键信息</span><br><span class="line">                      aps         N	                              frms v1.x参数</span><br><span class="line">                      flxs        N	                              闪存访问v <span class="number">2.0</span>参数</span><br><span class="line">                  asig            N	                              Adobe 签名</span><br><span class="line">                adaf              Y	                              Adobe DRM 访问单元格式</span><br></pre></td></tr></table></figure>

<h4 id="a1-6">1.6. 处理不支持的boxes</h4>

<p>ISO规范ISO/IEC 14496-12:2008和Apple QuickTime规范定义了本规范中未包含的其他盒子类型。这些框类型不是f4v文件格式的一部分，f4v播放器不需要支持它们。F4V播放器应忽略不支持的盒子及其内容，并继续播放文件。</p>
<h4 id="a1-7">1.7. 排序</h4>

<p>为了获得最佳的播放器性能，F4V文件中所需的顶级框应按以下顺序排列：</p>
<ol>
<li><p>   File Type (ftyp),</p>
</li>
<li><p>   Movie (moov),</p>
</li>
</ol>
<p>.    Media Data (mdat).</p>
<p>FTYP箱应位于MOOV和MDAT箱以及任何其他“重要”可变尺寸箱之前。ftyp框应该是文件中的第一个框，或者尽可能早地位于文件中。</p>
<p>虽然Flash播放器可以同时播放MOOV和MDAT盒的订单，但MOOV盒应始终位于MDAT盒之前，因为这样可以更快地启动和进行流式处理。</p>
<p>许多f4v文件创建工具以次优的顺序放置方框以便播放，在这种情况下，应应用后处理步骤以推荐的顺序放置方框。</p>
<p>有关HTTP流支持所需的框和框顺序，请参阅附录C.HTTP流：文件结构。</p>
<h4 id="a1-8">1.8. Supported Media Types</h4>

<p>下表描述了可以封装在F4V文件中的媒体类型。</p>
<h5 id="a1-8-1">1.8.1. Supported audio types</h5>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Media type      	Comments</span><br><span class="line">MP3               媒体类型.mp3（<span class="number">0x2e6d7033</span>）表示曲目包含MP3音频数据。</span><br><span class="line">                  点号字符hex <span class="number">0x2e</span>用于生成完整的四字符代码。</span><br><span class="line">AAC               媒体类型MP4A（<span class="number">0x6D703461</span>）表示该曲目使用AAC音频编码。</span><br><span class="line">                  Flash播放器支持以下AAC配置文件，由它们的对象类型表示：</span><br><span class="line">-	<span class="number">1</span> = main profile</span><br><span class="line">-	<span class="number">2</span> = low complexity, a.k.a. LC</span><br><span class="line">-	<span class="number">5</span> = high efficiency/scale band replication, a.k.a. HE/SBR</span><br></pre></td></tr></table></figure>


<p>当音频编解码器为AAC时，示例表的STSD框中会出现一个ESDS框。此框包含AAC解码器解码流所需的初始化数据。有关此框结构的更多信息，请参见ISO/IEC 14496-3。</p>
<h5 id="a1-8-2">1.8.2. Supported video types</h5>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Media type	         Comments</span><br><span class="line">GIF                  媒体类型的gif（<span class="number">0x67696620</span>）表示使用CompuServe gif格式压缩的视频数据的静止帧。</span><br><span class="line">                    包括空格字符hex <span class="number">0x20</span>，以生成完整的四字符代码。</span><br><span class="line">  </span><br><span class="line">PNG                 PNG的媒体类型（<span class="number">0x706E6720</span>）表示使用标准PNG格式压缩的视频数据的静止帧。</span><br><span class="line">                    包括空格字符hex <span class="number">0x20</span>，以生成完整的四字符代码。</span><br><span class="line"></span><br><span class="line">JPEG                jpeg（<span class="number">0x6a706567</span>）的媒体类型表示使用标准jpeg格式压缩的视频数据的静止帧。</span><br><span class="line"></span><br><span class="line">H<span class="number">.264</span>               h264（<span class="number">0x48323634</span>）、h264（<span class="number">0x68323634</span>）或avc1（<span class="number">0x61766331</span>）</span><br><span class="line">                    的媒体类型表示该曲目使用H<span class="number">.264</span>视频编码。Flash播放器支持以下H<span class="number">.264</span>视频配置文件：</span><br><span class="line"></span><br><span class="line">-	<span class="number">0</span> = 支持忽略设置配置文件的旧媒体</span><br><span class="line">-	<span class="number">66</span> = baseline</span><br><span class="line">-	<span class="number">77</span> = extended</span><br><span class="line">-	<span class="number">88</span> = main</span><br><span class="line">-	<span class="number">100</span> = YUV <span class="number">4</span>:<span class="number">2</span>:<span class="number">0</span>, <span class="number">8</span> bits/sample, a.k.a. “High”</span><br><span class="line">-	<span class="number">110</span> = YUV <span class="number">4</span>:<span class="number">2</span>:<span class="number">0</span>, <span class="number">10</span> bits/sample, a.k.a. “High <span class="number">10</span>”</span><br><span class="line">-	<span class="number">122</span> = YUV <span class="number">4</span>:<span class="number">2</span>:<span class="number">2</span>, <span class="number">10</span> bits/sample, a.k.a. “High <span class="number">4</span>:<span class="number">2</span>:<span class="number">2</span>”</span><br><span class="line">-	<span class="number">144</span> = YUV <span class="number">4</span>:<span class="number">4</span>:<span class="number">4</span>, <span class="number">12</span> bits/sample, a.k.a. “High <span class="number">4</span>:<span class="number">4</span>:<span class="number">4</span>”</span><br><span class="line">当视频编解码器为H<span class="number">.264</span>时，在示例表的STSD框中会出现一个AVCC框。此框包含H<span class="number">.264</span>解码器解码流所需的初始化数据。</span><br><span class="line">BoxHeader后面的字节<span class="number">1</span>和<span class="number">3</span>分别包含AVC数据的概要文件和级别。有关AVCC箱其余部分的更多信息，</span><br><span class="line">请参见ISO/IEC <span class="number">14496</span>-<span class="number">15</span>第<span class="number">5.3</span><span class="number">.4</span><span class="number">.1</span>节。</span><br><span class="line"></span><br><span class="line">VP6                 以下媒体类型表示该曲目是用on2 vp6视频编码的。-VP6F（<span class="number">0x56503646</span>）</span><br><span class="line"></span><br><span class="line">-	VP6A (<span class="number">0x56503641</span>)</span><br><span class="line">-	VP60 (<span class="number">0x56503630</span>)</span><br><span class="line">-	VP61 (<span class="number">0x56503631</span>)</span><br><span class="line">-	VP62 (<span class="number">0x56503632</span>)</span><br></pre></td></tr></table></figure>

<h5 id="a1-8-3">1.8.3. Supported data types</>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Media type       	Comments</span><br><span class="line">Text              文本（<span class="number">0x74657874</span>）或tx3g（<span class="number">0x74783367</span>）</span><br><span class="line">                  的媒体类型表示曲目包含通过ActionScript提供的文本数据。</span><br><span class="line">AMF0              媒体类型amf0（<span class="number">0x616d6630</span>）表示该曲目包含与操作脚本消息格式</span><br><span class="line">                  （amf）的原始版本相对应的数据。</span><br><span class="line">AMF3              媒体类型amf3（<span class="number">0x616d6633</span>）表示该曲目包含与操作脚本消息格式（amf）版本<span class="number">3</span>对应的数据。</span><br></pre></td></tr></table></figure>

<h3 id="a2">2. F4V Box Definitions</h3>

<p>定义了f4v文件格式支持的框。</p>
<h4 id="a2-1">2.1. File Type box</h4>

<p>Box type: ‘ftyp’ </p>
<p>Container: File </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>f4v格式基于iso mpeg4格式，而iso mpeg4格式又基于Apple QuickTime容器格式。格式的子集支持不同的功能。文件类型（ftyp）框有助于识别程序播放特定文件所需支持的功能。</p>
<p>FTYP箱应尽早放置，并应位于任何可变长度箱之前。</p>
<p>flash player对ftyp框没有任何限制。如果文件包含Flash播放器可以解码的数据，Flash播放器会尝试播放。</p>
<p>ftyp box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                Type           Comments</span><br><span class="line">Header              	BOXHEADER	     BoxType = <span class="string">&#x27;ftyp&#x27;</span> (<span class="number">0x66747970</span>)</span><br><span class="line">MajorBrand            UI32          主要品牌标识符。对于f4v文件，majorbrand是<span class="string">&#x27;f4v&#x27;</span>（<span class="number">0x66347620</span>）。</span><br><span class="line"></span><br><span class="line">MinorVersion          UI32          Minorversion仅提供信息。不得用于确定文件是否符合标准。</span><br><span class="line">                                    它可能允许更精确地识别主要品牌，以便进行检查、调试或改进解码。</span><br><span class="line">                                    compatible brands ui32[]任意数量的兼容品牌，直到包装盒结束</span><br></pre></td></tr></table></figure>


<p>For more information, see section 4.3 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-2">2.2. 渐进式下载信息框</h4>

<p>Box type: ‘pdin’ </p>
<p>Container: File </p>
<p>Mandatory: No </p>
<p>Quantity: One</p>
<p>渐进式下载信息（PDIN）框定义有关渐进式下载的信息。pdin框的有效负载提供了一些提示，提示玩家在安全开始播放之前要下载多少数据。</p>
<p>pdin框应尽可能早地放置在文件中，位于文件类型（ftyp）框之后，以获得最大的实用性。</p>
<p>pdin box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	          Type	        Comment</span><br><span class="line">Header          BOXHEADER	    BoxType = <span class="string">&#x27;pdin&#x27;</span> (<span class="number">0x7064696E</span>)</span><br><span class="line">Version         UI8	          Expected to be <span class="number">0</span></span><br><span class="line">Flags           UI24	        Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">RateDelay       RATEDELAY[]	  任意数量的RATEDLAY记录，直到方框结束</span><br><span class="line">Rate            UI32	        此记录要考虑的速率（字节/秒）</span><br><span class="line">InitialDelay    UI32	        以此速率开始播放之前要延迟的毫秒数</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.1.3 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-3">2.3.  Movie box</h4>

<p>Box type: ‘moov’ </p>
<p>Container: File </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>Movie（moov）框实际上是一个f4v文件的“头”。MOOV框本身包含一个或多个其他框，而其他框又包含定义F4V数据结构的其他框。</p>
<p>moov box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	      Type        	Comment</span><br><span class="line">Header	    BOXHEADER	    BoxType = <span class="string">&#x27;moov&#x27;</span> (<span class="number">0x6D6F6F76</span>)</span><br><span class="line">Boxes	      BOX [ ]	      定义文件结构的任意框数</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.2.1 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-4">2.4. Movie Header box</h4>

<p>Box type: ‘mvhd’ </p>
<p>Container: Movie box (‘moov’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>Movie标题（MVHD）框定义应用于整个F4V文件的播放信息。MVHD箱应首先放置在其容器中。</p>
<p>mvhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field     	    Type	              Comment</span><br><span class="line">Header	        BOXHEADER	          BoxType = <span class="string">&#x27;mvhd&#x27;</span> (<span class="number">0x6D766864</span>)</span><br><span class="line">Version	        UI8	                Either <span class="number">0</span> or <span class="number">1</span></span><br><span class="line">Flags           UI24	              Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">CreationTime    IF Version == <span class="number">0</span>     f4v文件的创建时间，</span><br><span class="line">                UI32                表示为自<span class="number">1904</span>年<span class="number">1</span>月<span class="number">1</span>日午夜（UTC）以来经过的秒数。</span><br><span class="line">                IF Version == <span class="number">1</span></span><br><span class="line">                UI64</span><br><span class="line"></span><br><span class="line">ModificationTime	IF Version == <span class="number">0</span>   f4v文件的最后一次修改时间，</span><br><span class="line">                UI32                表示为自<span class="number">1904</span>年<span class="number">1</span>月<span class="number">1</span>日午夜（UTC）以来经过的秒数。</span><br><span class="line">                IF Version == <span class="number">1</span></span><br><span class="line">                UI64</span><br><span class="line">TimeScale       UI32                整个f4v文件的时间坐标系，以每秒的时间单位数表示。</span><br><span class="line">                                    例如，<span class="number">100</span>表示时间单位为<span class="number">1</span>/<span class="number">100</span>秒。</span><br><span class="line">Duration        IF Version == <span class="number">0</span></span><br><span class="line">                UI32                以时间刻度单位表示的F4V文件的总长度</span><br><span class="line">                IF Version == <span class="number">1</span>     也是文件中最长曲目的持续时间。</span><br><span class="line">                UI64</span><br><span class="line">Rate            SI16<span class="number">.16</span>             首选播放速率，以固定点<span class="number">16.16</span>数字表示</span><br><span class="line">                                    （通常为<span class="number">0x00010000</span>=<span class="number">1.0</span>，或正常播放速率）</span><br><span class="line">Volume          SI8<span class="number">.8</span>               文件的主卷，表示为定点<span class="number">8.8</span>号</span><br><span class="line">                                    （通常为<span class="number">0x0100</span>=<span class="number">1.0</span>，或完整卷）。</span><br><span class="line">Reserved        UI16	              Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">Reserved        UI32 [<span class="number">2</span>]	          Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">Matrix          SI32 [<span class="number">9</span>]            f4v文件的转换矩阵应为:</span><br><span class="line">                                    &#123;<span class="number">0x00010000</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                                    <span class="number">0</span>, <span class="number">0x00010000</span>, <span class="number">0</span>,</span><br><span class="line">                                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x40000000</span>&#125;</span><br><span class="line">Reserved        UI32 [<span class="number">6</span>]	          Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">NextTrackID     UI32                要添加到演示文稿的下一个track的ID。</span><br><span class="line">                                    该值不应为<span class="number">0</span>，但可以全部为<span class="number">1</span>，以表示未定义状态。</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.2.2 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-5">2.5. Track box</h4>

<p>Box type: ‘trak’ </p>
<p>Container: Movie box (‘moov’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One or more</p>
<p>每个trak框对应于f4v文件中的单个媒体曲目，并包含进一步定义媒体曲目属性的框。</p>
<p>trak box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	          Type               Comment</span><br><span class="line">Header	        BOXHEADER	         BoxType = <span class="string">&#x27;trak&#x27;</span> (<span class="number">0x7472616B</span>)</span><br><span class="line">Boxes	          BOX [ ]	           定义媒体轨的任意框数</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.3.1 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-5-1">2.5.1. Track Header box</h5>

<p>Box type: ‘tkhd’ </p>
<p>Container: Movie box (‘trak’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>The Track Header （TKHD）框描述磁道的主要属性。TKHD箱应首先放在其容器中。</p>
<p>tkhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	            Type	            Comment</span><br><span class="line">Header	          BOXHEADER	        BoxType = <span class="string">&#x27;tkhd&#x27;</span> (<span class="number">0x746B6864</span>)</span><br><span class="line"></span><br><span class="line">Version	          UI8	              Either <span class="number">0</span> or <span class="number">1</span></span><br><span class="line">Flags             UI24              Bit <span class="number">0</span> = 开启</span><br><span class="line">                                    Bit <span class="number">1</span> = the track is part <span class="keyword">of</span> the presentation</span><br><span class="line">                                    Bit <span class="number">2</span> = the track should be considered when previewing the F4V file</span><br><span class="line">CreationTime      IF Version == <span class="number">0</span></span><br><span class="line">                  UI32              轨道的创建时间</span><br><span class="line">                  IF Version == <span class="number">1</span></span><br><span class="line">                  UI64</span><br><span class="line">ModificationTime	IF Version == <span class="number">0</span></span><br><span class="line">                  UI32              轨道的最后修改时间</span><br><span class="line">                  IF Version == <span class="number">1</span></span><br><span class="line">                  UI64</span><br><span class="line">TrackID	          UI32	            track唯一标识符</span><br><span class="line">Reserved	        UI32	            Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">Duration          IF Version == <span class="number">0</span></span><br><span class="line">                  UI32              音轨的持续时间</span><br><span class="line">                  IF Version == <span class="number">1</span></span><br><span class="line">                  UI64</span><br><span class="line"></span><br><span class="line">Reserved          UI32 [<span class="number">2</span>]	        Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">Layer             SI16              track前后排序的位置，对于f4v文件，预计为<span class="number">0</span>。</span><br><span class="line">AlternateGroup	  SI16	            <span class="number">0</span></span><br><span class="line">Volume            SI8<span class="number">.8</span>             音频轨为<span class="number">0x0100</span>（定点<span class="number">8.8</span>，数字代表<span class="number">1.0</span>），否则为<span class="number">0</span></span><br><span class="line">Reserved          UI16	            Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">TransformMatrix	  SI32[<span class="number">9</span>]           定义透视变换的固定点值矩阵，应</span><br><span class="line">                                    &#123;<span class="number">0x00010000</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">                                    <span class="number">0</span>, <span class="number">0x00010000</span>, <span class="number">0</span></span><br><span class="line">                                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x40000000</span>&#125;</span><br><span class="line">Width             UI16<span class="number">.16</span>	          以固定点表示的宽度<span class="number">16.16</span>数字</span><br><span class="line">Height	          UI16<span class="number">.16</span>	          以固定点表示的高度<span class="number">16.16</span>数字</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.6.5 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-5-2">2.5.2. Edit box</h5>

<p>Box type: ‘edts’ </p>
<p>Container: Track box (‘trak’) </p>
<p>Mandatory: No </p>
<p>Quantity: One</p>
<p>编辑（EDTS）框将演示时间线映射到媒体时间线，因为它存储在F4V文件中。EDTS框是编辑列表的容器。</p>
<p>如果文件不包含EDTS框，则会隐式地对这些时间线进行一对一映射。EDTS框应位于媒体（MDIA）框之前。</p>
<p>edit box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	            Type	          Comment</span><br><span class="line">Header            BOXHEADER	      BoxType = <span class="string">&#x27;edts&#x27;</span> (<span class="number">0x65647473</span>)</span><br><span class="line">Edit list box	    BOX	            An explicit time-line map</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.6.5 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-5-2-1">2.5.2.1. Edit List box</h5>

<p>Box type: ‘elst’ </p>
<p>Container: Edit box (‘edts’) </p>
<p>Mandatory: No </p>
<p>Quantity: One</p>
<p>tkhd box</p>
<p>编辑列表（ELST）框以编辑列表条目的形式包含显式时间线图。ELST框中的每个条目通过以下方式之一定义了演示时间线的一部分：</p>
<p>-通过映射媒体时间表的一部分</p>
<p>-通过指示空时间（即间隙）</p>
<p>-通过定义停留时间（即一个时间点停留一段时间的位置）</p>
<p>编辑列表框中的空编辑表示间隙。若要指定轨迹的起始偏移，请在轨迹的起始处插入空的编辑。</p>
<p>空编辑不应是曲目中的最后一个编辑。如果在“影片标题”框中指定的持续时间与曲目的实际持续时间不同，则会在曲目末尾放置一个隐式空编辑。</p>
<p>媒体应该在间隙后立即有一个关键帧。另外，flash播放器可以使用同步采样框中的数据在间隙后查找关键帧。</p>
<p>elst box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	              Type	            Comment</span><br><span class="line">Header              BOXHEADER         BoxType = <span class="string">&#x27;elst&#x27;</span> (<span class="number">0x656C7374</span>)</span><br><span class="line">Version	            UI8               Either <span class="number">0</span> or <span class="number">1</span></span><br><span class="line">Flags	              UI24	            Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">EntryCount  	      UI32	            <span class="built_in">Number</span> <span class="keyword">of</span> entries <span class="keyword">in</span> the edit list entry table</span><br><span class="line">EditListEntryTable	ELSTRECORD </span><br><span class="line">                    [EntryCount]	    An array <span class="keyword">of</span> ELSTRECORD structures</span><br><span class="line">SegmentDuration	    IF Version == <span class="number">0</span></span><br><span class="line">                    UI32              此编辑段的持续时间</span><br><span class="line">                    IF Version == <span class="number">1</span></span><br><span class="line">                    UI64</span><br><span class="line">MediaTime           IF Version == <span class="number">0</span></span><br><span class="line">                    SI32              此编辑段媒体中的开始时间作为合成时间，</span><br><span class="line">                    IF Version == <span class="number">1</span>   以MDHD中定义的时间刻度单位表示？盒子。值-<span class="number">1</span>指定空编辑。</span><br><span class="line">                    SI64</span><br><span class="line">MediaRateInteger	  SI16              播放此编辑段媒体的相对速率。默认值为<span class="number">1</span>。值为<span class="number">0</span>表示停留编辑。</span><br><span class="line">MediaRateFraction	  SI16	            Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.6.6 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-6">2.6. Media box</h4>

<p>Box type: ‘mdia’ </p>
<p>Container: Track box (‘trak’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>tkhd box</p>
<p>媒体（MDIA）框包含定义媒体曲目属性的框</p>
<p>mdia box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	            Type	          Comment</span><br><span class="line">Header            BOXHEADER	      BoxType = <span class="string">&#x27;mdia&#x27;</span> (<span class="number">0x6D646961</span>)</span><br><span class="line">Edit list box	    BOX[]	          定义媒体跟踪属性的任意数量的框</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.4 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-6-1">2.6.1. Media Header box</h5>

<p>Box type: ‘mdhd’ </p>
<p>Container: Media box (‘mdia’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>媒体标题（MDHD）框描述媒体曲目的属性。MDHD箱应首先放在其容器中。</p>
<p>mdhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	            Type	          Comment</span><br><span class="line">Header	          BOXHEADER	      BoxType = <span class="string">&#x27;mdhd&#x27;</span> (<span class="number">0x6D646864</span>)</span><br><span class="line">Version     	    UI8	            Either <span class="number">0</span> or <span class="number">1</span></span><br><span class="line">Flags	            UI24          	Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">CreationTime      IF Version == <span class="number">0</span></span><br><span class="line">                  UI32              The creation time <span class="keyword">of</span> the box</span><br><span class="line">                  IF Version == <span class="number">1</span></span><br><span class="line">                  UI64</span><br><span class="line">ModificationTime	IF Version == <span class="number">0</span></span><br><span class="line">                  UI32              The last modification time <span class="keyword">of</span> the box</span><br><span class="line">                  IF Version == <span class="number">1</span></span><br><span class="line">                  UI64</span><br><span class="line">TimeScale         UI32            此轨道的时间坐标系，以每秒的时间单位数表示</span><br><span class="line">Duration          IF Version == <span class="number">0</span></span><br><span class="line">                  UI32             The total duration <span class="keyword">of</span> <span class="built_in">this</span> track</span><br><span class="line">                  IF Version == <span class="number">1</span></span><br><span class="line">                  UI64</span><br><span class="line">Pad	              UI1	            Padding, set to <span class="number">0</span></span><br><span class="line">Language          UI5 [<span class="number">3</span>]         <span class="number">3</span>字符代码指定语言（见ISO <span class="number">639</span>-<span class="number">2</span>/T），</span><br><span class="line">                                  每个字符解释为<span class="number">0x60</span>+（<span class="number">5</span>位）代码，以生成一个ASCII字符</span><br><span class="line">Reserved	        UI16	          Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.4.2 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-6-2">2.6.2. Handler Reference box</h5>

<p>Box type: ‘hdlr’ </p>
<p>Container: Media box (‘mdia’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>处理程序引用（HDLR）框声明跟踪中媒体数据的性质。hdlr框应位于媒体信息（minf）框之前。</p>
<p>hdlr box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	          Type	          Comment</span><br><span class="line">Header          BOXHEADER	      BoxType = <span class="string">&#x27;hdlr&#x27;</span> (<span class="number">0x68646C72</span>)</span><br><span class="line">Version         UI8             Expected to be <span class="number">0</span></span><br><span class="line">Flags           UI24            Reserved. <span class="built_in">Set</span> to <span class="number">0.</span></span><br><span class="line">Predefined      UI32            <span class="built_in">Set</span> to <span class="number">0.</span></span><br><span class="line">HandlerType     UI32            包含以下<span class="number">4</span>cc值的整数：“vide”=视频轨</span><br><span class="line">                                <span class="string">&#x27;soun&#x27;</span>=音频轨<span class="string">&#x27;data&#x27;</span>=数据轨<span class="string">&#x27;hint&#x27;</span>=提示轨</span><br><span class="line">                                其他轨道类型将被忽略。</span><br><span class="line">Reserved        UI32 [<span class="number">3</span>]        <span class="built_in">Set</span> to <span class="number">0.</span></span><br><span class="line">Name            <span class="built_in">String</span>          以空结尾的命名跟踪类型的utf-<span class="number">8</span>字符串，用于调试。</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.4.3 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-7">2.7. Media Information box</h4>

<p>Box type: ‘minf’ </p>
<p>Container: Media box (‘mdia’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>媒体信息（minf）框包含定义曲目媒体信息的框。</p>
<p>minf框包含一个媒体头框，其类型与曲目的handlerType相对应。</p>
<p>minf box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;minf&#x27;</span> (<span class="number">0x6D696E66</span>)</span><br><span class="line">Boxes         BOX [ ]         定义track媒体信息的任意框数</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.4.3 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-7-1">2.7.1. Video Media Header box</h5>

<p>Box type: ‘vmhd’ </p>
<p>Container: Media Information box (‘minf’)  </p>
<p>Mandatory: Yes for a video track, otherwise no.  </p>
<p>Quantity: One for a video track, otherwise zero.</p>
<p>视频媒体标题（vmhd）框包含视频媒体的一般信息，与所使用的编码无关。vmhd箱应首先放在其容器中。</p>
<p>vmhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;vmhd&#x27;</span> (<span class="number">0x766D6864</span>)</span><br><span class="line">Version       UI8             Expected to be <span class="number">0</span></span><br><span class="line">Flags         UI24            <span class="built_in">Set</span> to <span class="number">1.</span></span><br><span class="line">GraphicsMode  UI16            视频轨的合成模式。默认值为<span class="number">0</span>，这意味着复制现有图像。</span><br><span class="line">OpColor       UI16 [<span class="number">3</span>]        图形模式使用的一组<span class="number">3</span>个RGB颜色值。默认值：（<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>）</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.4.5.2 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-7-2">2.7.2. Sound Media Header box</h5>

<p>Box type: ‘smhd’ </p>
<p>Container:Media Information box (‘minf’) </p>
<p>Mandatory: Yes for an audio track, otherwise no.  </p>
<p>Quantity: One for an audio track, otherwise zero.</p>
<p>声音媒体标题框包含音频媒体的一般信息，与所使用的编码无关。SMHD盒应首先放在其容器中。</p>
<p>smhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;smhd&#x27;</span> (<span class="number">0x736D6864</span>)</span><br><span class="line">Version       UI8             Expected to be <span class="number">0.</span></span><br><span class="line">Flags         UI24            <span class="built_in">Set</span> to <span class="number">0.</span></span><br><span class="line">Balance       SI8<span class="number">.8</span>           固定点<span class="number">8.8</span>号。将单声道音频曲目映射到立体声空间，如下所示：</span><br><span class="line">                              -<span class="number">1.0</span>=完全向左</span><br><span class="line">                              <span class="number">0</span> =中心</span><br><span class="line">                              <span class="number">1.0</span>=完全正确</span><br><span class="line">Reserved      UI16            <span class="built_in">Set</span> to <span class="number">0.</span></span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.4.5.3 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-7-3">2.7.3. Hint Media Header box</h5>

<p>Box type: ‘hmhd’ </p>
<p>Container: Media Information box (‘minf’) </p>
<p>Mandatory: Yes for a hint track, otherwise no. </p>
<p>Quantity: One for a hint track, otherwise zero.</p>
<p>提示媒体头（hmhd）框包含提示跟踪的一般信息，与所使用的协议无关。HMHD箱应首先放在其容器中。</p>
<p>hmhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;hmhd&#x27;</span> (<span class="number">0x686D6864</span>)</span><br><span class="line">Version       UI8             Expected to be <span class="number">0.</span></span><br><span class="line">Flags         UI24            <span class="built_in">Set</span> to <span class="number">0.</span></span><br><span class="line">MaxPDUSize    UI16            Size (<span class="keyword">in</span> bytes) <span class="keyword">of</span> the largest PDU <span class="keyword">in</span> hint stream.</span><br><span class="line">AvgPDUSize    UI16            Average size (<span class="keyword">in</span> bytes) <span class="keyword">of</span> a PDU <span class="keyword">in</span> entire presentation</span><br><span class="line">MaxBitRate    UI32            Maximum rate (<span class="keyword">in</span> bits per second) over an interval <span class="keyword">of</span> <span class="number">1</span> second.</span><br><span class="line">AvgBitRate    UI32            Average rate (<span class="keyword">in</span> bits per second) over entire presentation.</span><br><span class="line">Reserved      UI32            <span class="built_in">Set</span> to <span class="number">0.</span></span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.4.5.4 of ISO/IEC 14496-12.</p>
<h5 id="a2-7-4">2.7.4. Null Media Header box</h5>

<p>Box type: ‘nmhd’ </p>
<p>Container:Media Information box (‘minf’) </p>
<p>Mandatory: Yes for metadata track, otherwise no. </p>
<p>Quantity: Zero for video, audio, and hint tracks, otherwise, one.</p>
<p>空媒体标题（NMHD）框包含视频和音频以外的曲目的常规信息。NMHD箱应首先放置在其容器中。</p>
<p>nmhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;nmhd&#x27;</span> (<span class="number">0x6E6D6864</span>)</span><br><span class="line">Version       UI8             Expected to be <span class="number">0.</span></span><br><span class="line">Flags         UI24            Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.4.5.5 of ISO/IEC 14496-12.</p>
<h5 id="a2-7-5">2.7.5. Data Information box</h5>

<p>Box type: ‘dinf’ </p>
<p>Container: Media Information box (‘minf’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>数据信息（DINF）框包含一个数据引用（DREF）框，用于声明媒体数据在某个磁道中的位置。DINF框应位于示例表（STBL）框之前。</p>
<p>dinf box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;dinf&#x27;</span> (<span class="number">0x64696E66</span>)</span><br><span class="line">Data          Reference box   BOX	Table <span class="keyword">of</span> data references, used to locate media data.</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.7.1 of ISO/IEC 14496-12.</p>
<h5 id="a2-7-6">2.7.6. Sample Table box</h5>

<p>Box type: ‘stbl’ </p>
<p>Container:Media Information box (‘minf’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>“示例表”（STBL）框包含一些框，用于定义组成轨迹的示例的属性。</p>
<p>STBL框中的框应按以下顺序排列：样本描述（STSD）、解码时间到样本（STTS）、样本到块（STSC）、样本大小（STSZ）、块偏移（STCO或CO64）。</p>
<p>样本描述（STSD）框及其包含的框在第2.8节样本描述框结构中进行了规定。</p>
<p>stbl box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;stbl&#x27;</span> (<span class="number">0x7374626C</span>)</span><br><span class="line">Boxes         BOX [ ]        定义轨道组成样本属性的任意数量的框。</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.5 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-7-6-1">2.7.6.1. Decoding Time to Sample box</h5>

<p>Box type: ‘stts’ </p>
<p>Container:Sample Table box (‘stbl’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>解码采样时间（STTS）框定义采样表的采样映射时间</p>
<p>stts box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;stts&#x27;</span> (<span class="number">0x73747473</span>)</span><br><span class="line">Version       UI8             Expected to be <span class="number">0</span></span><br><span class="line">Flags         UI24            Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">Count         UI32            The number <span class="keyword">of</span> STTSRECORD entries</span><br><span class="line">Entries       STTSRECORD </span><br><span class="line">              [Count]         An array <span class="keyword">of</span> STTSRECORD structures</span><br><span class="line"></span><br><span class="line">Each STTSRECORD has the following format: </span><br><span class="line">STTSRECORD</span><br><span class="line">SampleCount   UI32            此sttsrecord应用于的连续样本数</span><br><span class="line">SampleDelta   UI32            Sample duration <span class="keyword">in</span> TimeScale units defined <span class="keyword">in</span> the mdhd box</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.6.1.2 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-7-6-2">2.7.6.2. Composition Time to Sample box</h5>

<p>Box type: ‘ctts’ </p>
<p>Container:Sample Table box (‘stbl’) </p>
<p>Mandatory: No </p>
<p>Quantity: One</p>
<p>合成时间到样本（CTTS）框定义了样本表的合成时间到样本映射</p>
<p>ctts box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;ctts&#x27;</span> (<span class="number">0x63747473</span>)</span><br><span class="line">Version       UI8             Expected to be <span class="number">0</span></span><br><span class="line">Flags         UI24            Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">Count         UI32            The number <span class="keyword">of</span> CTTSRECORD entries</span><br><span class="line">Entries       CTTSRECORD </span><br><span class="line">              [Count]         An array <span class="keyword">of</span> CTTSRECORD structures</span><br><span class="line"></span><br><span class="line">Each STTSRECORD has the following format: </span><br><span class="line">STTSRECORD</span><br><span class="line">SampleCount     UI32          The number <span class="keyword">of</span> consecutive samples that <span class="built_in">this</span> CTTSRECORD applies to</span><br><span class="line">SampleOffset    UI32          对于sampleCount字段指定的每个样本，此</span><br><span class="line">                              字段包含一个正整数，它以MDHD框中定义的时间刻度单位指定解码时间的合成偏移量。</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.6.1.3 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-7-6-3">2.7.6.3. Sample to Chunk box</h5>

<p>Box type: ‘stsc’ </p>
<p>Container: Sample Table box (‘stbl’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>“采样到块（STSC）”框定义媒体轨采样表中的采样到块映射。</p>
<p>stsc box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;stsc&#x27;</span> (<span class="number">0x73747363</span>)</span><br><span class="line">Version       UI8             Expected to be <span class="number">0</span></span><br><span class="line">Flags         UI24            Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">Count         UI32            The number <span class="keyword">of</span> STSCRECORD entries</span><br><span class="line">Entries       STSCRECORD </span><br><span class="line">              [Count]         An array <span class="keyword">of</span> STSCRECORD structures</span><br><span class="line"></span><br><span class="line">Each STTSRECORD has the following format: </span><br><span class="line">STTSRECORD</span><br><span class="line">FirstChunk          UI32          The first chunk that <span class="built_in">this</span> record applies to</span><br><span class="line">SamplesPerChunk     UI32          The number <span class="keyword">of</span> consecutive samples that <span class="built_in">this</span> record applies to</span><br><span class="line">SampleDescIndex     UI32          The sample description that describes <span class="built_in">this</span> sequence <span class="keyword">of</span> chunks</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.7.4  of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-7-6-4">2.7.6.4. Sample Size box</h5>

<p>Box type: ‘stsz’ </p>
<p>Container:Sample Table box (‘stbl’) </p>
<p>Mandatory: No </p>
<p>Quantity: One</p>
<p>“样本大小”（STSZ）框指定样本表中每个样本的大小。</p>
<p>tkhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;stsz&#x27;</span> (<span class="number">0x7374737A</span>)</span><br><span class="line">Version       UI8             Expected to be <span class="number">0</span></span><br><span class="line">Flags         UI24            Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">ConstantSize  UI32            如果所有样本的大小相同，则此字段将使用该常量大小设置，否则为<span class="number">0</span>。</span><br><span class="line">SizeCount     UI32	          The number <span class="keyword">of</span> samples <span class="keyword">in</span> the track</span><br><span class="line">SizeTable     IF ConstantSize == <span class="number">0</span></span><br><span class="line">              UI32 [SizeCount]    样本量表。如果constantsize不是<span class="number">0</span>，则此表为空</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.7.3.2 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-7-6-5">2.7.6.5. Chunk Offset box</h5>

<p>Box type: ‘stco’ or ‘co64’</p>
<p>Container:Sample Table box (‘stbl’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>每个样本表框应包含一个STCO或CO64类型的区块偏移框。STCO和CO64框为示例表中的每个块定义块偏移量。</p>
<p>stco and co64 boxes</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;stco&#x27;</span> (<span class="number">0x7374636F</span>) or <span class="string">&#x27;co64&#x27;</span> (<span class="number">0x636F3634</span>)</span><br><span class="line">Version       UI8             Expected to be <span class="number">0</span></span><br><span class="line">Flags         UI24            Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">OffsetCount   UI32            The number <span class="keyword">of</span> offsets <span class="keyword">in</span> the Offsets table</span><br><span class="line">Offsets       IF BoxType == <span class="string">&#x27;stco’</span></span><br><span class="line"><span class="string">              UI32 [OffsetCount]    文件中的绝对块偏移量表</span></span><br><span class="line"><span class="string">              ELSE IF BoxType == &#x27;</span>co64’</span><br><span class="line">              UI64 [OffsetCount]</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.7.5 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-7-6-6">2.7.6.6. Sync Sample box</h5>

<p>Box type: ‘stss’ </p>
<p>Container:Sample Table box (‘stbl’) </p>
<p>Mandatory: No </p>
<p>Quantity: One</p>
<p>同步样本（STSS）框指定样本表中的哪些样本是同步样本。同步样本是可以安全查找的样本。如果轨迹是视频轨迹，则同步采样是不依赖任何其他帧的任何数据的关键帧或帧内帧。</p>
<p>如果样本表（STBL）框不包含STSS框，则轨道中的所有样本均应视为同步样本。</p>
<p>stss box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;stss&#x27;</span> (<span class="number">0x73747373</span>)</span><br><span class="line">Version       UI8             Expected to be <span class="number">0</span></span><br><span class="line">Flags         UI24            Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">SyncCount     UI32            The number <span class="keyword">of</span> entries <span class="keyword">in</span> SyncTable</span><br><span class="line">SyncTable     UI32            同时也是同步样本的样本数表，按样本数的升序</span><br><span class="line">              [SyncCount]</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.6.2 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-7-6-7">2.7.6.7. Independent and Disposable Samples box</h5>

<p>Box type: ‘sdtp’ </p>
<p>Container: Sample Table box (‘stbl’) or Track Fragment ‘traf </p>
<p>Mandatory: No </p>
<p>Quantity: One in each of the stbl and traf boxes</p>
<p>一个STBL或TRAF盒可分别包含一个独立的一次性样品盒（SDTP）。SDTP盒有助于实现诸如快进和随机访问等功能。sdtp框说明样本是否为i-picture，并提供有关样本中存在的帧依赖性和冗余编码的信息。表中的条目数与“样本大小”框中的sampleCount值相同。</p>
<p>stss box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	              Type	                  Comment</span><br><span class="line">Header              BOXHEADER               BoxType = <span class="string">&#x27;sdtp&#x27;</span> (<span class="number">0x73647470</span>)</span><br><span class="line">Version             UI8                     Expected to be <span class="number">0</span></span><br><span class="line">Flags               UI24                    Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">SampleDependency    SAMPLEDEPENDENCY []     每个示例的依赖关系信息，到框的末尾</span><br><span class="line"></span><br><span class="line">Each SAMPLEDEPENDENCY record has the following structure: </span><br><span class="line">SAMPLEDEPENDENCY</span><br><span class="line">Reserved            UI2                     Reserved. <span class="built_in">Set</span> to <span class="number">0.</span></span><br><span class="line">SampleDependsOn     UI2</span><br><span class="line">                                            <span class="number">0</span> = the sample dependency is unknown</span><br><span class="line">                                            <span class="number">1</span> = <span class="built_in">this</span> sample does depend on others (not an I picture)</span><br><span class="line">                                            <span class="number">2</span> = <span class="built_in">this</span> sample does not depend on others (I picture)</span><br><span class="line">                                            <span class="number">3</span> = reserved</span><br><span class="line">SampleIsDependedOn	UI2</span><br><span class="line">                                            <span class="number">0</span> = the dependency <span class="keyword">of</span> other samples on <span class="built_in">this</span> sample is unknown</span><br><span class="line">                                            <span class="number">1</span> = other samples may depend on <span class="built_in">this</span> one (not disposable)</span><br><span class="line">                                            <span class="number">2</span> = no other sample depends on <span class="built_in">this</span> one (disposable)</span><br><span class="line">                                            <span class="number">3</span> = reserved</span><br><span class="line">SampleHasRedundancy  UI2</span><br><span class="line">                                            <span class="number">0</span> = it is unknown whether there is redundant coding <span class="keyword">in</span> <span class="built_in">this</span> sample</span><br><span class="line">                                            <span class="number">1</span> = there is redundant coding <span class="keyword">in</span> <span class="built_in">this</span> sample</span><br><span class="line">                                            <span class="number">2</span> = there is no redundant coding <span class="keyword">in</span> <span class="built_in">this</span> sample</span><br><span class="line">                                            <span class="number">3</span> = reserved</span><br></pre></td></tr></table></figure>


<p>当存在冗余编码时，“sampleDependson”的值仅对应于主编码。参数“sampleisdependedon”独立于冗余编码的存在。</p>
<p>For more information, see section 8.6.4 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-8">2.8. Sample Description Box Structure</h4>
<h5 id="a2-8-1">2.8.1. Sample Description box</h5>

<p>Box type: ‘stsd’ </p>
<p>Container:Sample Table box (‘stbl’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>“示例说明”（STSD）框定义示例表的示例说明。STSD框可以包含一个曲目的多个描述，每个媒体类型包含一个描述。示例描述表提供了有关所用编码类型的详细信息，以及该编码所需的任何初始化信息。</p>
<p>表2显示了示例描述框中的层次结构。有关更多信息，请参见ISO/IEC 14496-12第8.5.2节。</p>
<p>stsd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	               Type	                   Comment</span><br><span class="line">Header              BOXHEADER               BoxType = <span class="string">&#x27;stsd&#x27;</span> (<span class="number">0x73747364</span>)</span><br><span class="line">Version             UI8                     Expected to be <span class="number">0</span></span><br><span class="line">Flags               UI24                    Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">Count               UI32</span><br><span class="line"><span class="built_in">Number</span> <span class="keyword">of</span> entries, one <span class="keyword">for</span> each media type contained <span class="keyword">in</span> the track</span><br><span class="line">Descriptions        DESCRIPTIONRECORD</span><br><span class="line">                    [Count]                 一组框，每个框对应包含在曲目中的媒体类型。</span><br></pre></td></tr></table></figure>


<p>Each DESCRIPTIONRECORD shall be one of the following boxes:</p>
<ul>
<li><p>   VisualSampleEntry, for HandlerType == ‘vide’ [video track],</p>
</li>
<li><p>   AudioSampleEntry, for HandlerType == ‘soun’ [audio track],</p>
</li>
<li><p>   MetaDataSampleEntry, for HandlerType == ‘meta’ [timed metadata track],</p>
</li>
<li><p>   SampleEntry, for HandlerType == ‘data’ [data track],</p>
</li>
<li><p>   HintSampleEntry, for HandlerType == ‘hint’ [hint track], or</p>
</li>
<li><p>   AdobeMuxHintSampleEntry, for HandlerType == ‘hint’ [Adobe Multiplexed Hint Track]</p>
<h5 id="a2-8-2">2.8.2. VisualSampleEntry box</h5>

</li>
</ul>
<p>Box type: one of the video media types specified in Section 1.8.2 Supported video types </p>
<p>Container:Sample Table box (‘stsd’) </p>
<p>Mandatory: Yes for video tracks </p>
<p>Quantity: One for each video track</p>
<p>VisualSampleEntry框包含有关所用视频编码类型的详细信息，以及该编码所需的任何初始化信息。有关更多信息，请参见ISO/IEC 14496-12:2008第8.5.2节。</p>
<p>VisualSampleEntry box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                 Type	          Comment</span><br><span class="line">Header                 BOXHEADER      BoxType is one <span class="keyword">of</span> the video media types specified <span class="keyword">in</span> <span class="number">1.8</span><span class="number">.2</span></span><br><span class="line">Reserved               UI8 [<span class="number">6</span>]        <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">DataReferenceIndex     UI16	          用于检索与使用此示例说明的示例关联的数据引用的索引。数据引用存储在数据引用（DREF）框中。</span><br><span class="line">Predefined             UI16           <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">Reserved               UI16            <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">Predefined             UI32 [<span class="number">3</span>]       <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">Width                 UI16            Max visual width (<span class="keyword">in</span> pixels) <span class="keyword">from</span> codec</span><br><span class="line">Height                UI16            Max visual height (<span class="keyword">in</span> pixels) <span class="keyword">from</span> codec</span><br><span class="line">HorizResolution       UI16<span class="number">.16</span>         图像像素/英寸的分辨率，默认值为<span class="number">0x0048000</span>（<span class="number">72</span> dpi）</span><br><span class="line">VertResolution        UI16<span class="number">.16</span>         图像像素/英寸的分辨率，默认值为<span class="number">0x0048000</span>（<span class="number">72</span> dpi）</span><br><span class="line">Reserved              UI32            <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">FrameCount            UI16            每个样本中存储多少帧，默认值<span class="number">1</span>（每个样本一帧）</span><br><span class="line">CompressorName        UI8 [<span class="number">32</span>]        压缩机名称（仅供参考）。第一个字节设置为第一个字节后可显示数据的字节数。</span><br><span class="line">Depth                 UI16            比特深度。默认值<span class="number">0x0018</span>（不带字母的颜色）</span><br><span class="line">Predefined            SI16            <span class="built_in">Set</span> to -<span class="number">1</span></span><br><span class="line">Boxes                 BOX [ ]         为媒体类型或加密指定的附加框</span><br></pre></td></tr></table></figure>

<h5 id="a2-8-3">2.8.3. AudioSampleEntry box</h5>

<p>Box type: one of the audio media types specified in Section 1.8.1 Supported audio types </p>
<p>Container:Sample Table box (‘stsd’)  </p>
<p>Mandatory: Yes for audio tracks </p>
<p>Quantity: One</p>
<p>audioSampleEntry框包含有关所用音频编码类型的详细信息，以及该编码所需的任何初始化信息。有关更多信息，请参见ISO/IEC 14496-12:2008第8.5.2节。</p>
<p>AudioSampleEntry box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                Type	          Comment</span><br><span class="line">Header                BOXHEADER       BoxType is one <span class="keyword">of</span> the audio media types specified <span class="keyword">in</span> <span class="number">1.8</span><span class="number">.1</span></span><br><span class="line">Reserved              UI8 [<span class="number">6</span>]         <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">DataReferenceIndex    UI16            用于检索与使用此示例说明的示例关联的数据引用的索引。数据引用存储在数据引用（DREF）框中。</span><br><span class="line">Reserved              UI32 [<span class="number">2</span>]        <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">ChannelCount          UI16            频道数。默认值为<span class="number">2</span>。</span><br><span class="line">                                      <span class="number">1</span> = Mono</span><br><span class="line">                                      <span class="number">2</span> = Stereo</span><br><span class="line">SampleSize            UI16            Size <span class="keyword">of</span> sample. Default value is <span class="number">16</span></span><br><span class="line">Predefined            UI16            <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">Reserved              UI16            <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">SampleRate            UI16<span class="number">.16</span>         Sampling rate, fixed point <span class="number">16.16</span> number</span><br><span class="line">Boxes                 BOX [ ]         Additional boxes <span class="keyword">as</span> specified <span class="keyword">for</span> the media type, or encryption</span><br></pre></td></tr></table></figure>

<h5 id="a2-8-4">2.8.4. MetaDataSampleEntry box</h5>

<p>Box type: depends on protocol used </p>
<p>Container:Sample Table box (‘stsd’)  </p>
<p>Mandatory: Yes for metadata tracks </p>
<p>Quantity: One for each metadata track</p>
<p>MetadataSampleEntry框包含有关所用元数据编码类型的详细信息，以及该编码所需的任何初始化信息。有关更多信息，请参见ISO/IEC 14496-12:2008第8.5.2节。</p>
<p>MetaDataSampleEntry box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                  Type	          Comment</span><br><span class="line">Header                  BOXHEADER       BoxType depends on protocol used</span><br><span class="line">Reserved                UI8 [<span class="number">6</span>          <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">DataReferenceIndex      UI16            用于检索与使用此示例说明的示例关联的数据引用的索引。数据引用存储在数据引用（DREF）框中。</span><br><span class="line">Data                    UI8 [ ]         Additional contents <span class="keyword">as</span> specified <span class="keyword">in</span> ISO/IEC <span class="number">14496</span>-<span class="number">12</span>:<span class="number">2008</span></span><br></pre></td></tr></table></figure>

<h5 id="a2-8-5">2.8.5. SampleEntry box</h5>

<p>Box type: one of the data media types specified in Section1.8.3 Supported data types </p>
<p>Container:Sample Table box (‘stsd’) </p>
<p>Mandatory: Yes for data tracks </p>
<p>Quantity: One for each data track</p>
<p>sampleEntry框包含有关所用编码类型的详细信息，以及该编码所需的任何初始化信息。有关更多信息，请参见ISO/IEC 14496-12:2008第8.5.2节。</p>
<p>SampleEntry box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                Type	          Comment</span><br><span class="line">Header                BOXHEADER       BoxType is one <span class="keyword">of</span> the data media types specified <span class="keyword">in</span> Supported data types.</span><br><span class="line">Reserved              UI8 [<span class="number">6</span>]         <span class="built_in">Set</span> to <span class="number">0.</span></span><br><span class="line">DataReferenceIndex	  UI16            用于检索与使用此示例说明的示例关联的数据引用的索引。数据引用存储在数据引用（DREF）框中。</span><br><span class="line">Boxes	                BOX [ ]         Additional boxes <span class="keyword">as</span> specified <span class="keyword">for</span> the media type, or encryption</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.aaaaaaaaaaaaaaaaaaaaaaaaaaa of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-8-6">2.8.6. HintSampleEntry box</h5>

<p>Box type: ‘hint’ </p>
<p>Container:Sample Table box (‘stsd’ </p>
<p>Mandatory: Yes for hint tracks </p>
<p>Quantity: One for each hint track</p>
<p>hintsampleEntry（提示）框包含正在使用的流协议的适当声明性数据以及提示轨的格式。有关更多信息，请参见ISO/IEC 14496-12:2008第8.5.2节。</p>
<p>HintSampleEntry box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	               Type	            Comment</span><br><span class="line">Header               BOXHEADER         一般来说，boxType取决于使用的协议。在F4V文件中，只允许使用“提示”框类型。</span><br><span class="line">                                       保留的ui8[<span class="number">6</span>]设置为<span class="number">0</span></span><br><span class="line">DataReferenceIndex	  UI16            用于检索与使用此示例说明的示例关联的数据引用的索引。数据引用存储在数据引用（DREF）框中。</span><br><span class="line">Data                  UI8 [ ]         Arbitrary number <span class="keyword">of</span> bytes until end <span class="keyword">of</span> box</span><br></pre></td></tr></table></figure>

<h5 id="a2-8-7">2.8.7. Sample Descriptions for HTTP Streaming with Fragments</h5>
<h5 id="a2-8-7-1">2.8.7.1.  Adobe Mux Hint Sample Entry box</h5>

<p>Box type: ‘rtmp’ </p>
<p>Container:Sample Table box (‘stsd’) </p>
<p>Mandatory: Yes for HTTP streaming support with F4V fragments </p>
<p>Quantity: One for the hint track for HTTP streaming support with F4V fragments</p>
<p>Adobemux提示示例条目（rtmp）框描述了使用f4v片段的HTTP流中使用的提示轨。见附录C.HTTP流：文件结构。提示轨包含ADobemuxhintsamples。</p>
<p>rtmp box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                  Type	                Comment</span><br><span class="line">Header                  BOXHEADER             BoxType = <span class="string">&#x27;rtmp&#x27;</span> (<span class="number">0x72746D70</span>)</span><br><span class="line">Reserved                UI8 [<span class="number">6</span>]               <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">DataReferenceIndex      UI16                  用于检索与使用此示例说明的示例关联的数据引用的索引。数据引用存储在数据引用（DREF）框中。</span><br><span class="line">HintTrackVersion        UI16                  正在使用的提示跟踪定义的版本。设置为<span class="number">1</span>。</span><br><span class="line">HighestCompatibleVersion	UI16                指定与旧版本的兼容性。</span><br><span class="line">MaxPacketSize           UI16                  最大的Adobe多路复用提示跟踪示例包大小（字节）。</span><br><span class="line">AdditionalData          BOX [ ]               一个Adobe MUX提示处理框和零个或一个Adobe MUX时间偏移框</span><br></pre></td></tr></table></figure>

<h5 id="a2-8-7-2">2.8.7.2. Adobe Mux Hint Process box</h5>

<p>Box type: ‘amhp’ </p>
<p>Container:Adobe Mux Hint Sample Entry (‘rtmp’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>Adobe mux提示进程（amhp）框包含此曲目中使用的提示模式的描述</p>
<p>amhp box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;amhp&#x27;</span> (<span class="number">0x616D6870</span>))</span><br><span class="line">Version       UI8             Expected to be <span class="number">0</span></span><br><span class="line">Flags         UI24            Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">ModeCount     UI8             此框中支持的模式配置数。此值也是相应提示轨中支持的模式数。</span><br><span class="line">ENTRIES       MuxHintProcessEntry</span><br><span class="line">              [ModeCount]         An array <span class="keyword">of</span> MuxHintProcessEntry</span><br><span class="line"></span><br><span class="line">Each MuxHintProcessEntry has the following format:</span><br><span class="line">MuxHintProcessEntry</span><br><span class="line">HintTrackMode           UI8         条目对应的模式（示例或立即模式）。有关模式的更多信息，请参阅附录C<span class="number">.5</span> Adobe多路提示跟踪格式。</span><br><span class="line">TrailerLengthField      UI1         <span class="number">1</span>表示此模式的adobemuxhintsample中存在trailerLength字段。如果为<span class="number">0</span>，则使用trailerDefaultSize。</span><br><span class="line">LengthField             UI1         <span class="number">1</span>表示此模式的ADobemuxhintsample中存在提示样本长度字段。模式==<span class="number">2</span>时，长度字段应为<span class="number">1</span>。</span><br><span class="line">ModeField               UI1         <span class="number">1</span>表示此模式的ADobemuxhintsample中存在模式字段。当使用多种模式时，ModeField应为<span class="number">1</span>。</span><br><span class="line">ConstructorCountField   UI1         <span class="number">1</span>表示此模式的adobEmuxHintSample中存在<span class="title">constructorCount</span>字段。如果为0，则有一个构造函数</span><br><span class="line"><span class="title">PacketCountField</span>        <span class="title">UI1</span>         1表示此模式的<span class="title">ADobemuxhintsample</span>中存在<span class="title">packetcount</span>字段。</span><br><span class="line"><span class="title">Reserved</span>                <span class="title">UI3</span>         <span class="title">Set</span> <span class="title">to</span> 0</span><br><span class="line"><span class="title">TrailerDefaultSize</span>      <span class="title">UI8</span>         提示示例有效负载之后拖车数据的默认大小（以字节为单位）。在没有<span class="title">TrailerLengthField</span>时使用。</span><br></pre></td></tr></table></figure>


<p>对于FLV兼容模式，trailerLengthField、lengthField、modeField、constructorCountField和packetCountField应为0。在这种情况下，使用即时节点提升提示模式。</p>
<h5 id="a2-8-7-3">2.8.7.3. Adobe Mux Time Offset box</h5>

<p>Box type: ‘amto’ </p>
<p>Container:Adobe Mux Hint Sample Entry (‘rtmp’) </p>
<p>Mandatory: No </p>
<p>Quantity: One</p>
<p>Adobe mux time offset（amto）框存储此文件中第一个提示示例的时间戳</p>
<p>amto box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header        BOXHEADER       BoxType = <span class="string">&#x27;amto&#x27;</span> (<span class="number">0x616D746F</span>)</span><br><span class="line">TimeOffset    UI32            文件中第一个提示示例的时间戳。</span><br><span class="line">                              这个时间戳是从累计的样本持续时间中导出的每个样本的表示时间中添加的偏移量。</span><br></pre></td></tr></table></figure>

<h5 id="a2-8-8">2.8.8. Sample Descriptions for Protected Contents</h5>
<h5 id="a2-8-8-1">2.8.8.1. Encrypted Video box</h5>

<p>Box type: ‘encv’ </p>
<p>Container:Sample Table box (‘stsd’) </p>
<p>Mandatory: Yes for encrypted video tracks </p>
<p>Quantity: One for each encrypted video track</p>
<p>如附件D.2所述，加密视频（Encv）盒应为原始视觉样本，并附上“sinf”盒。有关更多信息，请参见ISO/IEC 14496-12:2008第8.12节。</p>
<h5 id="a2-8-8-2">2.8.8.2. Encrypted Audio box</h5>

<p>Box type: ‘enca’ </p>
<p>Container: Sample Table box (‘stsd’)  </p>
<p>Mandatory:  Yes for encrypted audio tracks </p>
<p>Quantity: One for each encrypted audio track</p>
<p>如附录D.2所述，加密音频（ENCA）盒应为原始音频采样中心，并附上“sinf”盒。有关更多信息，请参见ISO/IEC 14496-12:2008第8.12节。</p>
<h5 id="a2-8-8-3">2.8.8.3. Encrypted Data box</h5>

<p>Box type: ‘encr’<br>&lt;<br>Container:Sample Table box (‘stsd’) </p>
<p>Mandatory: Yes for encrypted video tracks </p>
<p>Quantity: One for each encrypted video track</p>
<p>如附录D.2所述，加密数据（encr）箱应为原始样品中心，并附上“sinf”箱。有关更多信息，请参见ISO/IEC 14496-12:2008第8.12节。</p>
<h5 id="a2-8-8-4">2.8.8.4. Protection Scheme Information box</h5>

<p>Box type: ‘sinf’ </p>
<p>Container:’encv’ or ‘enca’ Sample Description Entry for the protected track in ‘stsd’ box </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>保护方案信息（sinf）框是一个容器框，其中包含了解所应用的加密转换及其参数以及查找密钥管理系统类型和位置等其他信息所需的所有信息。它还记录了媒体的原始（未加密）格式。它应附加到具有四个字符代码（“encv”、“enca”或“encr”）的任何示例条目中，以指示受保护的流。</p>
<p>sinf box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                  Type	                 Comment</span><br><span class="line">Header                  BOXHEADER             BoxType = <span class="string">&#x27;sinf&#x27;</span></span><br><span class="line">OriginalFormatBox       OriginalFormatBox     The format <span class="keyword">of</span> the original sample</span><br><span class="line">SchemeTypeBox           SchemeTypeBox         The DRM type. Required. (This is optional <span class="keyword">in</span> ISO <span class="number">14496</span>-<span class="number">12</span>)</span><br><span class="line">SchemeInformationBox    SchemeInformationBox  DRM details. Required. (This is optional <span class="keyword">in</span> ISO <span class="number">14496</span>-<span class="number">12</span>)</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.12 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-8-8-5">2.8.8.5. Original Format box</h5>

<p>Box type: ‘frma’ </p>
<p>Container:Protection Scheme Information box (‘sinf’)  </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>“原始格式”（FRMA）框指定原始样本的格式，例如，如果流包含受保护的MPEG-4视觉材料，“MP4V”。</p>
<p>frma box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                        Type	                  Comment</span><br><span class="line">Header                        BOXHEADER               BoxType = <span class="string">&#x27;frma&#x27;</span></span><br><span class="line">UnencryptedDataFormat         UI32                    原始未转换样本条目的四字符代码</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.12.2 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-8-8-6">2.8.8.6.  Scheme Type box</h5>

<p>Box type: ‘schm’ </p>
<p>Container: Protection Scheme Information box (‘sinf’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>方案类型（schm）框指定用于管理密钥和内容解密的DRM系统。由于媒体文件格式可能支持除Adobe的DRM以外的其他密钥管理系统，因此使用中的密钥管理系统应在schemetype字段中以四字符代码（4cc）表示。</p>
<p>schm box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header        BOXHEADER         BoxType = <span class="string">&#x27;schm&#x27;</span></span><br><span class="line">Version       UI8               Shall be <span class="number">1</span></span><br><span class="line">Flags         UI24              Shall be <span class="number">0</span> or <span class="number">1</span></span><br><span class="line">SchemeType    UI32              方案类型。应为“adkm”，表示内容使用Adobe的DRM系统进行保护。</span><br><span class="line">SchemeVersion	UI32              Shall be <span class="number">1</span></span><br><span class="line">SchemeUri     IF Flags == <span class="number">1</span></span><br><span class="line">              STRING</span><br><span class="line">              Browser URI</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.12.5 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-8-8-7">2.8.8.7.  Scheme Information box</h5>

<p>Box type: ‘schi’ </p>
<p>Container:Protection Scheme Information box (‘sinf’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>方案信息（Schi）框是一个包含DRM密钥/权限管理系统特定信息的容器框。对于Adobe的DRM，此框应包括一个Adobe DRM密钥管理系统框。可能还有其他盒子。为了与其他DRM的互操作性，Adobe DRM密钥管理系统框可以位于方案信息框中的任何位置。</p>
<p>schi box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                      Type	          Comment</span><br><span class="line">Header                      BOXHEADER       BoxType = <span class="string">&#x27;schi&#x27;</span></span><br><span class="line">OtherDRMSpecificData        BOX [ ]         （可选）包含其他DRM特定密钥管理信息的框</span><br><span class="line">SchemeSpecificData          AdobeDRMKMSBox    Adobe DRM密钥管理系统框，指定密钥管理信息</span><br><span class="line">OtherDRMSpecificData        BOX [ ]         （可选）包含其他DRM特定密钥管理信息的框</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.12.6 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-8-8-8">2.8.8.8. Boxes for Adobe's Protection Scheme</h5>

<p>以下框由Adobe定义，未在ISO 14496-12:2008中记录。</p>
<h5 id="a2-8-8-8-1">2.8.8.8.1.  Adobe DRM Key Management System box</h5>

<p>Box type: ‘adkm’ </p>
<p>Container:Scheme Information box (‘schi’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>AdobeDRM密钥管理系统（ADKM）框指定加密和示例格式。</p>
<p>tkhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	         Type	             Comment</span><br><span class="line">Header         BOXHEADER         BoxType = <span class="string">&#x27;adkm&#x27;</span></span><br><span class="line"></span><br><span class="line">Version        UI8               Shall be <span class="number">1</span></span><br><span class="line"></span><br><span class="line">Flags          UI24              Shall be <span class="number">0</span></span><br><span class="line"></span><br><span class="line">Header       AdobeDRMHeaderBox   AdobeDRM头框，指定如何检索密钥以及如何使用它来解密内容。</span><br><span class="line">AUFormat	   AdobeDRMAUFormatBox	  Adobe DRM Access Unit格式框，指定每个示例预先准备的格式</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="a2-8-8-8-2">2.8.8.8.2. Adobe DRM Header box</h5>

<p>Box type: ‘ahdr’ </p>
<p>Container:Adobe DRM Key Management System box (‘adkm’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>AdobeDRM头（ahdr）框指定加密格式和方法的版本。</p>
<p>ahdr box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	             Type	                      Comment</span><br><span class="line">Header             BOXHEADER                   BoxType = <span class="string">&#x27;ahdr&#x27;</span></span><br><span class="line">Version            UI8                         Shall be <span class="number">1</span> or <span class="number">2</span>, indicating the version <span class="keyword">of</span> the encryption format.</span><br><span class="line">                                              <span class="number">1</span> = FMRMS v1.x products.</span><br><span class="line">                                              <span class="number">2</span> = Flash Access <span class="number">2.0</span> products.</span><br><span class="line">                                              使用任一版本保护的内容均已存在，因此应用程序应能够同时使用两个版本的内容。</span><br><span class="line">Flags              UI24                        Shall be <span class="number">0</span>      </span><br><span class="line">StdEncryptionBox	StandardEncryptionParamsBox	标准加密参数框，包含用于加密样本的加密方法属于“标准加密”类型。</span><br><span class="line">Signature          IF Version == <span class="number">1</span></span><br><span class="line">                  AdobeSignatureBox           此文档中未描述AdobeSignatureBox</span><br></pre></td></tr></table></figure>

<h5 id="a2-8-8-8-3">2.8.8.8.3. Standard Encryption Params box</h5>

<p>Box type: ‘aprm’ </p>
<p>Container: Adobe DRM Header box (‘ahdr’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>标准加密参数（APRM）框包含加密方法“标准”的参数。</p>
<p>tkhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                          Type	                  Comment</span><br><span class="line">Header                          BOXHEADER               BoxType = <span class="string">&#x27;aprm&#x27;</span></span><br><span class="line">Version                         UI8                     Shall be <span class="number">1</span></span><br><span class="line">Flags                           UI24                    Shall be <span class="number">0</span></span><br><span class="line">EncInfoBox                      EncryptionInfoBox       加密信息框，指定用于加密样本的加密算法</span><br><span class="line">KeyInfoBox                      KeyInfoBox              密钥信息框，指定如何检索用于解密示例的密钥</span><br></pre></td></tr></table></figure>

<h5 id="a2-8-8-8-4">2.8.8.8.4. Encryption Information box</h5>

<p>Box type: ‘aeib’ </p>
<p>Container:标准加密参数框(‘aprm’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>加密信息（AEIB）框指定用于加密样本的加密算法。</p>
<p>aeib box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                        Type	                  Comment</span><br><span class="line">Header                          BOXHEADER               BoxType = <span class="string">&#x27;aeib&#x27;</span></span><br><span class="line">Version                         UI8                     Shall be <span class="number">1</span></span><br><span class="line">Flags                           UI24                    Shall be <span class="number">0</span></span><br><span class="line">EncryptionAlgorithm             STRING                  加密算法。应为“aes-cbc”，说明所使用的加密为“aes-cbc”，并根据RFC <span class="number">2630</span>进行填充。</span><br><span class="line">KeyLength                       UI8                     加密/解密算法的密钥长度（字节）。应为<span class="number">16</span>（即<span class="number">128</span>位）</span><br></pre></td></tr></table></figure>

<h5 id="a2-8-8-8-5">2.8.8.8.5. Key Information box</h5>

<p>Box type: ‘akey’ </p>
<p>Container:Standard Encryption Params box (‘aprm’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>密钥信息（akey）框包含用于检索用于解密样本的密钥的信息。</p>
<p>这些框中包含的条目的详细信息以及DRM客户机用于检索密钥的机制超出了本规范的范围。</p>
<p>akey box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	              Type	                         Comment</span><br><span class="line">Header                BOXHEADER                      BoxType = <span class="string">&#x27;akey&#x27;</span></span><br><span class="line">Version               UI8                            Shall be <span class="number">1</span></span><br><span class="line">Flags                 UI24                           Shall be <span class="number">0</span></span><br><span class="line">Params      IF AdobeDRMHeaderBox.Version == <span class="number">1</span>  </span><br><span class="line">                APSParamsBox                        本文件中未对apsparamsbox进行描述，因为它将不再由符合要求的应用程序生成。</span><br><span class="line">            ELSE</span><br><span class="line">                FMRMSv2ParamsBox</span><br></pre></td></tr></table></figure>

<h5 id="a2-8-8-8-6">2.8.8.8.6. Flash Access Params box</h5>

<p>Box type: ‘flxs’ </p>
<p>Container:Key Info box (‘akey’) </p>
<p>Mandatory: Yes, if AdobeDRMHeaderBox.Version == 2, else No </p>
<p>Quantity: One, if AdobeDRMHeaderBox.Version == 2, else Zero</p>
<p>flash access params（flxs）框包含用于检索用于解密样本的密钥的信息。</p>
<p>flxs box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	              Type	         Comment</span><br><span class="line">Header                BOXHEADER      BoxType = <span class="string">&#x27;flxs&#x27;</span></span><br><span class="line">FmrmsV2Metadata       STRING        DRM客户端用于检索解密密钥的base64编码元数据</span><br></pre></td></tr></table></figure>

<h5 id="a2-8-8-8-7">2.8.8.8.7. Adobe DRM Access Unit Format box</h5>

<p>Box type: ‘adaf’ </p>
<p>Container:Key Info box (‘adkm’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>访问单元格式（ADAF）框指定放置在样本上的头的格式。</p>
<p>tkhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	              Type	        Comment</span><br><span class="line">Header                BOXHEADER     BoxType = <span class="string">&#x27;tkhd&#x27;</span></span><br><span class="line">Version               UI8           Shall be <span class="number">1</span></span><br><span class="line">Flags                 UI24          Shall be <span class="number">0</span></span><br><span class="line">SelectiveEncryption   UI1           指示使用选择性加密。应为<span class="number">1</span>。</span><br><span class="line">                                    <span class="number">1</span>=启用选择性加密，即只加密部分样本，而不是全部样本。</span><br><span class="line">                                    <span class="number">0</span>=关闭选择性加密，并且对所有样本进行加密</span><br><span class="line">Reserved              UI7           Shall be <span class="number">0</span></span><br><span class="line">Reserved              UI8           Shall be <span class="number">0</span></span><br><span class="line">IVLength              UI8           初始化向量的大小（字节）。该长度应与所用算法一致。应为<span class="number">16</span>（<span class="number">128</span>位）</span><br></pre></td></tr></table></figure>

<h3 id="a2-9">2.9.  Movie Extends box</h3>

<p>Box type: ‘mvex’ </p>
<p>Container:Movie box (‘moov’) </p>
<p>Mandatory: No </p>
<p>Quantity: One</p>
<p>如果f4v文件包含片段，则电影（moov）框包含一个电影扩展（mvex）框，否则没有mvex框。对于碎片，一个F4V文件应包含一个且仅一个MVEX盒。mvex框告诉读者此文件可能包含电影片段（moof）框。</p>
<p>mvex box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	          Comment</span><br><span class="line">Header          BOXHEADER         BoxType = <span class="string">&#x27;mvex&#x27;</span> (<span class="number">0x6D766578</span>)</span><br><span class="line">Boxes           BOX [ ]           定义片段的轨迹默认值的框</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.8.1 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-9-1">2.9.1. Movie Extends Header box</h4>

<p>Box type: ‘mehd’ </p>
<p>Container:Movie Extends box (‘mvex’) </p>
<p>Mandatory: No </p>
<p>Quantity: One</p>
<p>Movie扩展头（mehd）框提供碎片Movie的持续时间。如果Movie扩展（mvex）框不包含mehd框，则通过检查所有片段来计算总持续时间。</p>
<p>mehd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                 Type	          Comment</span><br><span class="line">Header                   BOXHEADER         BoxType = <span class="string">&#x27;mehd&#x27;</span> (<span class="number">0x6D766578</span>)</span><br><span class="line">Version                  UI8               Either <span class="number">0</span> or <span class="number">1</span></span><br><span class="line">Flags                    UI24              Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">FragmentDuration        If Version==<span class="number">0</span></span><br><span class="line">                            UI32            在mvhd框中定义的时间刻度单位中最长轨迹的持续时间</span><br><span class="line">                        If Version ==<span class="number">1</span></span><br><span class="line">                            UI64</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.8.2 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-9-2">2.9.2. Track Extends box</h4>

<p>Box type: ‘trex’ </p>
<p>Container:Movie Extends box (‘mvex’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One for each track in the Movie box</p>
<p>轨迹延伸”（Trex）框定义电影片段的默认值。</p>
<p>trex box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                            Type	            Comment</span><br><span class="line">Header                              BOXHEADER           BoxType = <span class="string">&#x27;trex&#x27;</span> (<span class="number">0x74726578</span>)</span><br><span class="line">Version                             UI8                 Expected to be <span class="number">0</span></span><br><span class="line">Flags                               UI24                Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">TrackID                             UI32                Identity <span class="keyword">of</span> the associated track</span><br><span class="line">DefaultSampleDescriptionIndex       UI32                要在跟踪片段中使用的默认sampleDescriptionIndex</span><br><span class="line">DefaultSampleDuration               UI32                在跟踪片段中使用的默认sampleduration</span><br><span class="line">DefaultSampleSize                   UI32                在track片段中使用的默认sampleSize</span><br><span class="line">DefaultSampleFlags                  SAMPLEFLAGS         在跟踪片段中使用的默认sampleFlags</span><br><span class="line"></span><br><span class="line">Each SAMPLEFLAGS record has the following layout: </span><br><span class="line">SAMPLEFLAGS</span><br><span class="line"></span><br><span class="line">Reserved                            UI6                 Reserved. <span class="built_in">Set</span> to <span class="number">0.</span></span><br><span class="line">SampleDependsOn                     UI2                 <span class="number">0</span> = 示例依赖项未知</span><br><span class="line">                                                        <span class="number">1</span> = 此示例依赖于其他示例（不是i图片）</span><br><span class="line">                                                        <span class="number">2</span> = 此示例不依赖于其他示例（图片）</span><br><span class="line">                                                        <span class="number">3</span> = reserved</span><br><span class="line">SampleIsDependedOn                  UI2                 <span class="number">0</span> = 其他示例对该示例的依赖性未知</span><br><span class="line">                                                        <span class="number">1</span> = 其他样品可能依赖于此样品（非一次性样品）</span><br><span class="line">                                                        <span class="number">2</span> = 其他样品不依赖于此样品（一次性）</span><br><span class="line">                                                        <span class="number">3</span> = reserved</span><br><span class="line">SampleHasRedundancy                 UI2                 <span class="number">0</span> = 尚不清楚此示例中是否存在冗余编码</span><br><span class="line">                                                        <span class="number">1</span> = 此示例中存在冗余编码</span><br><span class="line">                                                        <span class="number">2</span> = 此示例中没有冗余编码</span><br><span class="line">                                                        <span class="number">3</span> = reserved</span><br><span class="line">SamplePaddingValue                  UI3                 Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">SampleIsDifferenceSample            UI1                 <span class="number">0</span> = 密钥或同步示例</span><br><span class="line">                                                        <span class="number">1</span> = 非键或非同步示例</span><br><span class="line">SampleDegradationPriority           UI16                Reserved. <span class="built_in">Set</span> to <span class="number">1.</span></span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.8.3 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-10">2.10. User Data box</h4>

<p>Box type: ‘udta’ </p>
<p>Container:Movie box (‘moov’) or Track box (‘trak’) </p>
<p>Mandatory: No </p>
<p>Quantity: One at each movie level or track level</p>
<p>用户数据（udta）框包含在电影（moov）框或曲目（trak）框中。最多，每个电影级别或曲目级别可能会出现一个UDTA框。UDTA框应最后放置在其包含框中。</p>
<p>UDTA框声明有关包含框及其数据（表示或跟踪）的自由格式用户信息。Flash播放器忽略UDTA框的内容。</p>
<p>udta box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;udta&#x27;</span> (<span class="number">0x75647461</span>)</span><br><span class="line">UserData        BOX [ ]             具有自由格式用户数据的任意数量的框</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.10.1 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-11">2.11. F4V Boxes for HTTP Streaming</h4>
<h5 id="a2-11-1">2.11.2. Fragment Random Access box</h5>

<p>Box type: ‘afra’ </p>
<p>Container:File </p>
<p>Mandatory: Yes for HTTP streaming support with F4V fragments, otherwise no. </p>
<p>Quantity: One per fragment for HTTP streaming support with F4V fragments, otherwise zero.</p>
<p>片段随机访问（AFRA）框为一个或多个片段提供随机访问信息。</p>
<p>对于带有F4V片段的HTTP流支持，F4V文件可以为每个片段包含一个AFRA框。AFRA盒应位于片段的媒体数据（MDAT）和电影片段（MOOF）盒之前。AFRA框可用于查找包含给定时间内最近随机访问样本的F4V文件中的确切点。</p>
<p>AFRA框与给定片段关联（这里称为“关联片段”）。AFRA框还提供对同一段或不同段中其他片段中信息的随机访问。</p>
<p>AFRA框包含条目数组。每个条目包含随机访问样本的位置和表示时间。如果随机访问样本不在相关片段中，则条目还提供以下信息：</p>
<p>-段识别信息</p>
<p>-片段识别信息</p>
<p>-从包含段的开始到与此随机数关联的“afra”框的字节偏移量</p>
<p>接入点</p>
<p>-从关联的“afra”框到示例的字节偏移量</p>
<blockquote>
<p>片段中的每个随机访问样本不一定都有数组条目。AFRA盒的缺失并不意味着所有样本都是同步样本。“trun”、“traf”和“trex”中的随机访问信息设置适当，而不考虑此框的存在。</p>
</blockquote>
<p>afra box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                 Type	            Comment</span><br><span class="line">Header                   BOXHEADER           BoxType = <span class="string">&#x27;afra&#x27;</span> (<span class="number">0x61667261</span>)</span><br><span class="line">Version                  UI8                 Either <span class="number">0</span> or <span class="number">1</span></span><br><span class="line">Flags                    UI24                Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">LongIDs                  UI1                 控制全局框架项的段和片段字段的大小。</span><br><span class="line">LongOffsets              UI1                 控制AfraEntry的偏移字段的大小。还控制全局框架项的afraOffset和offsetFromAfra字段的大小。</span><br><span class="line">GlobalEntries            UI1                 值<span class="number">1</span>表示存在GlobalRycount</span><br><span class="line">Reserved                 UI5                 <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">TimeScale                UI32                每秒在AfraEntry和GlobalAfraEntry的时间字段中使用的时间单位数。</span><br><span class="line">EntryCount               UI32                LocalAccessEntries中的条目数</span><br><span class="line">LocalAccessEntries      AFRAENTRY</span><br><span class="line">                        [EntryCount]         随机访问此片段中的点。此数组不一定包含此片段中每个随机访问样本的条目。</span><br><span class="line">GlobalEntryCount        IF GlobalEntries == <span class="number">1</span> </span><br><span class="line">                            UI32            GlobalAccessEntries中的条目数。如果globalentries==<span class="number">0</span>，则此字段不存在，globalentrycount为<span class="number">0</span>。</span><br><span class="line">GlobalAccessEntries     GLOBALAFRAENTRY</span><br><span class="line">                        [GlobalEntryCount]  随机访问此片段之外的点。</span><br><span class="line"></span><br><span class="line">Each AFRAENTRY points to a sample within <span class="built_in">this</span> fragment, and has the following format: </span><br><span class="line">AFRAENTRY</span><br><span class="line"></span><br><span class="line">Time                    UI64                随机访问样本的表示时间，以时间刻度单位表示。</span><br><span class="line">Offset              IF LongOffsets == <span class="number">0</span></span><br><span class="line">                        UI32                从片段随机访问框开始到样本的字节偏移量</span><br><span class="line">                    ELSE</span><br><span class="line">                        UI64</span><br><span class="line">Each GLOBALAFRAENTRY points to a sample outside <span class="built_in">this</span> fragment, and has the following format: </span><br><span class="line">GLOBALAFRAENTRY</span><br><span class="line"></span><br><span class="line">Time                    UI64                 随机访问样本的表示时间，以时间刻度单位表示。</span><br><span class="line">Segment             IF LongIDs == <span class="number">0</span></span><br><span class="line">                        UI16                包含此随机接入点的段的数目</span><br><span class="line">                    ELSE</span><br><span class="line">                        UI32</span><br><span class="line">Fragment            IF LongIDs == <span class="number">0</span></span><br><span class="line">                        UI16                包含此随机访问点的片段的数目</span><br><span class="line">                    ELSE</span><br><span class="line">                        UI32</span><br><span class="line">AfraOffset          IF LongOffsets == <span class="number">0</span></span><br><span class="line">                        UI32                从包含段开始到与此随机接入点关联的AFRA框的字节偏移量。</span><br><span class="line">                    ELSE</span><br><span class="line">                        UI64</span><br><span class="line">OffsetFromAfra	IF LongOffsets == <span class="number">0</span></span><br><span class="line">                        UI32                从关联的AFRA框到样本的字节偏移量</span><br><span class="line">                    ELSE</span><br><span class="line">                        UI64</span><br></pre></td></tr></table></figure>

<h5 id="a2-11-2">2.11.2. Bootstrap Info box</h5>

<p>Box type: ‘abst’ </p>
<p>Container:File </p>
<p>Mandatory: Yes for HTTP streaming support with F4V fragments, otherwise no. </p>
<p>Quantity: One or more for HTTP streaming support with F4V fragments, otherwise zero.</p>
<p>引导信息（abst）框包含引导媒体演示URL从媒体客户端向HTTP服务器请求RFC1630所需的信息。媒体演示可以是现场演示，也可以是视频点播。此框包含有关服务器、电影和段信息的基本信息。它还包含一个或多个段运行表和段运行表。</p>
<p>在HTTP流段中，abt框是可选的，位于电影（moov）框之前。在HTTP流片段中，ABT框是必需的。有关HTTP流所需的框和结构的描述，请参阅附录C.HTTP流：文件结构。</p>
<p>abst box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                Type	            Comment</span><br><span class="line">Header                  BOXHEADER           BoxType = <span class="string">&#x27;abst&#x27;</span> (<span class="number">0x61627374</span>)</span><br><span class="line">Version                 UI8                 Either <span class="number">0</span> or <span class="number">1</span></span><br><span class="line">Flags                   UI24                Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">BootstrapinfoVersion    UI32                引导信息的版本号。设置更新字段后，bootstrapinfoversion指示正在更新的版本号。</span><br><span class="line">Profile                 UI2                 指示它是命名访问（<span class="number">0</span>）还是范围访问（<span class="number">1</span>）配置文件。为将来的配置文件保留一个位。</span><br><span class="line">Live                    UI1                 指示媒体演示文稿是否为实时（<span class="number">1</span>）。</span><br><span class="line">Update                  UI1                 指示此表是引导程序框或文件的完整版本（<span class="number">0</span>）还是以前定义（发送）的完整版本的更新（<span class="number">1</span>）。</span><br><span class="line">                                            更新不是完整的替换。它们只能包含更改的元素。服务器仅在引导信息更改时发送更新。</span><br><span class="line">                                            更新应用于具有相同bootstrapinfoversion编号的完整版本。</span><br><span class="line">                                            同一个bootstrapinfoversion号可能有多个更新。</span><br><span class="line">                                            如果服务器发送多个更新，这些更新将应用于具有相同bootstrapinfoversion号的完整版本。</span><br><span class="line">                                            每个更新都包括以前对同一个bootstrapinfoversion的所有更新。对于单个完整版本的多个更新，</span><br><span class="line">                                            最新更新是基于当前的MediaTime确定的。</span><br><span class="line"></span><br><span class="line">Reserved                UI4                 Reserved, set to <span class="number">0</span></span><br><span class="line">TimeScale               UI32                每秒的时间单位数。字段CurrentMediaTime使用此值表示准确的时间。通常，该值为<span class="number">1000</span>，以毫秒为单位。</span><br><span class="line"></span><br><span class="line">CurrentMediaTime        UI64                媒体演示文稿中最新可用片段的时间刻度单位时间戳。这个时间戳用于请求正确的片段号。</span><br><span class="line">                                            CurrentMediaTime可以是总持续时间。对于非活动的媒体演示文稿，当前MediaTime可以为<span class="number">0</span>。</span><br><span class="line"></span><br><span class="line">SmpteTimeCodeOffset     UI64                当前媒体时间与smpte时间代码之间的偏移量，已转换为毫秒。</span><br><span class="line">                                            此偏移量不是以时间刻度单位表示的。未使用时，此字段为零。</span><br><span class="line">                                            服务器使用smpte时间代码模块<span class="number">24</span>小时使偏移量为正。</span><br><span class="line"></span><br><span class="line">MovieIdentifier         STRING              此演示文稿的标识符。标识符是以空结尾的UTF-<span class="number">8</span>字符串。例如，它可以是URL中的文件名或路径名。见</span><br><span class="line">                                            附录C<span class="number">.4</span> URL结构供使用</span><br><span class="line"></span><br><span class="line">ServerEntryCount        UI8                 ServerEntryTable条目数。最小值为<span class="number">0</span>。</span><br><span class="line">ServerEntryTable        SERVERENTRY</span><br><span class="line">                        [ServerEntryCount]  按优先顺序降序排列的服务器URL</span><br><span class="line">QualityEntryCount       UI8                 QualityEntryTable条目数，也就是可用的质量级别数。最小值为<span class="number">0</span>。</span><br><span class="line">                                            可用的质量级别包括，例如，多比特率文件或技巧文件。</span><br><span class="line"></span><br><span class="line">QualityEntryTable       QUALITYENTRY</span><br><span class="line">                        [QualityEntryCount] 从高质量到低质量的质量文件参考</span><br><span class="line">DrmData                 STRING              以NULL或NULL结尾的UTF-<span class="number">8</span>字符串。此字符串包含数字版权管理元数据。</span><br><span class="line">                                            加密文件使用此元数据获取解密和播放所需的密钥和许可证。</span><br><span class="line">MetaData                STRING              包含元数据的以NULL或NULL结尾的UTF-<span class="number">8</span>字符串</span><br><span class="line">SegmentRunTableCount    UI8                 SegmentRunTableEntries中的条目数。最小值为<span class="number">1</span>。通常，一个表包含所有段运行。</span><br><span class="line">                                            但是，此计数提供了为每个质量级别（或技巧文件）单独定义段运行的灵活性。</span><br><span class="line">SegmentRunTableEntries  SegmentRunTable</span><br><span class="line">                    [SegmentRunTableCount]  <span class="built_in">Array</span> <span class="keyword">of</span> SegmentRunTable elements</span><br><span class="line">FragmentRunTableCount       UI8             fragmentruntable中的条目数-条目数。最小值为<span class="number">1</span>。</span><br><span class="line">FragmentRunTableEntries   FragmentRunTable</span><br><span class="line">                    [FragmentRunTableCount]     碎片可运行元素数组</span><br><span class="line"></span><br><span class="line">Each SERVERENTRY has the following format: SERVERENTRY</span><br><span class="line"></span><br><span class="line">ServerBaseURL           STRING               该服务器上此演示文稿的服务器基URL。该值是以空结尾的utf-<span class="number">8</span>字符串，没有尾随的“/”。</span><br><span class="line"></span><br><span class="line">Each QUALITYENTRY has the following format: QUALITYENTRY</span><br><span class="line"></span><br><span class="line">QualitySegmentUrlModifier   STRING	         用于构造该质量媒体的正确URL的质量（段）文件的名称。</span><br><span class="line">                                            该值是以空结尾的utf-<span class="number">8</span>字符串，可以选择带有尾随的“/”。</span><br></pre></td></tr></table></figure>

<h5 id="a2-11-2-1">2.11.2.1. Segment Run Table box</h5>

<p>Box type: ‘asrt’ </p>
<p>Container:Bootstrap Info box (‘abst’)  </p>
<p>Mandatory: Yes </p>
<p>Quantity: One or more</p>
<p>段运行表（ASRT）框可用于定位包含特定片段的段。可能有几个ASRT箱，每个箱的质量等级不同。</p>
<p>ASRT框使用压缩编码：</p>
<p>-段运行表可以表示几个质量级别的段运行。</p>
<p>-段运行表是紧凑编码的。每个条目给出一段运行的第一个段号</p>
<p>同样数量的碎片。具有相同片段计数的片段的计数可以通过从下一个条目中的第一个片段号减去此条目中的第一个片段号来计算。</p>
<p>asrt box</p>
<p>ASRT框使用压缩编码：</p>
<p>-段运行表可以表示几个质量级别的段运行。</p>
<p>-段运行表是紧凑编码的。每个条目给出一段运行的第一个段号</p>
<p>同样数量的碎片。具有相同片段计数的片段的计数可以通过从下一个条目中的第一个片段号减去此条目中的第一个片段号来计算。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field                                Type	                    Comment</span><br><span class="line">Header                               BOXHEADER                  BoxType = <span class="string">&#x27;asrt&#x27;</span> (<span class="number">0x61737274</span>)</span><br><span class="line">Version                              UI8                        Either <span class="number">0</span> or <span class="number">1</span></span><br><span class="line">Flags                                UI24                       定义了以下值：</span><br><span class="line">                                                                <span class="number">0</span>=整张桌子。</span><br><span class="line">                                                                <span class="number">1</span>=此表中的记录是对先前定义的段运行表的更新（或要附加的新条目）。</span><br><span class="line">                                                                当此标志为<span class="number">1</span>时，包含引导信息框中的更新标志应为<span class="number">1</span>。</span><br><span class="line">QualityEntryCount                    UI8                                 后面的QualitySegmentUrlModifier（质量级别引用）的数量。如果为<span class="number">0</span>，</span><br><span class="line">                                                                则此段运行表适用于所有质量级别，引导信息框中只能有一个段运行表框。</span><br><span class="line"></span><br><span class="line">QualitySegmentUrlModifiers           STRING</span><br><span class="line">                                [QualityEntryCount]             此表应用于的质量级别的名称数组。名称是以空结尾的UTF-<span class="number">8</span>字符串。</span><br><span class="line">                                                                数组应是引导信息（abt）框中可输入的质量的子集。</span><br><span class="line">                                                                这些名称不应出现在引导程序信息框中的任何其他段运行表中。</span><br><span class="line">SegmentRunEntryCount                 UI32                       此SegmentRunEntryTable中的项数。最小值为<span class="number">1</span>。</span><br><span class="line">SegmentRunEntryTable                 SEGMENTRUNENTRY            段运行项数组</span><br><span class="line">                        [           SegmentRunEntryCount ]</span><br><span class="line"></span><br><span class="line">Each SEGMENTRUNENTRY has the following format: SEGMENTRUNENTRY</span><br><span class="line"></span><br><span class="line">FirstSegment                         UI32                        包含相同数量片段的段运行中第一段的标识号。</span><br><span class="line">                                                                 对应于下一个segmentrunentry中第一个segment的段将终止此运行。</span><br><span class="line">FragmentsPerSegment                  UI32                        此运行中每个段中的片段数</span><br></pre></td></tr></table></figure>

<h5 id="a2-11-2-2">2.11.2.2. Fragment Run Table box</h5>

<p>Box type: ‘afrt’ </p>
<p>Container:Bootstrap Info box (‘abst’)  </p>
<p>Mandatory: Yes </p>
<p>Quantity: One or more</p>
<p>片段运行表（AFRT）框可用于查找包含与给定时间对应的样本的片段。</p>
<p>片段由URL方案单独标识。碎片的持续时间和样本数量都可能不同。碎片的持续时间储存在AFRT箱中。</p>
<p>AFRT盒使用压缩编码：</p>
<p>-片段运行表可以表示多个质量级别的片段。</p>
<p>-片段运行表是紧凑编码的，因为每个条目都给出了运行的第一个片段号。</p>
<p>具有相同持续时间的片段。可以通过从下一个条目中的第一个片段号减去此条目中的第一个片段号来计算具有相同持续时间的片段数。</p>
<p>一个引导信息框中可能有几个片段运行表框，每个框用于不同的质量级别。</p>
<p>asrt box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                            Type	                    Comment</span><br><span class="line">Header                              BOXHEADER                   BoxType =<span class="string">&#x27;afrt&#x27;</span> (<span class="number">0x61667274</span>)</span><br><span class="line">Version                             UI8                         Either <span class="number">0</span> or <span class="number">1</span></span><br><span class="line">Flags                               UI24                        定义了以下值：</span><br><span class="line">                                                                <span class="number">0</span>=A full table</span><br><span class="line">                                                                <span class="number">1</span>=此表中的记录是以前定义的片段运行表的更新（或要追加的新条目</span><br><span class="line">                                                                当此标志为<span class="number">1</span>时，包含引导信息框中的更新标志应为<span class="number">1</span>。</span><br><span class="line">TimeScale                           UI32                        每秒在FirstFragmentTimestamp和FragmentDuration字段中使用的时间单位数。通常，值为<span class="number">1</span>。</span><br><span class="line">QualityEntryCount                   UI8                         后面的QualitySegmentUrlModifier（质量级别引用）的数量。</span><br><span class="line">                                                                如果为<span class="number">0</span>，则此片段运行表适用于所有质量级别，并且引导信息框中只能有一个片段运行表框。</span><br><span class="line">QualitySegmentUrlModifiers          STRING</span><br><span class="line">                                [QualityEntryCount]             此表应用于的质量级别的名称数组。名称是以空结尾的UTF-<span class="number">8</span>字符串。</span><br><span class="line">                                                                数组应是引导信息（abt）框中可输入的质量的子集。</span><br><span class="line">                                                                这些名称不应出现在引导程序信息框中的任何其他片段运行表中。</span><br><span class="line"></span><br><span class="line">FragmentRunEntryCount               UI32                        此FragmentRunEntryTable中的项数。最小值为<span class="number">1</span>。</span><br><span class="line">FragmentRunEntryTable               FRAGMENTRUNENTRY</span><br><span class="line">                                [FragmentRunEntryCount]         片段运行项数组</span><br><span class="line">每个fragmentrunentry的格式如下：fragmentrunentry</span><br><span class="line"></span><br><span class="line">FirstFragment                       UI32                        具有相同持续时间的此片段运行中第一个片段的标识号。</span><br><span class="line">                                                                与下一个fragmentrunentry中的第一个fragment对应的片段将终止此运行。</span><br><span class="line">FirstFragmentTimestamp              UI64                        第一个片段的时间戳，以时间刻度单位表示。</span><br><span class="line">                                                                此字段确保片段时间戳可以在开始时准确表示。</span><br><span class="line">                                                                它还可以确保在由于持续时间准确性或时间戳不连续而发生偏移时同步时间戳。</span><br><span class="line">FragmentDuration                    U32                         此运行中每个片段的持续时间（以时间刻度单位表示）</span><br><span class="line">DiscontinuityIndicator          IF FragmentDuration == <span class="number">0</span></span><br><span class="line">                                    UI8                         表示时间戳和/或片段号中的不连续。此字段还用于标识（实时）演示文稿的结尾。</span><br><span class="line">                                                                定义了以下值：</span><br><span class="line">                                                                <span class="number">0</span>=演示结束。</span><br><span class="line">                                                                <span class="number">1</span>=片段编号的不连续性。</span><br><span class="line">                                                                <span class="number">2</span>=时间戳的不连续性。</span><br><span class="line">                                                                <span class="number">3</span>=时间戳和片段编号的不连续性。</span><br><span class="line">                                                                保留所有其他值。</span><br><span class="line">                                                                在现场场景中，在带内发出演示结束的信号非常有用。</span><br><span class="line">                                                                表示中的间隔被表示为零持续时间片段的运行，同时具有片段数和时间戳不连续性。</span><br><span class="line">                                                                片段数不连续性对于片段编号方案中没有不连续性的跳变信号很有用</span><br></pre></td></tr></table></figure>

<h4 id="a2-12">2.12. Movie Fragment box</h4>

<p>Box type: ‘moof’ </p>
<p>Container: File </p>
<p>Mandatory: Yes for HTTP streaming support with F4V fragments, otherwise no </p>
<p>Quantity: One per fragment for HTTP streaming support with F4V fragments, otherwise zero.</p>
<p>Movie片段（MOOF）框提供特定于片段的信息，否则这些信息将出现在媒体（MOOV）框中。MOOF箱应按顺序排列。</p>
<p>moof box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;moof&#x27;</span> (<span class="number">0x6D6F6F66</span>)</span><br><span class="line">Boxes           BOX [ ]             定义示例结构的多个框</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.8.4 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-12-1">2.12.1. Movie Fragment Header box</h5>

<p>Box type: ‘mfhd’ </p>
<p>Container: Movie Fragment box (‘moof’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>Movie片段头（mfhd）框包含序列号，用于验证文件的完整性。</p>
<p>mfhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;mfhd&#x27;</span> (<span class="number">0x6D666864</span>)</span><br><span class="line">Version         UI8                 Expected to be <span class="number">0</span></span><br><span class="line">Flags           UI24                Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">SequenceNumber  UI32                从<span class="number">1</span>开始，并按文件中每个电影片段的出现顺序递增。</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.8.5 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-12-2">2.12.2. Track Fragment box</h5>

<p>Box type: ‘traf’ </p>
<p>Container: Movie Fragment box  </p>
<p>Mandatory: No </p>
<p>Quantity: Zero or more</p>
<p>轨迹片段（traf）框对应于f4v文件中的轨迹。每个交通箱包含零个或多个轨道运行，其中包括该轨道的连续运行。</p>
<p>traf box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;traf&#x27;</span> (<span class="number">0x74726166</span>)</span><br><span class="line">Boxes           BOX [ ]             定义片段中轨道运行的任意数量的框</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.8.6 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-12-2-1">2.12.2.1. Track Fragment Header box</h5>

<p>Box type: ‘tfhd’ </p>
<p>Container: Track Fragment box  </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>“轨迹片段头”（tfhd）框设置用于影片片段中样本运行的信息和默认值。每个电影片段可以向每个曲目添加零个或多个片段，而一个曲目片段可以添加零个或多个连续运行的示例。</p>
<p>tfhd box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                     Type	            Comment</span><br><span class="line">Header                       BOXHEADER           BoxType = <span class="string">&#x27;tfhd&#x27;</span> (<span class="number">0x74666864</span>)</span><br><span class="line">Version                      UI8                 Expected to be <span class="number">0</span></span><br><span class="line">Flags                        UI24                以下标志可用于任何组合：</span><br><span class="line">                                                 <span class="number">0x000001</span>=基础数据偏移量存在</span><br><span class="line">                                                 <span class="number">0x000002</span>=样本描述存在</span><br><span class="line">                                                 <span class="number">0x000008</span>=默认样本持续时间存在</span><br><span class="line">                                                 <span class="number">0x0000010</span>=默认样本大小存在</span><br><span class="line">                                                 <span class="number">0x0000020</span>=默认样本标志存在</span><br><span class="line">                                                 <span class="number">0x10000</span>=持续时间为空：没有样本用于提供的持续时间</span><br><span class="line">                                                 TFHD框或Trex框中的默认采样持续时间。见下表注释</span><br><span class="line">TrackID                      UI32                在“Track标题”框中指定的关联Track的标识</span><br><span class="line">BaseDataOffset               IF Flags </span><br><span class="line">                             &amp; <span class="number">0x000001</span> == <span class="literal">true</span></span><br><span class="line">                                UI64            可选的。计算每个轨道运行中的数据偏移量时要使用的基准偏移量。默认值在表下面定义。</span><br><span class="line">SampleDescriptionIndex      IF Flags</span><br><span class="line">                            &amp; <span class="number">0x000002</span> == <span class="literal">true</span></span><br><span class="line">                                UI32            可选的。要在此片段中使用的sampleDescriptionIndex。</span><br><span class="line">                                                这将覆盖该片段的trex框中的默认sampleDescriptionIndex。</span><br><span class="line">DefaultSampleDuration       IF Flags </span><br><span class="line">                            &amp; <span class="number">0x000008</span> == <span class="literal">true</span></span><br><span class="line">                                UI32            可选的。此片段中要使用的默认sampleduration。</span><br><span class="line">                                                这将覆盖该片段的Trex框中的默认采样持续时间。</span><br><span class="line">DefaultSampleSize           IF Flags</span><br><span class="line">                            &amp; <span class="number">0x000010</span> == <span class="literal">true</span></span><br><span class="line">                                UI32            可选的。此片段中使用的默认sampleSize。这将覆盖该片段的trex框中的默认sampleSize。</span><br><span class="line">DefaultSampleFlags          IF Flags </span><br><span class="line">                            &amp; <span class="number">0x000020</span> == <span class="literal">true</span></span><br><span class="line">                                SAMPLEFLAGS     可选的。此片段中要使用的默认sampleFlags。这将覆盖该片段的trex框中的默认sampleFlags。</span><br></pre></td></tr></table></figure>


<p>basedataoffset：如果此处未提供值，则电影片段中第一个曲目的默认值是封闭电影片段框的第一个字节的位置。对于后续的跟踪片段，默认值是由前面的片段定义的数据的结尾。以这种方式“继承”其偏移量的片段都应使用相同的数据引用，即，这些轨迹的数据应在同一个文件中。</p>
<blockquote>
<p>0x010000持续时间为空：如果一个F4V文档在MOOV框中有编辑列表，并且具有空的持续时间片段，则认为该文档格式不正确。</p>
</blockquote>
<p>For more information, see section 8.8.7 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-12-2-2">2.12.2.2. Track Fragment Run box</h5>

<p>Box type: ‘trun’ </p>
<p>Container: Track Fragment box (‘traf’) </p>
<p>Mandatory: No </p>
<p>Quantity: Zero or more</p>
<p>跟踪片段运行（trun）框定义跟踪的连续样本集。如果在“轨迹碎片框”（traf）框中设置了“持续时间为空”标志，则没有“躯干框”。</p>
<p>trun box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                    Type	            Comment</span><br><span class="line">Header                      BOXHEADER           BoxType = <span class="string">&#x27;trun&#x27;</span> (<span class="number">0x7472756E</span>)</span><br><span class="line">Version                     UI8                 Expected to be <span class="number">0</span></span><br><span class="line">Flags                       UI24                下列标志可用于任何组合，但<span class="number">0x000004</span>和<span class="number">0x000400</span>除外：</span><br><span class="line">                                                <span class="number">0x000001</span>=存在数据偏移量</span><br><span class="line">                                                <span class="number">0x000004</span>=存在第一个样本标志</span><br><span class="line">                                                <span class="number">0x000100</span>=存在样本持续时间</span><br><span class="line">                                                <span class="number">0x000200</span>=存在样本大小</span><br><span class="line">                                                <span class="number">0x000400</span>=存在样本标志</span><br><span class="line">                                                <span class="number">0x00800</span>=存在样品组成时间偏移</span><br><span class="line">SampleCount                 UI32                sampleInformation中的条目数</span><br><span class="line">DataOffset                  IF Flags </span><br><span class="line">                        &amp; <span class="number">0x000001</span> == <span class="literal">true</span></span><br><span class="line">                            SI32                可选的。要添加到在tfhd框中定义的数据偏移量的值。默认值在表下面定义。</span><br><span class="line">FirstSampleFlags            IF Flags </span><br><span class="line">                        &amp; <span class="number">0x000004</span> == <span class="literal">true</span></span><br><span class="line">                            SAMPLEFLAGS         可选的。仅用于此Trun Box中描述的集合的第一个样本的标志。见下表文本。</span><br><span class="line">SampleInformation           SampleInformationStructure</span><br><span class="line">                            [SampleCount]       结构中的所有字段都是可选的</span><br><span class="line"></span><br><span class="line">每个sampleInformationstructure记录都有以下布局：sampleInformationstructure</span><br><span class="line">SampleDuration              IF Flags </span><br><span class="line">                        &amp; <span class="number">0x000100</span> == <span class="literal">true</span></span><br><span class="line">                            UI32                可选的。每个采样的持续时间，以媒体头中为此曲目定义的时间刻度单位为单位</span><br><span class="line">                                                如果不存在，则使用默认值。</span><br><span class="line">SampleSize                  IF Flags </span><br><span class="line">                        &amp; <span class="number">0x000200</span> == <span class="literal">true</span></span><br><span class="line">                            UI32                可选的。每个样本的大小。如果不存在，则使用默认值。</span><br><span class="line">SampleFlags                 IF Flags </span><br><span class="line">                        &amp; <span class="number">0x000400</span> == <span class="literal">true</span></span><br><span class="line">                            SAMPLEFLAGS         可选的。每个样本的sampleFlags。如果不存在，则使用默认值。</span><br><span class="line">SampleCompositionTimeOffset	IF Flags </span><br><span class="line">                        &amp; <span class="number">0x000800</span> == <span class="literal">true</span></span><br><span class="line">                            UI32                可选的。每个样本的合成时间偏移。如果不存在，则使用默认值。</span><br></pre></td></tr></table></figure>


<p>data offset：如果不存在数据偏移量，则此运行的数据从两个位置之一开始。如果此运行是跟踪片段中的第一个，则它从由跟踪片段头定义的基础数据偏移量开始。否则，它会在上一次运行的数据之后立即启动。</p>
<p>FirstSampleFlags：仅覆盖第一个示例的默认标志。这使得记录一组帧成为可能，其中第一个帧是键，其余的帧是不同的帧，而不为每个样本提供显式标志。设置此标志时，不应出现示例标志。</p>
<p>For more information, see section 8.8.8 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-13">2.13.  Media Data box</h4>

<p>Box type: ‘mdat’ </p>
<p>Container: File </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>媒体数据（mdat）框包含f4v文件的媒体数据负载。所有视频示例、音频示例、数据示例以及提示轨和示例都包含在mdat框中。请参见1.8支持的媒体类型。</p>
<p>mdat框与media（moov）框一起出现在f4v文件的顶层。</p>
<p>无法单独理解mdat框，这也是文件中必须存在moov框的原因。</p>
<p>mdat box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;mdat&#x27;</span> (<span class="number">0x6D646174</span>)</span><br><span class="line">Payload         UI8 [ ]             媒体数据字节，其结构在文件的MOOV框中定义。</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.2.2 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-13-1">2.13.1.  Hint Track Samples for HTTP Streaming</h5>

<p>mdat框包含用于包含f4v片段的HTTP流的提示轨。提示轨包含ADobemuxhintsamples。Adobemux提示示例输入框（rtmp）描述了提示轨迹。</p>
<h5 id="a2-13-1-1">2.13.1.1. AdobeMuxHintSample</h5>

<p>一组adobemuxhintsamples组成了一个提示跟踪，它采用Adobe多路提示跟踪格式。Adobemuxhintsample具有以下布局：</p>
<p>AdobeMuxHintSample</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	                    Comment</span><br><span class="line">PacketCount     IF PacketCountField == <span class="number">1</span></span><br><span class="line">                UI8                         此adobemuxhintsample中的adobemuxPacket条目数。</span><br><span class="line">                                            当packetCountField==<span class="number">0</span>时，adobmuxPackets是自描述的，可以隐式确定数字。</span><br><span class="line">Packets         AdobeMuxPacket</span><br><span class="line">                [PacketCount]               AdobEmuxPacket元素数组</span><br></pre></td></tr></table></figure>

<h5 id="a2-13-1-2">2.13.1.2. AdobeMuxPacket</h5>

<p>AdobEmuxPacket具有以下布局。EncryptionHeader及其之前的部分与E.4.1节中定义的flvtag中的相应部分相同。</p>
<p>AdobeMuxPacket</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                    Type	                    Comment</span><br><span class="line">Reserved                    UI2                         Reserved <span class="keyword">for</span> FMS, should be <span class="number">0</span></span><br><span class="line">Filter                      UI1                         指示是否筛选数据包。</span><br><span class="line">                                                        <span class="number">0</span>=不需要预处理。</span><br><span class="line">                                                        <span class="number">1</span>=在呈现数据包之前，需要对其进行预处理（如解密）。</span><br><span class="line">                                                        未加密文件中应为<span class="number">0</span>，加密标签应为<span class="number">1</span>。过滤器的使用见附录F.FLV加密。</span><br><span class="line">TagType                     UI5                         此标记的类型。定义了以下类型：</span><br><span class="line">                                                        <span class="number">8</span>＝音频</span><br><span class="line">                                                        <span class="number">9</span>＝视频</span><br><span class="line">                                                        保留所有其他值</span><br><span class="line">                                                        （<span class="number">18</span>=不得使用脚本数据）</span><br><span class="line">DataSize                    UI24                        消息的长度。streamid到数据包结尾后的字节数（等于数据包长度–<span class="number">11</span>）</span><br><span class="line">Timestamp                   UI24                        应用此标记中数据的时间（毫秒）。该值与flv文件中的第一个标记相关，该标记的时间戳始终为<span class="number">0</span>。</span><br><span class="line">TimestampExtended           UI8                         timestamp字段的扩展，以形成si32值。此字段表示高<span class="number">8</span>位，而前一个时间戳字段表示低<span class="number">24</span>位时间（毫秒）。</span><br><span class="line">StreamID                    UI24                        Always <span class="number">0.</span></span><br><span class="line">AudioTagHeader              IF TagType == <span class="number">8</span></span><br><span class="line">                            AudioTagHeader              第E<span class="number">.4</span><span class="number">.2</span><span class="number">.1</span>节中定义的audioTagHeader元素。</span><br><span class="line">VideoTagHeader              IF TagType == <span class="number">9</span></span><br><span class="line">                            VideoTagHeader              第E<span class="number">.4</span><span class="number">.3</span><span class="number">.1</span>节中定义的VideoTagHeader元素。</span><br><span class="line">EncryptionHeader            IF Filter == <span class="number">1</span></span><br><span class="line">                            EncryptionTagHeader         如第F<span class="number">.3</span><span class="number">.1</span>节所述，每个受保护样品应包括加密头。</span><br><span class="line">ConstructorCount            IF ConstructorCountField == <span class="number">1</span></span><br><span class="line">                                UI8                     ADobemuxhintconstructors的数目。</span><br><span class="line">                                                        当使用使用不同模式或原始样本的不同部分的多个数据块构造单个FLV标记或RTMP消息时，</span><br><span class="line">                                                        特别使用此字段。如果<span class="title">constructorCountField</span>==0，则<span class="title">constructorCount</span>=1</span><br><span class="line"><span class="title">DataEntry</span>                   <span class="title">AdobeMuxHintConstructor</span></span><br><span class="line">                            [<span class="title">ConstructorCount</span>]          <span class="title">ADobEmuxHintConstructors</span>元素数组</span><br><span class="line"><span class="title">TrailerLength</span>               <span class="title">If</span> <span class="title">TrailerLengthField</span> == 1</span><br><span class="line">                                <span class="title">UI8</span>                     拖车的长度，以字节为单位。</span><br><span class="line">                                                        如果<span class="title">trailerLengthField</span>=0，则<span class="title">trailerLength</span>=<span class="title">trailerDefaultSize</span></span><br><span class="line"><span class="title">Trailer</span>                     <span class="title">UI8</span> </span><br><span class="line">                            [<span class="title">TrailerLength</span>]             其他数据，例如，为了兼容性。当处于<span class="title">FLV</span>兼容模式时，此字段携带上一个标记大小。</span><br></pre></td></tr></table></figure>

<h5 id="a2-13-1-3">2.13.1.3. AdobeMuxHintConstructor</h5>

<p>AdobEmuxHintConstructor具有以下布局：</p>
<p>AdobeMuxHintConstructor</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Mode            If ModeField == <span class="number">1</span></span><br><span class="line">                UI8                 提示正在使用跟踪模式。</span><br><span class="line">                                    当modefield==<span class="number">0</span>时，可以从Adobe MUX提示进程（AMHP）框中确定模式。</span><br><span class="line">HintInfo        If Mode == <span class="number">2</span>        如模式所示。尽管定义了三种提示模式，</span><br><span class="line">                AdobeMuxHintSampleConstructor</span><br><span class="line">                ELSE                但由于立即节点和立即节点提升模式都使用了ADobmUxHintimmediateConstructor，因此只指定了两个构造函数。</span><br><span class="line">                AdobeMuxHintImmediateConstructor</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="a2-13-1-4">2.13.1.4. AdobeMuxHintImmediateConstructor</h5>

<p>Adobmuxhintimmediteconstructor应在即时和即时节点提升模式中使用。这些模式以Adobe多路提示跟踪格式描述。</p>
<p>AdobEmuxHintimmediateConstructor具有以下布局：</p>
<p>AdobeMuxHintImmediateConstructor</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Length          If LengthField == <span class="number">1</span></span><br><span class="line">                UI24                要从后面的数据中获取的字节数。</span><br><span class="line">                                    如果lengthField==<span class="number">0</span>，则不存在此字段，并且长度是根据adobmuxPacket.dataSize计算得出的。</span><br><span class="line">Data            UI8 [Length]        要放入有效负载部分的数据字节</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.aaaaaaaaaaaaaaaaaaaaaaaaaaa of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-13-1-5">2.13.1.5. AdobeMuxHintSampleConstructor</h5>

<p>示例模式中应使用Adobemuxhintsampleconstructor。示例模式以Adobe多路提示跟踪格式描述。</p>
<p>AdobEmuxHintSampleConstructor具有以下布局：</p>
<p>AdobeMuxHintSampleConstructor</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	        Comment</span><br><span class="line">TrackRefIndex   SI8             指示示例数据将来自哪个跟踪的值。</span><br><span class="line">                                值为<span class="number">0</span>表示只引用了一个媒体曲目。</span><br><span class="line">                                <span class="number">1</span>到<span class="number">127</span>之间的值是指向提示跟踪引用原子项的索引。</span><br><span class="line">                                这些值指示要从哪个原始媒体跟踪样本。一个值</span><br><span class="line">                                -<span class="number">1</span>表示提示跟踪本身。也就是说，从与当前解析的提示示例相同的轨道获取示例。</span><br><span class="line">Length          UI24            要复制的示例中的字节数。模式==<span class="number">2</span>时，长度场应为<span class="number">1</span>。</span><br><span class="line">SampleNumber    UI32            轨道样本号。</span><br><span class="line">SampleOffset    UI32            从样本开始到开始复制点的偏移量</span><br></pre></td></tr></table></figure>

<h4 id="a2-14">2.14. Meta box</h4>

<p>Box type: ‘meta’ </p>
<p>Container:  File, Movie box (‘moov’), or Track box (‘trak’) </p>
<p>Mandatory: No </p>
<p>Quantity: Zero or one at each file level, movie level, or track level</p>
<p>元（meta）框的容器是一个f4v文件、一个电影（moov）框或一个轨道（trak）框。meta-box可以包含其他各种包含元数据的框。</p>
<p>meta box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;meta&#x27;</span> (<span class="number">0x6D657461</span>)</span><br><span class="line">Version         UI8                 Reserved, set to <span class="number">0</span></span><br><span class="line">Flags           UI24                Reserved, set to <span class="number">0</span></span><br><span class="line">Boxes           BOX [ ]             定义文件元数据的任意框数</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.11.1 of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-15">2.15. Free Space boxes</h4>

<p>Box type:  ‘free’ or ‘skip’  </p>
<p>Container: File or any box  </p>
<p>Mandatory: No </p>
<p>Quantity: Any</p>
<p>自由（free）和跳过（skip）框的内容是自由文件空间，播放机应忽略它们的内容。在允许使用盒子的地方可以使用盒子。这些框可以为将来扩展容器框中的数据保留空间。</p>
<p>mfra框应该是文件中的最后一个。mfra框中的最后一个框提供了mfra框中长度字段的副本。</p>
<p>free space box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;free&#x27;</span> (<span class="number">0x66726565</span>) or <span class="string">&#x27;skip&#x27;</span> (<span class="number">0x736b6970</span>)</span><br><span class="line">Void            UI8 [ ]             Arbitrary number <span class="keyword">of</span> bytes to end <span class="keyword">of</span> box</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.aaaaaaaaaaaaaaaaaaaaaaaaaaa of ISO/IEC 14496-12:2008.</p>
<h4 id="a2-16">2.16. Movie Fragment Random Access box</h4>

<p>Box type: ‘mfra’ </p>
<p>Container: File </p>
<p>Mandatory: No </p>
<p>Quantity: One</p>
<p>电影片段随机访问（mfra）框通过为轨迹（不一定是所有轨迹）提供轨迹片段随机访问（tfra）框，帮助在碎片化的f4v文件中查找随机访问点。此框中的信息不确定，只提供随机接入点的提示。</p>
<p>mfra box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;mfra&#x27;</span> (<span class="number">0x6D667261</span>)</span><br><span class="line">Boxes           BOX [ ]             定义随机接入点的任意数量的框</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.8.9 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-16-1">2.16.1. Track Fragment Random Access box</h5>

<p>Box type: ‘tfra’ </p>
<p>Container: Movie Fragment Random Access box (‘mfra’) </p>
<p>Mandatory: No </p>
<p>Quantity:  Zero or more</p>
<p>每个跟踪片段随机访问（TFRA）框条目提供随机可访问样本的位置和表示时间。tfra框不需要包含跟踪中每个随机可访问样本的条目。此框的缺失并不意味着所有样本都是同步样本。</p>
<p>tfra box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                    Type	            Comment</span><br><span class="line">Header                      BOXHEADER           BoxType = <span class="string">&#x27;tfra&#x27;</span> (<span class="number">0x74667261</span>)</span><br><span class="line">Version                     UI8                 Either <span class="number">0</span> or <span class="number">1</span></span><br><span class="line">Flags                       UI24                Reserved, set to <span class="number">0</span></span><br><span class="line">TrackID                     UI32                Identifies the track</span><br><span class="line">Reserved                    UI26                Reserved. <span class="built_in">Set</span> to <span class="number">0</span></span><br><span class="line">LengthSizeTrafNumMinus1     UI2                 RandomAccessStructure记录中TrafNumber字段的长度（以字节为单位），减去<span class="number">1</span></span><br><span class="line">LengthSizeTrunNumMinus1     UI2                 RandoAccessStructure记录中的TrunNumber字段的长度（以字节为单位），减去<span class="number">1</span></span><br><span class="line">LengthSizeSampleNumMinus1   UI2                 randomAccessStructure记录中sampleNumber字段的长度（以字节为单位），减去<span class="number">1</span></span><br><span class="line">NumberEntry                 UI32                此曲目的条目数。如果为<span class="number">0</span>，则每个样本都是随机接入点</span><br><span class="line">RandomAccessSample          RandomAccessStructure</span><br><span class="line">                            [NumberEntry]       随机访问样本的位置和呈现时间</span><br><span class="line">每个randomaccessstructure记录都有以下布局：randomaccessstructure</span><br><span class="line">Time                        IF Version == <span class="number">0</span></span><br><span class="line">                                UI32</span><br><span class="line">                            IF Version == <span class="number">1</span></span><br><span class="line">                                UI64             随机访问样本的表示时间，以媒体标题中为此曲目定义的时间刻度单位表示。</span><br><span class="line">MoofOffset                  IF Version == <span class="number">0</span></span><br><span class="line">                                UI32</span><br><span class="line">                            IF Version == <span class="number">1</span></span><br><span class="line">                                UI64            对应电影片段框的字节偏移量，从文件开始</span><br><span class="line">TrafNumber                  &#123; UI8, UI16, UI24, UI32 &#125; </span><br><span class="line">                            [LengthSizeTrafNumMinus1]   包含随机可访问样本的traf编号。每个MOOF中的第一个traf编号为<span class="number">1</span>。</span><br><span class="line">                                                        类型是按长度大小索引的ui8、ui16、ui24、ui32中的一个<span class="number">1</span></span><br><span class="line">TrunNumber                  &#123; UI8, UI16, UI24, UI32 &#125; </span><br><span class="line">                            [LengthSizeTrunNumMinus1]   包含随机可访问样本的Trun编号。每个交通中的第一个通道编号为<span class="number">1</span>。</span><br><span class="line">SampleNumber                &#123; UI8, UI16, UI24, UI32 &#125;</span><br><span class="line">                            [LengthSizeSampleNumMinus1]     包含随机可访问样本的样本号。每个耳轴的第一个样本编号为<span class="number">1</span>。</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.8.10 of ISO/IEC 14496-12:2008.</p>
<h5 id="a2-16-2">2.16.2. Movie Fragment Random Access Offset box</h5>

<p>Box type: ‘mfro’ </p>
<p>Container: Movie Fragment Random Access box (‘mfra’) </p>
<p>Mandatory: Yes </p>
<p>Quantity: One</p>
<p>Movie片段随机访问偏移量（mfro）框提供Movie片段随机访问（mfra）框的长度字段的副本，并帮助查找mfra框。mfro箱应最后放置在mfra箱中。</p>
<p>mfro box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;mfro&#x27;</span> (<span class="number">0x6d66726f</span>)</span><br><span class="line">Version         UI8                 Either <span class="number">0</span> or <span class="number">1</span></span><br><span class="line">Flags           UI24                Reserved, set to <span class="number">0</span></span><br><span class="line">Size            UI32                封闭movie片段随机访问框的大小（字节）</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.8.11 of ISO/IEC 14496-12:2008.</p>
<h3 id="a3">3. F4V Metadata</h3>

<p>本节介绍f4v文件格式支持的元数据。</p>
<h4 id="a3-1">3.1. Tag box</h4>

<p>Box type:  ‘auth’, ‘titl’, ‘dscp’ and ‘cprt’  </p>
<p>Container: Movie box (‘moov’) </p>
<p>Mandatory: No </p>
<p>Quantity: Zero or one of each type.</p>
<p>f4v文件格式支持包含在电影（moov）框中的四个可选标记框。一个f4v文件最多可以包含256个标记（包括这些框中的标记和在ILST框中定义的标记）。</p>
<p>Tag box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType应为以下类型之一：</span><br><span class="line">                                    作者的“auth”（<span class="number">0x61757468</span>）</span><br><span class="line">                                    “titl”（<span class="number">0x7469746C</span>）表示标题</span><br><span class="line">                                    “dscp”（<span class="number">0x64736370</span>）用于说明“cprt”（<span class="number">0x63707274</span>）用于版权</span><br><span class="line">Version         UI8                 Shall be <span class="number">0</span></span><br><span class="line">Flags           UI24                Reserved, set to <span class="number">0</span></span><br><span class="line">Pad             UI1                 Padding, set to <span class="number">0</span></span><br><span class="line">Language        UI5 [<span class="number">3</span>]             指定语言的三字符代码（见ISO <span class="number">639</span>-<span class="number">2</span>/T）。每个字符被解释为<span class="number">0x60</span>+（<span class="number">5</span>位）代码，以生成一个ASCII字符。</span><br><span class="line">TagString       UI8 [ ]             标记字符串数据，占用框的其余部分。标记字符串长度不得超过<span class="number">65535</span>字节。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="a3-2">3.2. XMP Metadata box</h4>

<p>Box type: ‘uuid’ </p>
<p>Container: File </p>
<p>Mandatory: No </p>
<p>Quantity: One</p>
<p>从第10版开始，Flash播放器可以加载嵌入到F4V文件中的XMP数据。XMP是Adobe的可扩展元数据平台。有关详细信息，请参阅<a target="_blank" rel="noopener" href="http://www.adobe.com/go/xmp%E3%80%82">www.adobe.com/go/xmp。</a></p>
<p>XMP元数据框应立即跟随电影（MOOV）框，无中间框。xmp元数据框的大小不得超过64兆字节。</p>
<p>通过XMP元数据框，该文件可以通过actionscript将XMP元数据与SWF电影通信。xmpmetadata通过名为dat a的字符串属性向actionscript公开。</p>
<p>XMP Metadata box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = ‘uuid’ (<span class="number">0x75756964</span>)</span><br><span class="line">UUID            UI8 [<span class="number">16</span>]            <span class="number">16</span>字节（<span class="number">128</span>位）通用唯一标识符（UUID）。</span><br><span class="line">                                    uuid应为十六进制字节，即<span class="number">7</span>a cf cb <span class="number">97</span> a9 <span class="number">42</span> e8 <span class="number">9</span>c <span class="number">71</span> <span class="number">99</span> <span class="number">94</span> <span class="number">91</span> e3 af ac。</span><br><span class="line">XMPMetadata     UI8 [ ]             XMP元数据，按照XMP元数据标准格式化</span><br></pre></td></tr></table></figure>

<h4 id="a3-3">3.3.  ilst box</h4>

<p>Box type: ‘ilst’ </p>
<p>Container: Meta box (‘meta’) </p>
<p>Mandatory: No </p>
<p>Quantity: One</p>
<p>ILST框出现在元（meta）框中，包含任意数量的元数据标记。f4v文件最多可包含256个标记（包括此框和“auth”、“titl”、“dscp”和“cprt”框中的标记）</p>
<p>ilst box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;ilst&#x27;</span> (<span class="number">0x696C7374</span>)</span><br><span class="line">TagCount        UI32                在ILST框中枚举的标记数</span><br><span class="line">Tags            TAGRECORD </span><br><span class="line">                [TagCount]          多个标记记录条目 </span><br><span class="line">每个标记记录都有以下布局：TAGRECORD</span><br><span class="line">TagLength       UI32                标记记录的总长度，包括此长度字段</span><br><span class="line">TagName         UI8 [<span class="number">4</span>]             <span class="number">4</span>个字节，指示标记的名称。这些字节通常来自人类可读的ASCII集，但不总是</span><br><span class="line">DataLength      UI32                标记记录的数据部分的总长度</span><br><span class="line">DataTag         UI8 [<span class="number">4</span>]             <span class="number">4</span>个字节<span class="string">&#x27;d&#x27;</span>、<span class="string">&#x27;a&#x27;</span>、<span class="string">&#x27;t&#x27;</span>和<span class="string">&#x27;a&#x27;</span>表示标记记录的数据部分</span><br><span class="line">DataType        UI32                指定标记记录的数据负载中的数据类型</span><br><span class="line">Reserved        UI32                Reserved, set to <span class="number">0</span></span><br><span class="line">Payload         UI8 [ ]             占用标记记录其余部分的任意字节数。精确的有效负载格式取决于数据类型</span><br><span class="line">                                    数据类型支持的值为：</span><br><span class="line">                                    -<span class="number">0</span>:自定义数据。在<span class="string">&#x27;trkn&#x27;</span>和<span class="string">&#x27;disk&#x27;</span>标记类型的情况下，数据有效负载被解释为单个ui32</span><br><span class="line">                                    - <span class="number">1</span>：文本数据</span><br><span class="line">                                    -<span class="number">13</span>，<span class="number">14</span>：二进制数据</span><br><span class="line">                                    -<span class="number">21</span>：通用数据</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="a3-4">3.4. Text Track Metadata</h4>

<p>Box type:  See below </p>
<p>Container: Text samples (‘text’ or ‘tx3g’) in Media Data box (‘mdat’) </p>
<p>Mandatory: No </p>
<p>Quantity: Any</p>
<p>文本示例（“text”或“tx3g”）可以包含以下元数据框。它们的内容通过ontextdata属性暴露给正在运行的actionscript程序。</p>
<h5 id="a3-4-1">3.4.1. Style box</h5>

<p>样式（Styl）框包含文本样式规范。此信息通过st yl e属性公开给actionscript。</p>
<p>styl box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;styl&#x27;</span> (<span class="number">0x7374796C</span>)</span><br><span class="line">Count           UI16                样式数组中的条目数</span><br><span class="line">Styles          STYLERECORD</span><br><span class="line">                [Count]             一组样式记录结构，每个结构都作为ActionScript对象</span><br><span class="line">单个样式记录具有以下布局：STYLERECORD</span><br><span class="line">StartChar       UI16                此样式记录应用到的第一个字符，通过名为startchar的双属性向actionscript公开</span><br><span class="line">EndChar         UI16                此样式记录应用到的最后一个字符，通过名为endchar的双属性向actionscript公开</span><br><span class="line">FontID          UI16                用于此样式的字体ID，通过名为fontid的双属性公开给actionscript</span><br><span class="line">                                    FaceStyleFlags UI8通过名为facestyleflags的双属性用于ActionScript</span><br><span class="line">FontSize        UI8                 用于字体的大小，通过属性fontsize用于actionscript</span><br><span class="line">TextColor       UI32                文本的rgba颜色，通过属性textcolor公开给actionscript</span><br></pre></td></tr></table></figure>

<h5 id="a3-4-2">3.4.2. Highlight box</h5>

<p>突出显示（HLIT）框指定要突出显示的文本范围。此信息通过highlight属性公开给actionscript。</p>
<p>hlit box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	             Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;hlit&#x27;</span> (<span class="number">0x686C6974</span>)</span><br><span class="line">StartChar       UI16                要突出显示的第一个字符，通过名为startchar的双属性向actionscript公开</span><br><span class="line">EndChar         UI16                要突出显示的最后一个字符，通过名为endchar的双属性向actionscript公开。</span><br></pre></td></tr></table></figure>

<h5 id="a3-4-3">3.4.3. Highlight Color box</h5>

<p>突出显示颜色（HCLR）框指定文本的突出显示颜色。此信息通过hi ghl i ght col或属性公开给actionscript。</p>
<p>hclr box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;hclr&#x27;</span> (<span class="number">0x68636C72</span>)</span><br><span class="line">HighlightColor  UI16 [<span class="number">3</span>]            通过名为hi-ghlightcolor的双属性向actionscript公开的三元素数组，它按顺序保存红色、绿色和蓝色组件的值。</span><br></pre></td></tr></table></figure>

<h5 id="a3-4-4">3.4.4. Karaoke box</h5>

<p>Karaoke（krok）框指定Karaoke元数据。此信息通过karaoke属性公开给actionscript。时间以轨道定义的时间刻度单位表示。</p>
<p>krok box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;krok&#x27;</span> (<span class="number">0x6B726F6B</span>)</span><br><span class="line">StartTime       UI32                通过名为StartTime的双属性向ActionScript公开</span><br><span class="line">Count           UI16                KaraokeRecords数组中的条目数</span><br><span class="line">KaraokeRecords  KARAOKEREC [Count]  karaokerec结构的数组，每个结构都作为对象暴露在actionscript中</span><br><span class="line"></span><br><span class="line">An individual KARAOKEREC has the following structure: KARAOKEREC</span><br><span class="line">EndTime         UI32                通过名为endtime的双属性向ActionScript公开</span><br><span class="line">StartChar       UI16                通过名为startchar的双属性向ActionScript公开</span><br><span class="line">EndChar         UI16                通过名为endchar的双属性向ActionScript公开</span><br></pre></td></tr></table></figure>

<h5 id="a3-4-5">3.4.5. Scroll Delay box</h5>

<p>滚动延迟（dlay）框指定滚动延迟。此信息通过scr ol l del ay属性向actionscript公开，该属性以与跟踪相关的时间刻度单位表示。</p>
<p>dlay box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	             Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;dlay&#x27;</span> (<span class="number">0x646C6179</span>)</span><br><span class="line">ScrollDelay     UI32                通过名为ScrollDelay的双属性向ActionScript公开</span><br></pre></td></tr></table></figure>

<h5 id="a3-4-6">3.4.6. Drop Shadow Offset box</h5>

<p>放置阴影（DRPO）框指定文本的放置阴影偏移坐标。</p>
<p>drpo box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	                Type	            Comment</span><br><span class="line">Header                  BOXHEADER           BoxType = <span class="string">&#x27;drpo&#x27;</span> (<span class="number">0x6472706F</span>)</span><br><span class="line">DropShadowOffsetX       UI16                通过名为DropshadowOffsetx的双属性向ActionScript公开</span><br><span class="line">DropShadowOffsetY       UI16                通过名为DropshadowOffsty的双属性向ActionScript公开</span><br></pre></td></tr></table></figure>

<h5 id="a3-4-7">3.4.7. Drop Shadow Alpha box</h5>

<p>放置阴影alpha（drpt）框指定放置阴影alpha值。</p>
<p>drpt box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;drpt&#x27;</span> (<span class="number">0x64727074</span>)</span><br><span class="line">DropShadowAlpha UI16                一个<span class="number">16</span>位alpha值，通过名为dr opshadowal pha的双属性公开给actionscript。</span><br></pre></td></tr></table></figure>


<p>For more information, see section 8.aaaaaaaaaaaaaaaaaaaaaaaaaaa of ISO/IEC 14496-12:2008.</p>
<h5 id="a3-4-8">3.4.8. Hypertext box</h5>

<p>超文本框（href）指定在文本范围内具有alt文本的超文本链接。此信息通过hyper t ext属性公开给actionscript。</p>
<p>href box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;href&#x27;</span> (<span class="number">0x68726566</span>)</span><br><span class="line">StartChar       UI16                文本范围的开始字符，通过名为startchar的双属性向actionscript公开。</span><br><span class="line">EndChar         UI16                文本范围的最后一个字符，通过名为endchar的双属性向actionscript公开</span><br><span class="line">URLSize         UI8                 The length <span class="keyword">of</span> the URL string</span><br><span class="line">URL             UI8 [URLSize]       通过名为url的字符串属性向actionscript公开的url字符串</span><br><span class="line">ALTSize         UI8                 The length <span class="keyword">of</span> the ALT string</span><br><span class="line">ALT             UI8 [ALTSize]       当用户鼠标悬停在链接上时显示的alt字符串，通过名为alt的字符串属性向actionscript公开。</span><br></pre></td></tr></table></figure>

<h5 id="a3-4-9">3.4.9. Text Box box</h5>

<p>文本框（tbox）框定义文本框的坐标。此信息通过t ex t box属性公开给actionscript。</p>
<p>tbox box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;tbox&#x27;</span> (<span class="number">0x74626F78</span>)</span><br><span class="line">Top             UI16                顶部像素坐标，通过名为top的双属性向actionscript公开</span><br><span class="line">Left            UI16                左像素坐标，通过名为Left的双属性向ActionScript公开</span><br><span class="line">Bottom          UI16    </span><br><span class="line">Right           UI16</span><br></pre></td></tr></table></figure>

<h5 id="a3-4-10">3.4.10. Blinking box</h5>

<p>Blinking（BLNK）框指定要设置闪烁的文本范围。此信息通过blink属性公开给actionscript。</p>
<p>blnk box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;blnk&#x27;</span> (<span class="number">0x626C6E6B</span>)</span><br><span class="line">StartChar       UI16                闪烁范围中的第一个字符，通过名为startchar的双属性向actionscript公开</span><br><span class="line">EndChar         UI16                闪烁范围中的结束字符，通过名为endchar的双属性向actionscript公开</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="a3-4-11">3.4.11. Text Wrap box</h5>

<p>文本换行（twrp）框为文本设置换行标志。</p>
<p>twrp box</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	            Comment</span><br><span class="line">Header          BOXHEADER           BoxType = <span class="string">&#x27;twrp&#x27;</span> (<span class="number">0x74777270</span>)</span><br><span class="line">WrapFlag        UI8                 如果文本应该换行，则为非零的布尔值，通过名为wrapflag的双属性向actionscript公开。</span><br></pre></td></tr></table></figure>

<h3 id="a4">附件A.嵌入提示点</h3>
<h4 id="a4-1">A.1.Overview</h4>

<p>使用Flash构建媒体应用程序的一个关键好处是能够混合媒体播放和丰富的交互式数据。f4v应用程序可以支持以amf样本的形式嵌入时间数据（提示点）。这些示例与音频和视频示例一起传输到Flash运行时，在那里它们被发送到应用程序脚本。</p>
<h4 id="a4-2">A.2.AMF样本格式</h4>

<p>AMF示例是包含类型化AMF值列表的AMF对象。</p>
<p>根据为数据轨指定的类型，AMF对象应为AMF0对象或AMF3对象。amf0和amf3的规范可以在以下网址找到：<a target="_blank" rel="noopener" href="http://opensource.adobe.com/wiki/display/blazeds/developer+documentation">http://opensource.adobe.com/wiki/display/blazeds/developer+documentation</a></p>
<p>第一个值应为表示AMF样本名称的字符串。AMF值将被调度到具有此名称的方法。例如，如果第一个字段是名为“onfoo”的字符串，则在播放AMF示例时调用方法“onfoo”。</p>
<p>表3列出了为运行时保留且未调度到脚本的名称：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Table <span class="number">3.</span> Reserved names</span><br><span class="line"></span><br><span class="line">attachAudio	    attachVideo	    call	close	getBufferInfo</span><br><span class="line">onStatus	    pause	        play	play2	publish</span><br><span class="line">receiveAudio	receiveVideo	seek	send	setBufferTime</span><br></pre></td></tr></table></figure>

<h4 id="a4-3">A.3.AMF数据跟踪结构</h4>

<p>AMF样本可以存储在数据跟踪中。数据轨配置如下：</p>
<p>处理程序参考（HDLR）框中的处理程序类型应为“数据”，媒体头框类型应为“NMHD”。</p>
<p>样品描述（STSD）框应包含一份描述AMF样品的描述记录。</p>
<p>说明条目格式应为sampleEntry类型。</p>
<p>说明条目的框类型应为“amf0”或“amf3”，与样本的“amf”格式相对应。以下数据轨框应包含每个AMF样本的条目：</p>
<p>-解码时间采样（STTS）框，用于AMF样本的解码时间。</p>
<p>-样本大小（STSZ）框，用于AMF样本的大小。</p>
<p>-chunk offset（STCO或CO64）框，用于AMF样本的偏移。</p>
<p>-合成时间采样（CTTS）框，用于将AMF样本传递到ActionScript的时间</p>
<p>程序。</p>
<p>在媒体数据（mdat）框中，数据轨中的样本应与音频和视频样本交错。</p>
<h5 id="a4-3-1">A.3.1.解码数据轨</h5>

<p>播放一个f4v文件时，mdat框中的amf示例将传递给amf解码器。在STTS框中指定的时间，AMF解码器对样本进行解码。</p>
<p>在CTTS框中指定的时间，AMF解码器将解码后的AMF样本传递给actionscript程序。</p>
<h4 id="a4-4">A.4.渐进式下载</h4>

<p>通过适当的交织，该方法适用于渐进式下载。</p>
<p>AMF内容应与音频和视频内容在正确的时间交错，以确保在下载文件时数据在正确的时间可用。</p>
<p>AMF数据不应存储在文件的末尾，因为在这种情况下，在发送第一个AMF样本之前，必须下载整个文件，即使该样本在内容的时间非常早。</p>
<h4 id="a4-5">A.5.多个数据轨</h4>

<p>只有一个数据轨。</p>
<h3 id="a5">附件B.Flash播放器元数据</h3>
<h4 id="a5-1">B.1.流属性</h4>

<p>当flash player加载一个f4v文件时，可以通过net st r eam为正在运行的actionscript程序提供各种流属性。Onmet Adat a Property公司。可用属性因用于创建文件的软件而异。典型特性为：</p>
<p>-audi ocodeci d：一个包含四个字符的字符串，定义使用的音频编解码器（如果存在音频并且</p>
<p>使用Flash播放器可以解码的编解码器编码</p>
<p>-avcl-level：表示视频符合的avc级别的双精度符号，如果存在视频并对其进行编码。</p>
<p>采用AVC／H.264</p>
<p>-ile的avcpr：一个双精度符号，表示视频符合的avc配置文件（如果存在视频且</p>
<p>用AVC/H.264编码</p>
<p>-打开时的持续时间：以秒为单位表示电影总长度的两倍</p>
<p>-高度：表示视频高度的双精度符号，如果视频存在并使用编解码器编码</p>
<p>Flash播放器可以解码</p>
<p>-moovposition：一个双精度符号，表示f4v文件中moov框的绝对偏移量。此属性</p>
<p>用于确定文件是否将逐步加载</p>
<p>-videocodecid：一个包含四个字符的字符串，定义所使用的视频编解码器（如果存在视频且</p>
<p>使用Flash播放器可以解码的编解码器编码</p>
<p>-如果存在视频，则显示视频的平均视频帧速率。</p>
<p>使用Flash播放器可以解码的编解码器编码</p>
<p>-width：一个双精度符号，表示视频的宽度，如果视频存在，并用闪烁的编解码器编码。</p>
<p>玩家可以解码</p>
<h4 id="a5-2">B.2.影像元数据</h4>

<p>如果f4v示例是图像类型（gif、png或jpeg），则通过oni magedat a属性将数据提供给正在运行的actionscript程序。存在以下属性：</p>
<p>-数据：包含压缩图像数据（即原始jpeg、png或gif文件数据）的字节数组。</p>
<p>-trackID：指示此示例所属的轨道的双精度符号。</p>
<h3 id="a6">附件C.HTTP流：文件结构</h3>
<h4 id="a6-1">C.1.概述</h4>

<p>Flash播放器支持带有F4V片段的HTTP流。HTTP流表示由HTTP流清单文件（F4M）和HTTP流段（分段的F4V文件或F4F）组成。</p>
<p>表示沿时间线划分为HTTP流段，进一步划分为HTTP流段。演示文稿可以在多个质量级别上并行提供。可以通过片段（完全或部分）和质量级别缓存和交付演示文稿。</p>
<p>演示文稿的引导信息框指定演示文稿的数据结构和对其的访问。清单文件（fdm）在<a target="_blank" rel="noopener" href="http://opensource.adobe.com/wiki/display/osmf/flash+media+manifest+file+format+specification%E4%B8%AD%E6%9C%89%E8%BF%9B%E4%B8%80%E6%AD%A5%E7%9A%84%E6%8F%8F%E8%BF%B0%E3%80%82">http://opensource.adobe.com/wiki/display/osmf/flash+media+manifest+file+format+specification中有进一步的描述。</a></p>
<h4 id="a6-2">C.2.HTTP流段</h4>

<p>HTTP流段是包含片段的完整F4V文件。该段只能属于一个质量级别。该段应包括一组方框，后跟一组HTTP流片段。</p>
<p>成套盒子应包括以下盒子，最好按此顺序排列（可选盒子用括号[]表示）：</p>
<ul>
<li><p>   ftyp</p>
</li>
<li><p>   [afra]</p>
</li>
<li><p>   [abst]</p>
</li>
<li><p>   moov</p>
</li>
<li><p>   rtmp</p>
</li>
<li><p>   [mdat]</p>
</li>
</ul>
<p>一套盒子可能包括AFRA和MDAT盒子。如果包含，AFRA盒应位于MDAT盒和ABT盒之前。</p>
<p>HTTP流段中HTTP流段外部的MOOF盒不得用于HTTP流。</p>
<h4 id="a6-3">C.2.HTTP流片段</h4>

<p>HTTP流片段应包括以下每个框中的一个，最好按此顺序：</p>
<ul>
<li><p>   afra</p>
</li>
<li><p>   abst</p>
</li>
<li><p>   moof</p>
</li>
<li><p>   mdat</p>
</li>
</ul>
<p>AFRA箱应位于所有其他箱之前。</p>
<p>片段不是完整的f4v文件。HTTP流片段中不允许使用框ftyp、pdin和moov。</p>
<h4 id="a6-4">C.4.URL构造</h4>

<p>每个HTTP流段都是一个单独的URL资源（文件）。URL方案可以唯一地寻址每个HTTP流片段。HTTP流片段的URL构造如下：</p>
<p><a target="_blank" rel="noopener" href="http://serverbaseurl&gt;/">http://serverbaseurl&gt;/</a>&lt;*movieidentifier&gt;&lt;*qualityssegmenturlmodifier&gt;seg&lt;*segment number&gt;-frag&lt;*fragmentnumber&gt;</p>
<p>其中，f4v规范定义了括号中的字段，数字没有前导零。如果serverEntryCount==0，&lt;*serverBaseURL&gt;和尾随斜杠应省略。</p>
<p>如果QualityEntryCount==0，&lt;*QualitySegmenturModifier&gt;应省略。</p>
<p>示例：<a target="_blank" rel="noopener" href="http://adobe.com/mymovie/highseg1-frag210">http://adobe。com/mymovie/highseg1-frag210</a></p>
<h4 id="a6-5">C.5.Adobe多路提示跟踪格式</h4>

<p>用于HTTP流的F4V文件需要包含提示跟踪。提示跟踪提供了使流服务器能够创建传输数据包的信息。有关流的信息，请参阅ISO规范第7节。</p>
<p>Adobe支持Adobe多路提示跟踪格式。Adobe多路复用提示跟踪格式足够灵活，可以支持RTMP数据包以及类似FLV的格式，其中样本作为一个整体按时间顺序交错。FLV兼容模式是为提示样本和FLV格式之间的有效映射而定义的。可以对格式进行配置，以确保由一系列提示样本组成的mdat与对应于这些样本的flv的一部分相同。</p>
<p>Adobemux提示示例输入框（rtmp）描述了提示轨迹。提示轨包含一个AdobEmuxhintsamples集合，并位于媒体数据框中。</p>
<p>定义了三种提示模式：</p>
<p>-立即模式（模式=0）</p>
<p>在这种模式下，为了提高效率，多路复用轨道的有效载荷直接在提示样本本身中可用。但是，必须小心使用此模式，因为它可能会导致某些数据重复。</p>
<p>-立即节点提升模式（模式=1）</p>
<p>立即节点提升模式的定义是为了避免立即模式下的数据复制。在此配置中，原始（音频/视频）曲目的采样表中的偏移量被调整为物理指向包含媒体数据的（立即模式）提示样本（本地位于mdat位置）。因为块偏移量被更改为指向每个样本的提示样本（在头之后和样本开始的位置），所以所有块只包含一个样本。</p>
<p>因此，媒体框“mdat”只包含提示示例（没有音频或视频示例）。提示示例将在其即时数据字段中嵌入媒体数据。只有在Adobe多路复用数据包中使用完整样本（而不是在分块RTMP模式下）时，这才是可能的。此外，这也会增加区块偏移表的副作用，但与获得的效率相比，这是最小的。</p>
<p>-采样模式（模式=2）</p>
<p>在这种模式下，包头和尾部被定义为提示样本的一部分。多路复用磁道的有效负载通过引用具有长度和偏移量的媒体磁道中的特定样本从提示样本“指向”媒体磁道。</p>
<h3 id="a7">附录D.F4V加密D.1概述</h3>
<h4 id="a7-1">D.1.加密过程</h4>

<p>本节概述了如何使用Adobe的DRM密钥/权限管理系统来保护F4V内的媒体。保护仅适用于F4V的音频/视频曲目。其他曲目类型（如AMF曲目）的加密格式不在本规范的范围内。</p>
<p>本节应与ISO 14496-12:2008第8.12节（对受保护流的支持）一起阅读。在阅读下一节之前，读者必须理解上述文件格式。</p>
<h4 id="a7-2">D.2.加密过程</h4>

<p>加密过程将样本格式从纯文本更改为密码文本。在每个示例数据之前插入一个Adobe DRM访问单元头。由于将纯文本转换为密码文本，因此如果不使用适当的密钥，则无法使用应用程序访问基础媒体。</p>
<p>将转换描述加密样本的样本描述表中的样本描述条目。转换结构遵循ISO 14496-12:2008第8.12节。转换示例描述条目的目的是双重的：示例描述条目防止意外处理加密数据，就像它是未加密的一样，并记录应用的转换。</p>
<p>执行以下示例描述转换：</p>
<p>-样本描述条目的4cc替换为4cc，表示加密：</p>
<p>o“encv”表示加密视频流（而不是“mp4v”、“avc1”），o“enca”表示加密音频流（而不是“mp4a”、“samr”），o“encr”表示加密数据流。</p>
<p>-保护方案信息（sinf）框附加到示例描述条目后，保留所有其他框。</p>
<p>未修改的sinf框包含理解应用的加密转换及其参数以及查找其他信息（如密钥管理系统的类型和位置）所需的所有信息。它还记录了媒体的原始（未加密）格式。</p>
<p>-样本描述条目的原始格式4cc存储在原始格式（frma）框中，即</p>
<p>sinf框的子框。</p>
<p>-方案类型（schm）框也是sinf框的子框，并将加密方案指定为4cc和</p>
<p>它的版本。在f4v文件中，该方案4cc应为“adkm”，即Adobe的DRM密钥管理。</p>
<p>-在sinf框中，有一个“黑框”（方案信息（schi）框）空间，用于描述</p>
<p>控制对加密媒体内容的访问的密钥管理。schi框是一个容器框，仅由正在使用的方案解释。在F4V文件中，此框应为Adobe DRM密钥管理系统框。</p>
<p>图1–在f4v中存储保护信息的示例</p>
<p>图1说明了保护信息如何存储在F4V中。在示例中，将保护方案信息（sinf）框放入每个曲目的示例描述条目中，并将Adobe的DRM标识符指定为密钥/权限管理系统，以保护音频和视频曲目。</p>
<p>sinf框是每个示例描述框中的示例条目。虽然在一个样本描述框中可以有多个样本条目（每个曲目只能有一个样本描述框），但这并不常见。因此，上面的图表只显示每个轨道一个sinf框。但是，由于每个磁道可能有多个磁道，因此DRM Packager和DRM解码器都应该能够处理这种情况。</p>
<h4 id="a7-3">D.3.样本加密</h4>

<p>本节介绍在将DRM应用于F4V中的音频或视频轨时如何转换每个样本。</p>
<h5 id="a7-3-1">D.3.1.接入单元头</h5>

<p>表4中定义的访问单元头指定了由Adobe的DRM保护的每个样本单元的格式。媒体文件格式将媒体数据的布局指定为示例，但加密/解密过程需要在每个示例中包含其他信息。附加信息取决于所使用的DRM密钥管理。Adobe的DRM指定了自己的访问单元报头，该报头应位于每个编解码器特定的示例数据之前。f4v访问单元头与flv选择性加密过滤器参数相同。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Table <span class="number">4.</span> Access Unit Header</span><br><span class="line">Access Unit Header</span><br><span class="line">Field                 Type              Comment</span><br><span class="line">EncryptedAU	          UI1               选择性加密指示器显示数据包是否加密。</span><br><span class="line">                                            <span class="number">0</span>=样本未加密</span><br><span class="line">                                            <span class="number">1</span>=样本已加密。     </span><br><span class="line">Reserved              UI7               Shall be <span class="number">0</span></span><br><span class="line">IV              IF EncryptedAU == <span class="number">1</span></span><br><span class="line">                    UI8 [IVLength]      仅在样本加密时存在。包含<span class="number">16</span>字节的AES-CBC IV数据</span><br></pre></td></tr></table></figure>


<p>上述指定的访问单元头应添加到样本描述条目打开DRM（即存在保护方案信息（sinf）框）的每个样本中，即使特定样本未加密。报头是解码器知道特定样本是否加密的唯一方法（在selectiveencryption为1的情况下）。当只加密关键帧时，样本的选择性加密可以提高性能。</p>
<h5 id="a7-3-2">D.3.2.加密样本的填充</h5>

<p>所有加密样本应填充到块密码块长度的倍数。填料方案应如RFC 2630中所述，复制如下：</p>
<p>块密码期望输入数据是k个八位字节的倍数（对于aes 128，要求输入数据是16个八位字节的倍数），其中k大于1。对于此类算法，输入应在尾端填充k-（length mod k）八位字节，所有八位字节的值均为k-（length mod k），其中length是输入的长度。</p>
<p>因此，输入用下面的一个k字节序列填充在尾端，如表5所示。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Table <span class="number">5.</span> Padding the cipher block</span><br><span class="line"></span><br><span class="line">Condition                   Bytes added to the end <span class="keyword">of</span> the block</span><br><span class="line">IF length mod k=k-<span class="number">1</span>	                                    <span class="number">0</span>1</span><br><span class="line">IF length mod k=k-<span class="number">2</span>	                                <span class="number">0</span>2	<span class="number">0</span>2</span><br><span class="line">...</span><br><span class="line">IF length mod k=n                           ...  k-n   k-n</span><br><span class="line">...</span><br><span class="line">IF length mod k=<span class="number">0</span>           k	k	…	k	k    k       k</span><br></pre></td></tr></table></figure>


<p>由于所有输入都被填充，包括已经是块大小的倍数的输入值，并且没有填充序列是另一个的后缀，因此可以从填充块明确地确定填充的大小。最后一个八位字节表示要修剪多少个八位字节。</p>
<h3 id="a8">附录E.FLV文件格式</h3>
<h4 id="a8-1">E.1.概述</h4>

<p>flv文件中的每个标记类型构成一个单独的流。在一个FLV文件中，同步在一起的音频和视频流不得超过一个。FLV文件不应定义单个类型的多个独立流。FLV中使用的简单数据类型在SWF格式规范中定义。flv文件使用一个没有为swf文件定义的附加类型：ui24表示无符号的24位整数。</p>
<p>与SWF文件不同，FLV文件应以大端字节顺序存储多字节数。例如，作为SWF文件格式中的ui16，表示数字300（0x12c）的字节序列为0x2c 0x01；作为FLV文件格式中的ui16，表示数字300的字节序列为0x01 0x2c。</p>
<p>另请参见SWF文件格式规范，网址为<a target="_blank" rel="noopener" href="http://www.adobe.com/go/swf_file_format%E3%80%82">http://www.adobe.com/go/swf_file_format。</a></p>
<h4 id="a8-2">E.2.FLV报头</h4>

<p>FLV文件应以FLV头开始：</p>
<p>FLV header</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Signature           UI8	Signature byte always <span class="string">&#x27;F&#x27;</span> (<span class="number">0x46</span>)</span><br><span class="line">Signature           UI8	Signature byte always <span class="string">&#x27;L&#x27;</span> (<span class="number">0x4C</span>)</span><br><span class="line">Signature           UI8	Signature byte always <span class="string">&#x27;V&#x27;</span> (<span class="number">0x56</span>)</span><br><span class="line">Version             UI8	File version (<span class="keyword">for</span> example, <span class="number">0x01</span> <span class="keyword">for</span> FLV version <span class="number">1</span>)</span><br><span class="line">TypeFlagsReserved   UB [<span class="number">5</span>]	Shall be <span class="number">0</span></span><br><span class="line">TypeFlagsAudio      UB [<span class="number">1</span>]	<span class="number">1</span> = Audio tags are present</span><br><span class="line">TypeFlagsReserved   UB [<span class="number">1</span>]	Shall be <span class="number">0</span></span><br><span class="line">TypeFlagsVideo      UB [<span class="number">1</span>]	<span class="number">1</span> = Video tags are present</span><br><span class="line">DataOffset          UI32	The length <span class="keyword">of</span> <span class="built_in">this</span> header <span class="keyword">in</span> bytes</span><br></pre></td></tr></table></figure>


<p>对于FLV版本1，dataoffset字段的值通常为9。此字段用于在将来的版本中容纳较大的标题。</p>
<h4 id="a8-3">E.3.FLV文件体</h4>

<p>在flv头段之后，flv文件的其余部分应包含交替的反向指针和标签。它们交错排列，如下表所示：</p>
<p>FLV File Body</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	            Type            Comment</span><br><span class="line">PreviousTagSize0    UI32            Always <span class="number">0</span></span><br><span class="line">Tag1                FLVTAG          First tag</span><br><span class="line">PreviousTagSize1    UI32            上一个标记（包括其标题）的大小（字节）。</span><br><span class="line">                                    对于FLV版本<span class="number">1</span>，该值为<span class="number">11</span>加上上上一个标记的数据大小。</span><br><span class="line">Tag2                FLVTAG          Second tag</span><br><span class="line">...</span><br><span class="line">PreviousTagSizeN-<span class="number">1</span>  UI32            第二个到最后一个标记（包括其标题）的大小（字节）。</span><br><span class="line">TagN                FLVTAG          Last tag</span><br><span class="line">PreviousTagSizeN    UI32            最后一个标记（包括其标题）的大小（字节）。</span><br></pre></td></tr></table></figure>

<h4 id="a8-4">E.4.FLV标签定义</h4>
<H5 id="a8-4-1">E.4.1FLV标签</H5>

<p>flv标记包含音频、视频或脚本的元数据、可选加密元数据和有效负载。FLVTAG</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field                       Type	        Comment</span><br><span class="line">Reserved                    UB [<span class="number">2</span>]          Reserved <span class="keyword">for</span> FMS, should be <span class="number">0</span></span><br><span class="line">Filter                      UB [<span class="number">1</span>]          指示是否筛选数据包。</span><br><span class="line">                                            <span class="number">0</span>=不需要预处理。</span><br><span class="line">                                            <span class="number">1</span>=在呈现数据包之前，需要对其进行预处理（如解密）。</span><br><span class="line">                                            未加密文件中应为<span class="number">0</span>，加密标签应为<span class="number">1</span>。过滤器的使用见附录F.FLV加密。</span><br><span class="line"></span><br><span class="line">TagType                     UB [<span class="number">5</span>]          此标记中的内容类型。定义了以下类型：</span><br><span class="line">                                            <span class="number">8</span>＝音频</span><br><span class="line">                                            <span class="number">9</span>＝视频</span><br><span class="line">                                            <span class="number">18</span>=脚本数据</span><br><span class="line"></span><br><span class="line">DataSize                    UI24            消息的长度。streamid到标记末尾后的字节数（等于标记的长度–<span class="number">11</span>）</span><br><span class="line">Timestamp                   UI24            应用此标记中数据的时间（毫秒）。该值与flv文件中的第一个标记相关，该标记的时间戳始终为<span class="number">0</span>。</span><br><span class="line">TimestampExtended           UI8             timestamp字段的扩展，以形成si32值。此字段表示高<span class="number">8</span>位，而前一个时间戳字段表示低<span class="number">24</span>位时间（毫秒）。</span><br><span class="line">StreamID                    UI24            Always <span class="number">0.</span></span><br><span class="line">AudioTagHeader          IF TagType == <span class="number">8</span>     第E<span class="number">.4</span><span class="number">.2</span><span class="number">.1</span>节中定义的audioTagHeader元素。</span><br><span class="line">                            AudioTagHeader</span><br><span class="line">VideoTagHeader          IF TagType == <span class="number">9</span>      第E<span class="number">.4</span><span class="number">.3</span><span class="number">.1</span>节中定义的VideoTagHeader元素。</span><br><span class="line">                            VideoTagHeader</span><br><span class="line">EncryptionHeader        IF Filter == <span class="number">1</span>      如第F<span class="number">.3</span><span class="number">.1</span>节所述，每个受保护样品应包括加密头。</span><br><span class="line">                        EncryptionTagHeader</span><br><span class="line">FilterParams            IF Filter == <span class="number">1</span>      根据第F<span class="number">.3</span><span class="number">.2</span>节的规定，每个受保护样品应包括过滤器参数。</span><br><span class="line">                            FilterParams</span><br><span class="line"></span><br><span class="line">Data                    IF TagType == <span class="number">8</span>     每种媒体类型的特定数据。</span><br><span class="line">                            AUDIODATA</span><br><span class="line">                        IF TagType == <span class="number">9</span></span><br><span class="line">                            VIDEODATA</span><br><span class="line">                        IF TagType == <span class="number">18</span></span><br><span class="line">                            SCRIPTDATA</span><br></pre></td></tr></table></figure>


<p>在回放中，flv标记的时间顺序仅取决于flv时间戳。应忽略有效载荷数据格式中内置的任何定时机制。<br><H5 id="a8-4-2">E.4.2音频标签</H5></p>
<p>音频标签类似于SWF文件格式中的definesound标签。对于SWF中也支持的格式，FLV和SWF中的有效载荷数据是相同的。<br><H5 id="a8-4-2-1">E.4.2.1音频数据</H5></p>
<p>audioTagHeader包含音频特定的元数据</p>
<p>AudioTagHeader</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field               Type            Comment</span><br><span class="line">SoundFormat         UB [<span class="number">4</span>]          声音数据的格式。定义了以下值：</span><br><span class="line">(见注释下表：为了特殊编码)              <span class="number">0</span>=线性PCM，平台端</span><br><span class="line">                                    <span class="number">1</span>＝ADPCM</span><br><span class="line">                                    <span class="number">2</span>＝MP3</span><br><span class="line">                                    <span class="number">3</span>=线性PCM，小端</span><br><span class="line">                                    <span class="number">4</span>=<span class="number">16</span> kHz单声道Nellymoser</span><br><span class="line">                                    <span class="number">5</span>=<span class="number">8</span> kHz单声道Nellymoser</span><br><span class="line">                                    <span class="number">6</span> = NelyMysor</span><br><span class="line">                                    <span class="number">7</span>=G<span class="number">.711</span> a-律对数pcm</span><br><span class="line">                                    <span class="number">8</span>=G<span class="number">.711</span>μm对数pcm</span><br><span class="line">                                    <span class="number">9</span> =保留</span><br><span class="line">                                    <span class="number">10</span>＝AAC</span><br><span class="line">                                    <span class="number">11</span> = SeEX</span><br><span class="line">                                    <span class="number">14</span>＝MP3 <span class="number">8</span> kHz</span><br><span class="line">                                    <span class="number">15</span>=设备特定声音</span><br><span class="line">                                    保留格式<span class="number">7</span>、<span class="number">8</span>、<span class="number">14</span>和<span class="number">15</span>。</span><br><span class="line">                                    Flash Player <span class="number">9</span>、<span class="number">0</span>115、<span class="number">0</span>及更高版本支持AAC。</span><br><span class="line">                                    Flash Player <span class="number">10</span>及更高版本支持speex。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SoundRate           UB [<span class="number">2</span>]          采样率。定义了以下值：</span><br><span class="line">                                    <span class="number">0</span>＝<span class="number">5.5</span>千赫</span><br><span class="line">                                    <span class="number">1</span>＝<span class="number">11</span>千赫</span><br><span class="line">                                    <span class="number">2</span>＝<span class="number">22</span>千赫</span><br><span class="line">                                    <span class="number">3</span>＝<span class="number">44</span>千赫</span><br><span class="line">SoundSize           UB [<span class="number">1</span>]          每个音频样本的大小。此参数仅适用于未压缩格式。压缩格式总是在内部解码为<span class="number">16</span>位。</span><br><span class="line">                                    <span class="number">0</span>=<span class="number">8</span>位样本</span><br><span class="line">                                    <span class="number">1</span>=<span class="number">16</span>位样本</span><br><span class="line">SoundType           UB [<span class="number">1</span>]          单声道或立体声</span><br><span class="line">                                    <span class="number">0</span> =单声道</span><br><span class="line">                                    <span class="number">1</span>=立体声</span><br><span class="line">AACPacketType       IF SoundFormat == <span class="number">10</span></span><br><span class="line">                    UI8             定义了以下值：</span><br><span class="line">                                    <span class="number">0</span>=AAC序列头</span><br><span class="line">                                    <span class="number">1</span> = AAC原材料</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>格式3，线性PCM，存储原始PCM样本。如果数据为8位，则样本为无符号字节。如果数据是16位的，那么样本将存储为有符号的小尾数。如果数据是立体声的，则左右样本是交错存储的：左-右-左-右-等等。</p>
<p>格式0 pcm与格式3 pcm相同，只是格式0按照文件创建平台的尾数顺序存储16位pcm样本。因此，不应使用格式0。</p>
<p>8 kHz和16 kHz是特殊情况，因为声速场不能代表8或16 kHz的采样率。当在SoundFormat中指定Nellymser 8 kHz或Nellymser 16 kHz时，Flash播放器将忽略SoundRate和SoundType字段。对于其他Nellymser采样率，请指定正常的Nellymser SoundFormat，并像往常一样使用SoundRate和SoundType字段。</p>
<p>如果SoundFormat指示AAC，则SoundType应为1（立体声），SoundRate应为3（44 kHz）。但是，这并不意味着FLV中的AAC音频总是立体声的，44 kHz的数据。相反，flash播放器忽略这些值并提取通道，采样率数据编码在AAC比特流中。</p>
<p>如果SoundFormat指示为speex，则音频以16kHz的频率进行单采样压缩，声音速率应为0，声音大小应为1，声音类型应为0。有关存储在swf文件中的speex功能和限制的信息，请参阅<a target="_blank" rel="noopener" href="http://www.adobe.com/go/swf_file_format%E4%B8%8A%E7%9A%84swf%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%A7%84%E8%8C%83%E3%80%82">http://www.adobe.com/go/swf_file_format上的swf文件格式规范。</a></p>
<p>音频数据段包含音频有效载荷。</p>
<p>AUDIODATA</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	         Comment</span><br><span class="line">IF Encrypted	                 详见附件F.FLV加密。</span><br><span class="line">    Body	    EncryptedBody	按照第F<span class="number">.3</span><span class="number">.3</span>节的规定加密的音频标签体。</span><br><span class="line">ELSE</span><br><span class="line">    Body        AudioTagBody</span><br></pre></td></tr></table></figure>


<p>AudioTagBody保存音频有效负载。</p>
<p>AudioTagBody</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	        Type	         Comment</span><br><span class="line">SoundData</span><br><span class="line">IF SoundFormat == <span class="number">10</span></span><br><span class="line">AACAUDIODATA</span><br><span class="line">ELSE</span><br><span class="line">Varies by format</span><br></pre></td></tr></table></figure>

<H5 id="a8-4-2-2">E.4.2.2 AACAUDIODATA</H5>

<p>Flash Player 9、0115、0及更高版本支持AAC格式。</p>
<p>AACAUDIODATA</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	    Type	                        Comment</span><br><span class="line">Data        IF AACPacketType == <span class="number">0</span>	        </span><br><span class="line">            udioSpecificConfig              AudioSpecificConfig在ISO中定义。</span><br><span class="line">            ELSE IF AACPacketType == <span class="number">1</span></span><br><span class="line">            Raw AAC frame data <span class="keyword">in</span> UI8 [ ]   <span class="number">14496</span>～<span class="number">3</span>。请注意，这与MP4/F4V文件中ESDS框的内容不同。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<H5 id="a8-4-3">E.4.3视频标签</H5>
视频标签类似于SWF文件格式的视频帧标签，其有效载荷数据相同。另请参见SWF文件格式规范，网址为http://www.adobe.com/go/swf_file_format。
<H5 id="a8-4-3-1">E.4.3.1视频数据</H5>

<p>VideoTagHeader包含特定于视频的元数据</p>
<p>VideoTagHeader</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	            Type	            Comment</span><br><span class="line">Frame Type          UB [<span class="number">4</span>]              视频帧的类型。定义了以下值：</span><br><span class="line">                                        <span class="number">1</span>=关键帧（对于AVC，可查找的帧）</span><br><span class="line">                                        <span class="number">2</span>=帧间（对于AVC，是不可查找的帧）</span><br><span class="line">                                        <span class="number">3</span>=一次性内框（仅H<span class="number">.263</span>）</span><br><span class="line">                                        <span class="number">4</span>=生成的密钥帧（仅供服务器使用）</span><br><span class="line">                                        <span class="number">5</span>=视频信息/命令帧</span><br><span class="line"></span><br><span class="line">CodecID             UB [<span class="number">4</span>]              编解码器标识符。定义了以下值：</span><br><span class="line">                                        <span class="number">2</span>=Sorenson H<span class="number">.263</span></span><br><span class="line">                                        <span class="number">3</span>=屏幕视频</span><br><span class="line">                                        <span class="number">4</span>＝ON2 VP6</span><br><span class="line">                                        <span class="number">5</span>=ON2 VP6，带阿尔法通道</span><br><span class="line">                                        <span class="number">6</span>=屏幕视频版本<span class="number">2</span></span><br><span class="line">                                        <span class="number">7</span> = AVC</span><br><span class="line"></span><br><span class="line">AVCPacketType       IF CodecID == <span class="number">7</span></span><br><span class="line">                        UI8             定义了以下值：</span><br><span class="line">                                        <span class="number">0</span>=AVC序列头段</span><br><span class="line">                                        <span class="number">1</span> = AVC NALU</span><br><span class="line">                                        <span class="number">2</span>=AVC序列结束（不需要或不支持低级NALU序列结束符</span><br><span class="line">CompositionTime     IF CodecID == <span class="number">7</span>         </span><br><span class="line">                        SI24            如果avcpacketype==<span class="number">1</span></span><br><span class="line">                                        合成时间偏移</span><br><span class="line">                                        否则</span><br><span class="line">                                        零有关组成时间的说明，</span><br><span class="line">                                        请参见ISO <span class="number">14496</span>-<span class="number">12</span>，<span class="number">8.15</span><span class="number">.3</span>。</span><br><span class="line">                                        flv文件中的偏移量始终以毫秒为单位。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>视频数据段包含视频元数据、可选加密元数据和视频有效负载。</p>
<p>VIDEODATA</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field	         Type	            Comment</span><br><span class="line">IF Encrypted	                    详见附件F.FLV加密。</span><br><span class="line">Body	        EncryptedBody	    视频标记体按照第F<span class="number">.3</span><span class="number">.3</span>节的规定加密。</span><br><span class="line">ELSE</span><br><span class="line">Body</span><br></pre></td></tr></table></figure>


<p>VideoTagBody</p>
<p>VideoTagBody包含视频帧有效负载。</p>
<p>VideoTagBody</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field               Type                                Comment</span><br><span class="line">VideoTagBody        IF FrameType == <span class="number">5</span>                  视频帧有效载荷或帧信息 </span><br><span class="line">                        UI8</span><br><span class="line">                    ELSE (</span><br><span class="line">                        IF CodecID == <span class="number">2</span></span><br><span class="line">                            H263VIDEOPACKET</span><br><span class="line">                        IF CodecID == <span class="number">3</span></span><br><span class="line">                            SCREENVIDEOPACKET</span><br><span class="line">                        IF CodecID == <span class="number">4</span></span><br><span class="line">                            VP6FLVVIDEOPACKET</span><br><span class="line">                        IF CodecID == <span class="number">5</span></span><br><span class="line">                            VP6FLVALPHAVIDEOPACKET</span><br><span class="line">                        IF CodecID == <span class="number">6</span></span><br><span class="line">                            SCREENV2VIDEOPACKET</span><br><span class="line">                        IF CodecID == <span class="number">7</span></span><br><span class="line">                            AVCVIDEOPACKET</span><br><span class="line">                    )                                  如果frametype==<span class="number">5</span>，而不是视频有效负载，则视频数据主体包含一个具有以下含义的ui8：</span><br><span class="line">                                                        <span class="number">0</span>=客户端查找视频帧序列的开始</span><br><span class="line">                                                        <span class="number">1</span>=客户端查找视频帧序列结束 </span><br><span class="line">除avcvideopacket以外的所有文件，请参阅SWF文件格式规范了解详细信息。</span><br></pre></td></tr></table></figure>

<H5 id="a8-4-3-2">E.4.3.2 AVCVIDEOPACKET</H5>

<p>AVC视频包携带AVC视频数据的有效载荷。</p>
<p>AVCVIDEOPACKET</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field       Type	                        Comment</span><br><span class="line">Data        IF AVCPacketType == <span class="number">0</span></span><br><span class="line">                AVCDecoderConfigurationRecord</span><br><span class="line">            IF AVCPacketType == <span class="number">1</span></span><br><span class="line">                One or more NALUs (Full frames are required)</span><br></pre></td></tr></table></figure>


<p>AVCDecoderConfigurationRecord的说明见ISO 14496-15，5.2.4.1。它包含的信息与存储在MP4/FLV文件中的AVCC框中的信息相同。<br><H5 id="a8-4-4">E.4.4数据标签</H5></p>
<p>数据标记封装了单个方法调用，通常在Flash播放器的Netstream对象上调用。数据标记由一个方法名和一组参数组成。<br><H5 id="a8-4-4-1">E.4.4.1脚本数据</H5></p>
<p>脚本数据段包含可选的加密元数据和脚本有效负载。</p>
<p>SCRIPTDATA</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field               Type	            Comment</span><br><span class="line">IF Encrypted	                        See Annex F. FLV Encryption <span class="keyword">for</span> details.</span><br><span class="line">Body	        EncryptedBody	        ScriptTagBody encrypted <span class="keyword">as</span> specified <span class="keyword">in</span> Section F<span class="number">.3</span><span class="number">.3</span>.</span><br><span class="line">ELSE</span><br><span class="line">Body            ScriptTagBody</span><br></pre></td></tr></table></figure>


<p>ScriptTagBody包含以操作消息格式（AMF）编码的脚本数据，该格式是用于序列化ActionScript对象图的压缩二进制格式。AMF0的规范可从以下网址获得：<a target="_blank" rel="noopener" href="http://opensource.adobe.com/wiki/display/blazeds/developer+documentation">http://opensource.adobe.com/wiki/display/blazeds/developer+documentation</a></p>
<p>ScriptTagBody</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field               Type                    Comment</span><br><span class="line">Name                SCRIPTDATAVALUE	        方法或对象名称。scriptDataValue.Type=<span class="number">2</span>（字符串）</span><br><span class="line">Value               SCRIPTDATAVALUE         AMF参数或对象属性。scriptDataValue.Type=<span class="number">8</span>（ECMA数组）</span><br></pre></td></tr></table></figure>

<H5 id="a8-4-4-2">E.4.4.2    SCRIPTDATAVALUE</H5>

<p>ScriptDataValue记录包含类型化的ActionScript值。</p>
<p>SCRIPTDATAVALUE</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field               Type        Comment</span><br><span class="line">Type                UI8         ScriptDataValue的类型。</span><br><span class="line">                                定义了以下类型：</span><br><span class="line">                                <span class="number">0</span>＝数</span><br><span class="line">                                <span class="number">1</span> =布尔</span><br><span class="line">                                <span class="number">2</span> =字符串</span><br><span class="line">                                <span class="number">3</span> =对象</span><br><span class="line">                                <span class="number">4</span>=movieclip（保留，不支持）</span><br><span class="line">                                <span class="number">5</span> =空</span><br><span class="line">                                <span class="number">6</span> =未定义</span><br><span class="line">                                <span class="number">7</span> =参考文献</span><br><span class="line">                                <span class="number">8</span>＝ECMA阵列</span><br><span class="line">                                <span class="number">9</span>=对象结束标记</span><br><span class="line">                                <span class="number">10</span>=严格数组</span><br><span class="line">                                <span class="number">11</span> =日期</span><br><span class="line">                                <span class="number">12</span>=长串</span><br><span class="line">ScriptDataValue</span><br><span class="line">                IF Type == <span class="number">0</span>     编写数据值脚本。</span><br><span class="line">                DOUBLE</span><br><span class="line">                IF Type == <span class="number">1</span>    布尔值为（scriptDataValue≠<span class="number">0</span>）。</span><br><span class="line">                UI8</span><br><span class="line">                IF Type == <span class="number">2</span></span><br><span class="line">                SCRIPTDATASTRING</span><br><span class="line">                IF Type == <span class="number">3</span></span><br><span class="line">                SCRIPTDATAOBJECT</span><br><span class="line">                IF Type == <span class="number">7</span></span><br><span class="line">                UI16</span><br><span class="line">                IF Type == <span class="number">8</span></span><br><span class="line">                SCRIPTDATAECMAARRAY</span><br><span class="line">                IF Type == <span class="number">10</span></span><br><span class="line">                SCRIPTDATASTRICTARRAY</span><br><span class="line">                IF Type == <span class="number">11</span></span><br><span class="line">                SCRIPTDATADATE</span><br><span class="line">                IF Type == <span class="number">12</span></span><br><span class="line">                SCRIPTDATALONGSTRING</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<H5 id="a8-4-4-3">E.4.4.3    SCRIPTDATADATE</H5>

<p>脚本数据日期记录存储日期和时间。</p>
<p>SCRIPTDATADATE</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field                   Type        Comment</span><br><span class="line">DateTime                DOUBLE      <span class="built_in">Number</span> <span class="keyword">of</span> milliseconds since Jan <span class="number">1</span>, <span class="number">1970</span> UTC.</span><br><span class="line">LocalDateTimeOffset     SI16        本地时间与UTC的时差（分钟）。对于位于英国格林威治以西的时区，该值为负数。英国格林威治以东的时区是正的。</span><br></pre></td></tr></table></figure>

<H5 id="a8-4-4-4">E.4.4.4    SCRIPTDATAECMAARRAY</H5>

<p>A SCRIPTDATAECMAARRAY记录存储一个ecma数组。ECMA数组是一个关联数组，当actionscript数组包含非顺序索引时应使用该数组。所有的索引，无论是序数还是其他，都是字符串而不是整数。为了进行序列化，此类型与匿名ActionScript对象非常相似。该列表包含大约ecmaarrayllength个项目。ScriptDataObjectEnd记录在项目列表之后。</p>
<p>SCRIPTDATAECMAARRAY</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field                   Type                            Comment</span><br><span class="line">ECMAArrayLength         UI32                            ECMA数组中的近似项数</span><br><span class="line">Variables               SCRIPTDATAOBJECTPROPERTY [ ]    变量名和值列表</span><br><span class="line">List Terminator         SCRIPTDATAOBJECTEND             列表终止符    </span><br></pre></td></tr></table></figure>

<H5 id="a8-4-4-5">E.4.4.5    SCRIPTDATALONGSTRING</H5>

<p>scriptDataString和scriptDataLongstring记录存储字符串</p>
<p>SCRIPTDATALONGSTRING</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field           Type	Comment</span><br><span class="line">StringLength    UI32	StringData length <span class="keyword">in</span> bytes</span><br><span class="line">StringData      STRING	<span class="built_in">String</span> data, <span class="keyword">with</span> no terminating NUL</span><br></pre></td></tr></table></figure>

<H5 id="a8-4-4-6">E.4.4.6    SCRIPTDATAOBJECT</H5>

<p>ScriptDataObject记录对匿名ActionScript对象的属性进行编码。ScriptDataObjectEnd记录跟随属性列表。</p>
<p>SCRIPTDATAOBJECT</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field               Type                            Comment</span><br><span class="line">ObjectProperties    SCRIPTDATAOBJECTPROPERTY [ ]	List <span class="keyword">of</span> object properties</span><br><span class="line">List Terminator     SCRIPTDATAOBJECTEND             List terminator</span><br></pre></td></tr></table></figure>

<H5 id="a8-4-4-7">E.4.4.7    SCRIPTDATAOBJECTEND</H5>

<p>scriptDataObjectEnd记录终止scriptDataObjectProperty记录的列表。ScriptDataObjectEnd记录是一个带零长度字符串和对象结束标记的ScriptDataObjectProperty记录。</p>
<p>SCRIPTDATAOBJECTEND</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field           Type        Comment</span><br><span class="line">ObjectEndMarker UI8 [<span class="number">3</span>]     Shall be <span class="number">0</span>, <span class="number">0</span>, <span class="number">9</span></span><br></pre></td></tr></table></figure>

<H5 id="a8-4-4-8">E.4.4.8    SCRIPTDATAOBJECTPROPERTY</H5>

<p>ScriptDataObjectProperty记录定义ActionScript对象的对象属性或关联数组的变量。</p>
<p>SCRIPTDATAOBJECTPROPERTY</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field           Type                    Comment</span><br><span class="line">PropertyName    SCRIPTDATASTRING        Name <span class="keyword">of</span> the object property or variable</span><br><span class="line">PropertyData    SCRIPTDATAVALUE         对象属性或变量的值和类型</span><br></pre></td></tr></table></figure>

<H5 id="a8-4-4-9">E.4.4.9    SCRIPTDATASTRICTARRAY</H5>

<p>脚本数据严格数组记录存储严格数组。严格数组只包含顺序索引，而不存储在记录中。指数可以是密集的或稀疏的。索引之间稀疏区域中未定义的条目应序列化为未定义。该列表应包含严格的数组长度值。列表后面没有终止记录。</p>
<p>SCRIPTDATASTRICTARRAY</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field               Type	            Comment</span><br><span class="line">StrictArrayLength   UI32                <span class="built_in">Number</span> <span class="keyword">of</span> items <span class="keyword">in</span> the array</span><br><span class="line">StrictArrayValue    SCRIPTDATAVALUE </span><br><span class="line">                [ StrictArrayLength ]   List <span class="keyword">of</span> typed values</span><br></pre></td></tr></table></figure>

<H5 id="a8-4-4-10">E.4.4.10    SCRIPTDATASTRING</H5>

<p>scriptDataString和scriptDataLongstring记录存储字符串。</p>
<p>脚本数据字符串记录可用于长度不超过65535个字符的字符串。</p>
<p>SCRIPTDATASTRING</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field           Type        Comment</span><br><span class="line">StringLength    UI16        StringData length <span class="keyword">in</span> bytes.</span><br><span class="line">StringData      STRING      <span class="built_in">String</span> data, up to <span class="number">65535</span> bytes, <span class="keyword">with</span> no terminating NUL</span><br></pre></td></tr></table></figure>

<h4 id="a8-5">E.5 onMetaData</h4>

<p>flv元数据对象应包含在名为onmet adat a的scriptdata标记中。运行中的actionscript程序可通过net st r eam使用各种属性。Onmet Adat a Property公司。可用属性因创建FLV文件的软件而异。典型特性包括：</p>
<p>onMetadata properties</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Property Name   Type        Comment</span><br><span class="line">audiocodecid    <span class="built_in">Number</span>	    文件中使用的音频编解码器ID（有关可用的SoundFormat值，请参阅E<span class="number">.4</span><span class="number">.2</span><span class="number">.1</span>）</span><br><span class="line">audiodatarate   <span class="built_in">Number</span>      音频比特率（千比特/秒）</span><br><span class="line">audiodelay      <span class="built_in">Number</span>      音频编解码器引入的延迟（秒）</span><br><span class="line">audiosamplerate <span class="built_in">Number</span>      重播音频流的频率</span><br><span class="line">audiosamplesize <span class="built_in">Number</span>      单个音频样本的分辨率</span><br><span class="line">canSeekToEnd    <span class="built_in">Boolean</span>     表示最后一个视频帧是关键帧</span><br><span class="line">creationdate    <span class="built_in">String</span>      创建日期和时间</span><br><span class="line">duration        <span class="built_in">Number</span>      文件的总持续时间（秒）</span><br><span class="line">filesize        <span class="built_in">Number</span>      文件的总大小（字节）</span><br><span class="line">framerate       <span class="built_in">Number</span>      每秒帧数</span><br><span class="line">height          <span class="built_in">Number</span>      视频的高度（像素）</span><br><span class="line">stereo          <span class="built_in">Boolean</span>     指示立体声音频</span><br><span class="line">videocodecid    <span class="built_in">Number</span>      文件中使用的视频编解码器ID（有关可用的编解码器ID值，请参阅E<span class="number">.4</span><span class="number">.3</span><span class="number">.1</span>）</span><br><span class="line">videodatarate   <span class="built_in">Number</span>      视频比特率（千比特/秒）</span><br><span class="line">width           <span class="built_in">Number</span>      视频的宽度（像素）</span><br></pre></td></tr></table></figure>

<h4 id="a8-6">E.6 flv中的xmp元数据</h4>

<p>xmp元数据对象应包含在名为onxmpdat a的scriptData标记中。标记应及时放置。</p>
<p>0。标签应该在所有时间0之后，在所有时间0之前，在所有时间0之前，音频或视频标签，但读者不应该要求这样的排序。</p>
<p>XMPMetadata object</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Property Name	Type	                Comment</span><br><span class="line">liveXML         <span class="built_in">String</span> or Long string	XMP元数据，根据XMP元数据规范格式化</span><br></pre></td></tr></table></figure>


<p>For further details, see <a target="_blank" rel="noopener" href="http://www.adobe.com/devnet/xmp/pdfs/XMPSpecificationPart3.pdf">www.adobe.com/devnet/xmp/pdfs/XMPSpecificationPart3.pdf</a></p>
<h3 id="a9">附件F.FLV加密</h3>
<h4 id="a9-1">F.1概述</h4>

<p>1.加密头，包含解密flv所需的加密元数据，如加密</p>
<p>算法、密钥长度和内容加密密钥检索协议标识符在任何加密内容之前，在FLV头之后立即存储为脚本数据。</p>
<p>2.内容携带标签加密。</p>
<p>a.为了提高效率，可以选择只加密标签的子集，例如I帧。</p>
<p>b.如果标签被加密，那么包中的过滤器标志被打开。筛选标志指示</p>
<p>解码前需要对数据包进行预处理。加密筛选器在数据包中指定。不合规的玩家将忽略设置了筛选标志的标签，因为他们实际上有一个新的标签类型。</p>
<p>c.大多数元数据（例如，无论是音频或视频帧、关键帧还是I帧、编解码器类型）都是</p>
<p>保持清晰，以便服务器和客户端播放器可以处理元数据而无需解密内容。</p>
<p>d.根据加密算法和加密要求对内容进行加密。</p>
<p>关键。加密数据存储在包中。</p>
<p>此规范定义了头元数据和加密数据包的格式。</p>
<h4 id="a9-2">F.2标题信息</h4>
<H5 id="a9-2-1">F.2.1 AdditionalHeader对象</H5>

<p>在加密的FLV文件中，应存在额外的头对象，并且应包括加密头对象。</p>
<p>AdditionalHeader对象应包含在名为Additional Header的scriptData标记中。（注意名称中的竖线（“”））对象应该出现在flv的开头，时间戳为0，紧跟在onmet adat的scriptdata标记之后。这使FLV解码器能够在遇到任何加密标签之前访问加密元数据。</p>
<p>AdditionalHeader object</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Property Name       Type                        Comment</span><br><span class="line">Encryption          Encryption Header object	Encryption Header</span><br></pre></td></tr></table></figure>

<H5 id="a9-2-2">F.2.2加密头对象</H5>

<p>encryption header对象包含解密flv所需的加密元数据。加密头对象</p>
<p>Encryption Header object</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Property Name       Type        Comment</span><br><span class="line">Version             <span class="built_in">Number</span>      加密头的版本。</span><br><span class="line">                                应为<span class="number">1</span>或<span class="number">2</span>，表示</span><br><span class="line">                                加密格式。</span><br><span class="line">                                <span class="number">1</span>=FMRMS v1.x产品。</span><br><span class="line">                                <span class="number">2</span>=闪存访问<span class="number">2.0</span>产品。</span><br><span class="line">                                使用任一版本保护的内容都存在，</span><br><span class="line">                                因此应用程序应能够同时使用两个版本的内容。</span><br><span class="line">Method              string      Encryption method. Shall be ‘Standard’</span><br><span class="line">Flags               <span class="built_in">Number</span>      Encryption flags. Shall be <span class="number">0.</span></span><br><span class="line">Params          Standard Encoding </span><br><span class="line">                Parameters object       加密方法“标准”的参数</span><br><span class="line">IF Version == <span class="number">1</span></span><br><span class="line">    SigFormat       <span class="built_in">String</span>      在本文档中，没有提供有关sigformat的信息。</span><br><span class="line">    Signature       Long string 本文件签名上未提供任何信息。</span><br></pre></td></tr></table></figure>

<H5 id="a9-2-3">F.2.3标准编码参数对象</H5>

<p>此结构包含特定于“标准”加密方法的参数。</p>
<p>Standard Encoding Parameters object</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Property Name           Type                Comment</span><br><span class="line">Version                 <span class="built_in">Number</span>              Version. Shall be <span class="number">1.</span></span><br><span class="line">EncryptionAlgorithm     <span class="built_in">String</span>              加密算法。应为“aes-cbc”，</span><br><span class="line">                                            其中规定所使用的加密为“aes-cbc”，</span><br><span class="line">                                            并根据RFC <span class="number">2630</span>填充。</span><br><span class="line"></span><br><span class="line">EncryptionParams        AES-CBC             加密算法“aes-cbc”的参数。</span><br><span class="line">                        Encryption </span><br><span class="line">                        Parameters object</span><br><span class="line"></span><br><span class="line">KeyInfo                 Key Information     获取解密密钥的信息</span><br><span class="line">                        object	</span><br></pre></td></tr></table></figure>

<H5 id="a9-2-4">F.2.4 AES-CBC加密参数对象</H5>

<p>这个结构包含特定于加密算法的参数，在本例中是aes-cbc_128。</p>
<p>AES-CBC Encryption Parameters object</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Property Name           Type                Comment</span><br><span class="line">KeyLength               <span class="built_in">Number</span>              加密算法的密钥长度（字节）。应为<span class="number">16</span>（即<span class="number">128</span>位）</span><br></pre></td></tr></table></figure>

<H5 id="a9-2-5">F.2.5关键信息对象</H5>

<p>密钥信息框包含用于检索用于解密示例的密钥的信息。这些框中包含的条目的详细信息以及DRM客户机用于检索密钥的机制不在本规范的范围内。</p>
<p>Key Information object</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Property Name            Type        Comment</span><br><span class="line">SubType                 <span class="built_in">String</span>          如果encryptionheader.version==<span class="number">1</span></span><br><span class="line">                                        aps<span class="string">&#x27;=（Adobe Policy Server）联机密钥协议协商协议</span></span><br><span class="line"><span class="string">                                        否则</span></span><br><span class="line"><span class="string">                                        FlashAccessv2&#x27;</span>=联机密钥检索协议</span><br><span class="line">Data                IF SubType == ‘APS’</span><br><span class="line">                    Adobe Policy Server object</span><br><span class="line">                    IF SubType == ’FlashAccessv2’</span><br><span class="line">                    FlashAccessv2 object    子类型“aps”不再由符合要求的应用程序生成，因此没有提供进一步的信息</span><br></pre></td></tr></table></figure>

<H5 id="a9-2-6">F.2.6 FlashAccessv2对象</H5>

<p>闪存访问服务器使用联机密钥检索协议提供解密密钥。</p>
<p>FlashAccessv2对象包含FlashAccessv2模块执行联机密钥检索所需的以下高级元素（这些元素的详细信息不在文档范围内）。</p>
<p>FlashAccessv2 object</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Property Name       Type            Comment</span><br><span class="line">Metadata            Long string     DRM客户机用于检索解密密钥的Base <span class="number">64</span>编码元数据。</span><br></pre></td></tr></table></figure>

<h4 id="a9-3">F.3内容加密</h4>

<p>本节介绍如何加密FLV标记。</p>
<p>在加密的FLV文件中，每个FLV标记都可以指示其加密状态：</p>
<p>-筛选器标志可能指示在呈现数据包之前需要对其进行预处理。</p>
<p>-在版本2中，当设置过滤器标志时，选择性加密指示器可能进一步指示</p>
<p>数据包已加密。</p>
<p>无论文件是完全加密还是部分加密，在版本2中（encryptionheader.version==2），每个音频和视频包都应该设置flvtag.filter位。对于未加密的脚本数据，不应设置过滤位，使播放器能够定位onmetadata信息。</p>
<p>一小部分指定的字节保持清晰，以便在不解密其余内容的情况下启用智能客户端处理。</p>
<h5 id="a9-3-1">F.3.1加密标记头</h5>

<p>如果在flv标签中设置了filter标志，则在呈现前应对包内容进行预处理。加密标记头指定要应用的筛选器。过滤器指定加密类型并指示是否应用加密。</p>
<p>EncryptionTagHeader</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field               Type            Comments</span><br><span class="line">NumFilters          UI8             <span class="built_in">Number</span> <span class="keyword">of</span> filters applied to the packet. Shall be <span class="number">1.</span></span><br><span class="line">FilterName          <span class="built_in">String</span>          筛选器的名称。</span><br><span class="line">                                    如果encryptionheader.version==<span class="number">1</span></span><br><span class="line">                                    <span class="string">&#x27;加密&#x27;</span></span><br><span class="line">                                    否则</span><br><span class="line">                                    “SE”</span><br><span class="line">                                    SE代表选择性加密。</span><br><span class="line">Length              UI24            Length <span class="keyword">of</span> FilterParams <span class="keyword">in</span> bytes</span><br></pre></td></tr></table></figure>

<h5 id="a9-3-2">F.3.2滤波器参数</h5>

<p>filterparams包含特定于解密方法的参数。</p>
<p>FilterParams</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field               Type                                Comments</span><br><span class="line">FilterParams        IF FilterName = ‘Encryption’        特定于筛选器的参数。</span><br><span class="line">                        EncryptionFilterParams</span><br><span class="line">                    IF FilterName = ‘SE’</span><br><span class="line">                        SelectiveEncryptionFilterParams</span><br></pre></td></tr></table></figure>


<p>非选择性）加密的筛选器参数在encryptionfilterparams中定义。带有此字段的所有数据包都应加密。</p>
<p>EncryptionFilterParams</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field       Type        Comment</span><br><span class="line">IV          UI8 [<span class="number">16</span>]	包含<span class="number">16</span>字节的AES-CBC IV数据。</span><br></pre></td></tr></table></figure>


<p>选择加密的筛选参数在SelectiveEncryptionFilterParams中定义。</p>
<p>SelectiveEncryptionFilterParams</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field               Type            Comment</span><br><span class="line">EncryptedAU         UB [<span class="number">1</span>]          选择性加密指示器显示数据包是否加密。</span><br><span class="line">                                    <span class="number">0</span>=数据包未加密</span><br><span class="line">                                    <span class="number">1</span>=数据包已加密。</span><br><span class="line">Reserved            UB [<span class="number">7</span>]          Shall be <span class="number">0</span></span><br><span class="line">IV                  IF EncryptedAU == <span class="number">1</span></span><br><span class="line">                    UI8 [<span class="number">16</span>]        仅当数据包加密时才存在。包含<span class="number">16</span>字节的AES-CBC IV数据</span><br></pre></td></tr></table></figure>

<h5 id="a9-3-3">F.3.3加密正文</h5>

<p>如果包是加密的，那么主体应包含本节所述的加密主体，否则主体应包含纯文本数据。</p>
<p>EncryptedBody</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Field       Type                    Comment</span><br><span class="line">Content     UI8 [Plaintext Length]	密码文本</span><br><span class="line">Padding     UI8 [Padding Length]	加密填充。</span><br></pre></td></tr></table></figure>

<h5 id="a9-3-3-1">3.3.1填充</h5>

<p>所有加密样本应填充到块密码块长度的倍数。填料方案应如RFC 2630中所述，复制如下：</p>
<p>块密码期望输入数据是k八位字节的倍数（对于aes 128，是16个八位字节的倍数），其中k大于1。对于此类算法，输入应在尾端填充k-（length mod k）八位字节，所有八位字节的值均为k-（length mod k），其中length是输入的长度。</p>
<p>填充使块大小达到块密码块长度的下一整数倍。即使纯文本可以被块长度平均整除，也会出现填充。</p>
<p>示例：如果k为16字节，长度为32字节，填充长度为16字节，包含0x10，块大小为48字节。</p>
<h4 id="a9-4">F.4加密和元数据</h4>

<p>当FLV加密时，OnMetadata脚本数据应始终保持清晰。</p>
<p>不同的flv解析器需要这一点来成功地传输flv，媒体播放器也需要这一点来为使用提供一些上下文信息。</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">雪人</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.webq.top/2020/11/19/doc/f4v/">https://www.webq.top/2020/11/19/doc/f4v/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.webq.top" target="_blank">雪人</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/hy.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/11/19/doc/h264/"><img class="prev-cover" src="/img/hy.jpeg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">H.264视频的RTP有效负载格式</div></div></a></div><div class="next-post pull-right"><a href="/2020/11/19/doc/dp/"><img class="next-cover" src="/img/hy.jpeg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">设计模式</div></div></a></div></nav></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By 雪人</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.spacingElementById('content-inner')
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js', () => {
      pangu.spacingElementById('content-inner')
    })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguFn)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div></div></body></html>